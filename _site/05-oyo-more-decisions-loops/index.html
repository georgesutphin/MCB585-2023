















<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="last-modified" content="2022-08-31 22:22:49 -0700">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- meta "search-domain" used for google site search function google_search() -->
    <meta name="search-domain" value="">
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/lesson.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/syntax.css" />

    



    <!-- Favicons for everyone -->
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="../assets/favicons/mcb585/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/favicons/mcb585/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/favicons/mcb585/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/favicons/mcb585/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="../assets/favicons/mcb585/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="../assets/favicons/mcb585/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="../assets/favicons/mcb585/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../assets/favicons/mcb585/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="../assets/favicons/mcb585/favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="../assets/favicons/mcb585/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="../assets/favicons/mcb585/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="../assets/favicons/mcb585/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="../assets/favicons/mcb585/favicon-128.png" sizes="128x128" />
    <meta name="application-name" content=" - MCB 585: Multidisciplinary/Quantitative Approaches to Solving Biological Problems"/>
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="../assets/favicons/mcb585/mstile-144x144.png" />
    <meta name="msapplication-square70x70logo" content="../assets/favicons/mcb585/mstile-70x70.png" />
    <meta name="msapplication-square150x150logo" content="../assets/favicons/mcb585/mstile-150x150.png" />
    <meta name="msapplication-wide310x150logo" content="../assets/favicons/mcb585/mstile-310x150.png" />
    <meta name="msapplication-square310x310logo" content="../assets/favicons/mcb585/mstile-310x310.png" />


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->
    <title>MCB 585: Multidisciplinary/Quantitative Approaches to Solving Biological Problems: Decision Making and Loops -- Additional Detail</title>
  </head>
  <body>

    



    <div class="container">
      






<nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      
      
      <a href="https://georgesutphin.github.io/MCB585/" class="pull-left">
        <img class="navbar-logo" src="../assets/img/mcb585-logo.svg" alt="MCB585 logo" />
      </a>
      

      
      <a class="navbar-brand" href="../">Home</a>

    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">

	
        <li><a href="../CODE_OF_CONDUCT.html">Code of Conduct</a></li>

        
	
        <li><a href="../setup.html">Setup</a></li>

        
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Episodes <span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            <li><a href="../01-class-introduction/index.html">Getting started with R and RStudio</a></li>
            
            <li><a href="../01-oyo-introduction/index.html">Getting started with R and RStudio -- Additional Detail</a></li>
            
            <li><a href="../02-class-R-data-types-structures/index.html">Basic Data Types and Data Structures in R</a></li>
            
            <li><a href="../02-oyo-R-data-types-in-depth/index.html">R Data Types -- In-Depth</a></li>
            
            <li><a href="../03-class-data-frames/index.html">Data Frames, Basic Indexing, Reading/Writing Data</a></li>
            
            <li><a href="../03-oyo-Lists/index.html">Lists and Advanced Indexing</a></li>
            
            <li><a href="../04-class-manipulating-plotting-data/index.html">Manipulating and Plotting Data</a></li>
            
            <li><a href="../04-oyo-advanced-data-manipulation/index.html">Advanced Data Manipulation and Plotting</a></li>
            
            <li><a href="../05-class-decisions-loops/index.html">Decision Making and Loops</a></li>
            
            <li><a href="../05-oyo-more-decisions-loops/index.html">Decision Making and Loops -- Additional Detail</a></li>
            
            <li><a href="../06-class-distributions/index.html">Distributions and Normality</a></li>
            
            <li><a href="../06-oyo-more-distributions/index.html">Distributions and Normality -- Additional Detail</a></li>
            
            <li><a href="../07-class-hypothesis-testing/index.html">Hypothesis Testing</a></li>
            
            <li><a href="../07-oyo-multiple-test-correction/index.html">Multiple Test Correction</a></li>
            
            <li><a href="../08-class-survival-analysis/index.html">Survival Analysis</a></li>
            
            <li><a href="../08-oyo-advanced-survival-analysis/index.html">Advanced Survival Analysis</a></li>
            
            <li><a href="../09-class-power-analysis/index.html">Power Analysis</a></li>
            
            <li><a href="../09-oyo-simulation/index.html">Simulating Experiments</a></li>
            
            <li><a href="../99-projects/index.html">Final Projects</a></li>
            
	    <li role="separator" class="divider"></li>
            <li><a href="../aio.html">All in one page (Beta)</a></li>
          </ul>
        </li>
	

	
	<!--
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Extras <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../reference.html">Reference</a></li>
            
            <li><a href="../about/">About</a></li>
            
            <li><a href="../discuss/">Discussion</a></li>
            
            <li><a href="../figures/">Figures</a></li>
            
            <li><a href="../guide/">Instructor Notes</a></li>
            
          </ul>
        </li>
	-->

	
        <li><a href="../LICENSE.html">About</a></li>
	<!--
	
	<li><a href="/edit//_episodes_rmd/05-oyo-more-decisions-loops.Rmd">Improve this page <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a></li>
	
	-->
      </ul>
      <form class="navbar-form navbar-right" role="search" id="search" onsubmit="google_search(); return false;">
        <div class="form-group">
          <input type="text" id="google-search" placeholder="Search..." aria-label="Google site search">
        </div>
      </form>
    </div>
  </div>
</nav>

















<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="../05-class-decisions-loops/index.html"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
    <h3 class="maintitle"><a href="../">MCB 585: Multidisciplinary/Quantitative Approaches to Solving Biological Problems</a></h3>
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="../06-class-distributions/index.html"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>

<article>
<div class="row">
  <div class="col-md-1">
  </div>
  <div class="col-md-10">
    <h1 class="maintitle">Decision Making and Loops -- Additional Detail</h1>
  </div>
  <div class="col-md-1">
  </div>
</div>


<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Class Date:</strong> 9/6/2022 -- On Your Own
      <br/>
      <strong>Teaching:</strong> 90 min
      <br/>
      <strong>Exercises:</strong> 30 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>What operators and functions are available for running test in <code class="language-plaintext highlighter-rouge">if</code> statements?</p>
</li>
	
	<li><p>Are there different indexing strategies for different situations using a <code class="language-plaintext highlighter-rouge">for</code> loop?</p>
</li>
	
	<li><p>Should I use a loop or an <code class="language-plaintext highlighter-rouge">apply</code> statement?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Know the bredth of options for running test (aka asking questions) in <code class="language-plaintext highlighter-rouge">if</code> statements.</p>
</li>
	
	<li><p>Practice applying <code class="language-plaintext highlighter-rouge">if</code> statements in different situations.</p>
</li>
	
	<li><p>Understand how R interprets simple operations (e.g. addition) when applied to data vectors.</p>
</li>
	
	<li><p>Use either the elements or the position in a vector as the primary index in a <code class="language-plaintext highlighter-rouge">for</code> loop.</p>
</li>
	
	<li><p>Trace changes to a loop variable as the loop runs.</p>
</li>
	
	<li><p>Trace changes to other variables as they are updated by a <code class="language-plaintext highlighter-rouge">for</code> loop.</p>
</li>
	
	<li><p>Understand the advanatages and disadvantages to using apply functions vs. for loops.</p>
</li>
	
	<li><p>Practice applying <code class="language-plaintext highlighter-rouge">for</code> loops in different situations.</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<h3 id="on-your-own">On Your Own</h3>

<h4 id="conditional-statements--additional-detail">Conditional statements – additional detail</h4>

<p>We covered the basics of using <code class="language-plaintext highlighter-rouge">if</code> and <code class="language-plaintext highlighter-rouge">else</code> statement <em>In Class</em>. These make up a central tool in coding. There are a lot of ways to write the logical tests in <code class="language-plaintext highlighter-rouge">if</code> statements to ask specific and complex questions about your data and metadata. Here is a useful reference to help keep the options straight:</p>

<blockquote class="callout">
  <h2 id="common-operators-and-functions-used-in-if-statments">Common operators and functions used in <code class="language-plaintext highlighter-rouge">if</code> statments</h2>

  <p>Conditional tests can be as complicated as you need them to be. Here is
set of operators and functions commonly used in <code class="language-plaintext highlighter-rouge">if</code> statement tests:</p>

  <p>Relational operators:</p>
  <ul>
    <li><code class="language-plaintext highlighter-rouge">&lt;</code> = less than</li>
    <li><code class="language-plaintext highlighter-rouge">&gt;</code> = greater than</li>
    <li><code class="language-plaintext highlighter-rouge">&lt;=</code> = less than or equal to</li>
    <li><code class="language-plaintext highlighter-rouge">&gt;=</code> = greater than or equal to</li>
    <li><code class="language-plaintext highlighter-rouge">==</code> = exactly equal to</li>
    <li><code class="language-plaintext highlighter-rouge">!=</code> = not equal to</li>
    <li><code class="language-plaintext highlighter-rouge">%in%</code> = is present in (used to ask if the value(s) on the left is present in the vector/matrix on the right)</li>
  </ul>

  <p>Logical operators:</p>
  <ul>
    <li><code class="language-plaintext highlighter-rouge">!</code> = <strong>NOT</strong> (changes <code class="language-plaintext highlighter-rouge">TRUE</code> to <code class="language-plaintext highlighter-rouge">FALSE</code> and vice versa)</li>
    <li><code class="language-plaintext highlighter-rouge">&amp;</code> = element-wise <strong>AND</strong> (both are true; outputs vector for vector input comparing elements)</li>
    <li><code class="language-plaintext highlighter-rouge">&amp;&amp;</code> = logical <strong>AND</strong> (both are true; only considers first element of a vector)</li>
    <li><code class="language-plaintext highlighter-rouge">|</code> = element-wise <strong>OR</strong> (one or both are true; outputs vector for vector input comparing elements)</li>
    <li><code class="language-plaintext highlighter-rouge">||</code> = logical <strong>OR</strong> (both are true; only considers first index of a vector)</li>
    <li><code class="language-plaintext highlighter-rouge">xor(x,y)</code> = element-wise exclusive <strong>OR</strong> (either are true, but not both; outputs vector for vector input comparing elements)</li>
  </ul>

  <p>Functions:</p>
  <ul>
    <li><code class="language-plaintext highlighter-rouge">all()</code> = are all entries <code class="language-plaintext highlighter-rouge">TRUE</code>?</li>
    <li><code class="language-plaintext highlighter-rouge">any()</code> = is at least one element <code class="language-plaintext highlighter-rouge">TRUE</code>?</li>
    <li><code class="language-plaintext highlighter-rouge">is.na()</code> = is the input value <code class="language-plaintext highlighter-rouge">NA</code>?</li>
    <li><code class="language-plaintext highlighter-rouge">is.&lt;data type&gt;()</code> = does the input object belong to class <code class="language-plaintext highlighter-rouge">&lt;data type&gt;</code>?</li>
    <li><code class="language-plaintext highlighter-rouge">is.finite()</code> = is the input value finite?</li>
    <li><code class="language-plaintext highlighter-rouge">is.infinite()</code> = is the input value infinite?</li>
  </ul>
</blockquote>

<p> </p>

<p>Beyond that, the best way to learn how to use <code class="language-plaintext highlighter-rouge">if</code> statements effectively is to practice applying them to different situations. Below are a series of exercises to get you started.</p>

<p> </p>
<h4 id="exercises--conditional-statements">Exercises – conditional statements</h4>

<blockquote class="challenge">
  <h2 id="histograms-instead">Histograms Instead</h2>

  <p>One of your collaborators prefers to see the distributions of larger 
vectors as a histogram instead of as a boxplot. In order to choose 
between a histogram and a boxplot we will edit the function <code class="language-plaintext highlighter-rouge">plot_dist()</code> &gt; that we wrote <em>In Class</em> and add an additional argument <code class="language-plaintext highlighter-rouge">use_boxplot</code>.<br />
By default we will set <code class="language-plaintext highlighter-rouge">use_boxplot</code> to <code class="language-plaintext highlighter-rouge">TRUE</code> which will create a 
boxplot when the vector is longer than <code class="language-plaintext highlighter-rouge">threshold</code>.</p>

  <p>When <code class="language-plaintext highlighter-rouge">use_boxplot</code> is set to <code class="language-plaintext highlighter-rouge">FALSE</code>, <code class="language-plaintext highlighter-rouge">plot_dist()</code> will instead plot a 
histogram for larger vectors. As before, if the length of the vector is 
shorter than <code class="language-plaintext highlighter-rouge">threshold</code>, <code class="language-plaintext highlighter-rouge">plot_dist()</code> will create a stripchart 
(allowing users to define what is meant by “larger”).</p>

  <p>A histogram is made with the <code class="language-plaintext highlighter-rouge">hist()</code> command in R. Here is how we want 
<code class="language-plaintext highlighter-rouge">plot_dist()</code> to behave:</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"data/inflammation-01.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span><span class="n">plot_dist</span><span class="p">(</span><span class="n">dat</span><span class="p">[,</span><span class="w"> </span><span class="m">10</span><span class="p">],</span><span class="w"> </span><span class="n">threshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="n">use_boxplot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">   </span><span class="c1"># day (column) 10 - create boxplot</span><span class="w">
</span></code></pre></div>  </div>

  <p><img src="../fig/rmd-05-oyo-more-decisions-loops-unnamed-chunk-2-1.png" title="plot of chunk unnamed-chunk-2" alt="plot of chunk unnamed-chunk-2" width="612" style="display: block; margin: auto;" /></p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot_dist</span><span class="p">(</span><span class="n">dat</span><span class="p">[,</span><span class="w"> </span><span class="m">10</span><span class="p">],</span><span class="w"> </span><span class="n">threshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="n">use_boxplot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">  </span><span class="c1"># day (column) 10 - create histogram</span><span class="w">
</span></code></pre></div>  </div>

  <p><img src="../fig/rmd-05-oyo-more-decisions-loops-unnamed-chunk-2-2.png" title="plot of chunk unnamed-chunk-2" alt="plot of chunk unnamed-chunk-2" width="612" style="display: block; margin: auto;" /></p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot_dist</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">],</span><span class="w"> </span><span class="n">threshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w">                    </span><span class="c1"># samples (rows) 1-5 on day (column) 10</span><span class="w">
</span></code></pre></div>  </div>

  <p><img src="../fig/rmd-05-oyo-more-decisions-loops-unnamed-chunk-2-3.png" title="plot of chunk unnamed-chunk-2" alt="plot of chunk unnamed-chunk-2" width="612" style="display: block; margin: auto;" /></p>

  <blockquote class="solution">
    <h2 id="solution">Solution</h2>
    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Copy and paste the plot_dist() function from In Class</span><span class="w">
</span><span class="c1"># and add "use_boxplot" as an argument with a default value of TRUE</span><span class="w">
</span><span class="n">plot_dist</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">threshold</span><span class="p">,</span><span class="w"> </span><span class="n">use_boxplot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">

   </span><span class="c1"># if the vector is above threshold, use boxplot if requested</span><span class="w">
   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">threshold</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">use_boxplot</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
       </span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
   
   </span><span class="c1"># if a boxplot is not requested, use histogram instead</span><span class="w">
   </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">threshold</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">use_boxplot</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
       </span><span class="n">hist</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">

   </span><span class="c1"># if the vector is below the length threshold, use a stripchart</span><span class="w">
   </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
       </span><span class="n">stripchart</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">vert</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w">
   </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>
  </blockquote>
</blockquote>

<p> </p>

<blockquote class="challenge">
  <h2 id="combining-concepts--segretating-flowers-by-petal-size">Combining concepts – segretating flowers by petal size</h2>

  <p>In the <code class="language-plaintext highlighter-rouge">iris</code> dataset, we want to categorize each flower based on size. Copy
the <code class="language-plaintext highlighter-rouge">iris</code> dataset:</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iris2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">iris</span><span class="w">
</span></code></pre></div>  </div>

  <p> </p>

  <p>and add a column that indicates, represents a member of 
it’s species with “large” petals (<code class="language-plaintext highlighter-rouge">Petal.Length</code> &gt; species average of 
<code class="language-plaintext highlighter-rouge">Petal.Length</code>) or “small” petals (<code class="language-plaintext highlighter-rouge">Petal.Length</code> &lt;= species average of 
<code class="language-plaintext highlighter-rouge">Petal.Length</code>).</p>

  <p>To accomplish this goal, you will need to write a script that accomplishes
several steps that combine concepts from different lessons. Plan out the 
necessary steps and how to accomplish each step with concepts covered so far. 
Try to find answers to questions using forums or other online resources; 
however, there are a few progressive hints below if you get really stuck.</p>

  <blockquote class="solution">
    <h2 id="hint-1--planning-your-script">Hint 1 – Planning your script</h2>

    <p>One approach to this problem is to complete three steps:</p>
    <ol>
      <li>Calculate the average <code class="language-plaintext highlighter-rouge">Petal.Length</code> for each species and store the 
values in a searchable format (e.g. data frame with <code class="language-plaintext highlighter-rouge">Species</code> name in one 
column, average `Petal.Length in the other).</li>
      <li>Identify the correct average <code class="language-plaintext highlighter-rouge">Petal.Length</code> value for each flower based
based on it’s species.</li>
      <li>Compare the <code class="language-plaintext highlighter-rouge">Petal.Length</code> for each flower to the corresponding average 
species <code class="language-plaintext highlighter-rouge">Petal.Length</code> and output eitehr “large” or “small”.</li>
    </ol>
  </blockquote>

  <blockquote class="solution">
    <h2 id="hint-2">Hint 2</h2>

    <p>The <code class="language-plaintext highlighter-rouge">aggregate()</code> function is useful for completing basic function calls 
(e.g. <code class="language-plaintext highlighter-rouge">mean()</code>)across different subsets of a dataset.</p>
  </blockquote>

  <blockquote class="solution">
    <h2 id="hint-3">Hint 3</h2>

    <p>The <code class="language-plaintext highlighter-rouge">match()</code> function allows you to take a vector of values, and look up
the position in a second vector that matches each element of the first.
The output can be used to index the second list (or another of the same 
length) to return corresponding values.</p>
  </blockquote>

  <blockquote class="solution">
    <h2 id="hint-4">Hint 4</h2>

    <p>The <code class="language-plaintext highlighter-rouge">ifelse()</code> function is a vectorized version of an <code class="language-plaintext highlighter-rouge">if</code> and <code class="language-plaintext highlighter-rouge">else</code> 
statement that allows you to return one of two values based on a relational 
comparison that returns a logical statement.</p>
  </blockquote>

  <blockquote class="solution">
    <h2 id="solution-1">Solution</h2>

    <p>The first step is to calculate the average <code class="language-plaintext highlighter-rouge">Petal.Length</code> for each species.
An efficient way to do this is to use the <code class="language-plaintext highlighter-rouge">aggregate()</code> function:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">petal.length.means</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">aggregate</span><span class="p">(</span><span class="n">Petal.Length</span><span class="o">~</span><span class="n">Species</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">iris2</span><span class="p">,</span><span class="w"> </span><span class="n">FUN</span><span class="o">=</span><span class="n">mean</span><span class="p">)</span><span class="w">
</span><span class="n">petal.length.means</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     Species Petal.Length
1     setosa        1.462
2 versicolor        4.260
3  virginica        5.552
</code></pre></div>    </div>

    <p> </p>

    <p>The second step is to determine which of these mean values is the correct 
one to use for comparison for each flower (i.e. which species does the 
flower belong to). To do this, we can create a vector that contains the 
correct mean comparison value for each flower in the <code class="language-plaintext highlighter-rouge">iris</code> data frame. The 
<code class="language-plaintext highlighter-rouge">match()</code> function allows us to look up the mean value in the 
<code class="language-plaintext highlighter-rouge">petal.length.means</code> data frame based on the <code class="language-plaintext highlighter-rouge">Species</code> for each flower in 
the <code class="language-plaintext highlighter-rouge">iris</code> data frame:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># first look up the index</span><span class="w">
</span><span class="n">species.index</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">match</span><span class="p">(</span><span class="n">iris</span><span class="o">$</span><span class="n">Species</span><span class="p">,</span><span class="n">petal.length.means</span><span class="o">$</span><span class="n">Species</span><span class="p">)</span><span class="w">
</span><span class="n">species.index</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
 [38] 1 1 1 1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
 [75] 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 3 3 3 3 3 3 3 3 3 3 3
[112] 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3
[149] 3 3
</code></pre></div>    </div>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># and use it to pull the mean value</span><span class="w">
</span><span class="n">mean.comparison</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">petal.length.means</span><span class="o">$</span><span class="n">Petal.Length</span><span class="p">[</span><span class="n">species.index</span><span class="p">]</span><span class="w">
</span><span class="n">mean.comparison</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  [1] 1.462 1.462 1.462 1.462 1.462 1.462 1.462 1.462 1.462 1.462 1.462 1.462
 [13] 1.462 1.462 1.462 1.462 1.462 1.462 1.462 1.462 1.462 1.462 1.462 1.462
 [25] 1.462 1.462 1.462 1.462 1.462 1.462 1.462 1.462 1.462 1.462 1.462 1.462
 [37] 1.462 1.462 1.462 1.462 1.462 1.462 1.462 1.462 1.462 1.462 1.462 1.462
 [49] 1.462 1.462 4.260 4.260 4.260 4.260 4.260 4.260 4.260 4.260 4.260 4.260
 [61] 4.260 4.260 4.260 4.260 4.260 4.260 4.260 4.260 4.260 4.260 4.260 4.260
 [73] 4.260 4.260 4.260 4.260 4.260 4.260 4.260 4.260 4.260 4.260 4.260 4.260
 [85] 4.260 4.260 4.260 4.260 4.260 4.260 4.260 4.260 4.260 4.260 4.260 4.260
 [97] 4.260 4.260 4.260 4.260 5.552 5.552 5.552 5.552 5.552 5.552 5.552 5.552
[109] 5.552 5.552 5.552 5.552 5.552 5.552 5.552 5.552 5.552 5.552 5.552 5.552
[121] 5.552 5.552 5.552 5.552 5.552 5.552 5.552 5.552 5.552 5.552 5.552 5.552
[133] 5.552 5.552 5.552 5.552 5.552 5.552 5.552 5.552 5.552 5.552 5.552 5.552
[145] 5.552 5.552 5.552 5.552 5.552 5.552
</code></pre></div>    </div>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># this can all be done in one step:</span><span class="w">
</span><span class="n">mean.comparison</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">petal.length.means</span><span class="o">$</span><span class="n">Petal.Length</span><span class="p">[</span><span class="n">match</span><span class="p">(</span><span class="n">iris</span><span class="o">$</span><span class="n">Species</span><span class="p">,</span><span class="n">petal.length.means</span><span class="o">$</span><span class="n">Species</span><span class="p">)]</span><span class="w">
</span></code></pre></div>    </div>

    <p> </p>

    <p>Finally, we use the vector of mean values to compare each flower’s 
<code class="language-plaintext highlighter-rouge">Petal.Length</code> to the species average <code class="language-plaintext highlighter-rouge">Petal.Length</code> using <code class="language-plaintext highlighter-rouge">ifelse()</code> and 
assign “large” if the flower is larger or “small” if not.</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iris2</span><span class="o">$</span><span class="n">Species.Petal.Group</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">iris2</span><span class="o">$</span><span class="n">Petal.Length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">mean.comparison</span><span class="p">,</span><span class="w"> 
</span><span class="s2">"large"</span><span class="p">,</span><span class="w"> </span><span class="s2">"small"</span><span class="p">)</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">iris2</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  Sepal.Length Sepal.Width Petal.Length Petal.Width Species Species.Petal.Group
1          5.1         3.5          1.4         0.2  setosa               small
2          4.9         3.0          1.4         0.2  setosa               small
3          4.7         3.2          1.3         0.2  setosa               small
4          4.6         3.1          1.5         0.2  setosa               large
5          5.0         3.6          1.4         0.2  setosa               small
6          5.4         3.9          1.7         0.4  setosa               large
</code></pre></div>    </div>

  </blockquote>
</blockquote>

<hr />
<h3 id="using-for-loops--additional-detail">Using <code class="language-plaintext highlighter-rouge">for</code> loops – additional detail</h3>

<p> </p>
<h4 id="setting-up-the-loop-variable-in-for-loops--two-common-approaches">Setting up the loop variable in <code class="language-plaintext highlighter-rouge">for</code> loops – two common approaches</h4>

<p>There is a subtle decision to make when designing a <code class="language-plaintext highlighter-rouge">for</code> loop. <em>In Class</em> we demonstrated how to use the <strong>loop variable</strong> to step through a collection of objects and repeat some desired task. R updates the <strong>loop variable</strong> during each <em>loop</em> (aka each <em>iteration</em>) by reassigning the value of the <strong>loop variable</strong> to the next object sequentially in the collection. However, we can use different properties of the collection to define the value assigned to the <strong>loop variable</strong> during each iteration. The two most common are to have the <strong>loop variable</strong> take on, in sequence:</p>
<ul>
  <li>the value of the object contained within each element, or</li>
  <li>the position (i.e. index) of the element within the collection</li>
</ul>

<p>Each is perfectly acceptable, and useful in different situations.</p>

<p> </p>

<p><strong>Iterating by element</strong></p>

<p>Updating the <strong>loop variable</strong> to take on the value of the next element in the collection during each iteration is the version we used in <em>in class</em>. To do this, we define the <strong>loop variable</strong> using the format <code class="language-plaintext highlighter-rouge">for(item in collection)</code>. To illustrate what the loop is doing with the <strong>loop variable</strong> during each iteration, let’s write a self-referential <code class="language-plaintext highlighter-rouge">for</code> loop that just prints the value of the <strong>loop variable</strong> once each loop. We will use the first 6 letters in the alphabet as our <code class="language-plaintext highlighter-rouge">collection</code>:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># define our collection</span><span class="w">
</span><span class="n">collection</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nb">letters</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">6</span><span class="p">]</span><span class="w">
</span><span class="n">collection</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "a" "b" "c" "d" "e" "f"
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># iterate through the collection and print each element</span><span class="w">
</span><span class="k">for</span><span class="p">(</span><span class="n">item</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">collection</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">print</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "a"
[1] "b"
[1] "c"
[1] "d"
[1] "e"
[1] "f"
</code></pre></div></div>

<p> </p>

<p>we can now use the values contained within our <code class="language-plaintext highlighter-rouge">collection</code> in operations within the loop. As an arbitraty example, we can add the letters to a growing string and print that string:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">string</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="c1"># initialize empty string</span><span class="w">
</span><span class="k">for</span><span class="p">(</span><span class="n">item</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">collection</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">print</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="w"> </span><span class="c1"># print current item</span><span class="w">
  </span><span class="n">string</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="n">string</span><span class="p">,</span><span class="n">item</span><span class="p">)</span><span class="w"> </span><span class="c1"># add letter to current string</span><span class="w">
  </span><span class="n">print</span><span class="p">(</span><span class="n">string</span><span class="p">)</span><span class="w"> </span><span class="c1"># print current string</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "a"
[1] "a"
[1] "b"
[1] "ab"
[1] "c"
[1] "abc"
[1] "d"
[1] "abcd"
[1] "e"
[1] "abcde"
[1] "f"
[1] "abcdef"
</code></pre></div></div>

<p> </p>

<p>This structure for the <code class="language-plaintext highlighter-rouge">for</code> loop is important when all you need to manipulate within the loop are the values contained within the collection.</p>

<p> </p>

<p><strong>Iterating by position</strong></p>

<p>Often times, there will be a good reason to know the current position (or index) in the collection during a given loop, rather than the contents of the collection at that position. The index allows us to do a variety of things, including index other objects with the same dimensions or provide the user with a progress update for more time consuming jobs. T</p>

<p>For positional indexing, we can use the format <code class="language-plaintext highlighter-rouge">for(1:length(collection))</code>. Alternatively, we can use the <code class="language-plaintext highlighter-rouge">seq_along()</code> function, which is a version of seq that uses arguments <code class="language-plaintext highlighter-rouge">from = 1</code> and <code class="language-plaintext highlighter-rouge">by = 1</code> by default, and the length of the entered object for the <code class="language-plaintext highlighter-rouge">to</code> argument. Thus <code class="language-plaintext highlighter-rouge">1:length(collection)</code> produces the same result as <code class="language-plaintext highlighter-rouge">seq_along(collection)</code>:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">collection</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "a" "b" "c" "d" "e" "f"
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 1 2 3 4 5 6
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">seq_along</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 1 2 3 4 5 6
</code></pre></div></div>

<p> </p>

<p>In essence, we are creating a new <code class="language-plaintext highlighter-rouge">collection</code> for the <code class="language-plaintext highlighter-rouge">for</code> loop that consists of a list of integers from 1 to the length of the collection. The <code class="language-plaintext highlighter-rouge">for</code> loop will step through these integers, in effect using the <code class="language-plaintext highlighter-rouge">loop</code> variable too keep count of the number of loops that have progressed. Let’t look at the behavior by replacing the <strong>loop</strong> variable from our above example with the positional version (and renaming <code class="language-plaintext highlighter-rouge">item</code> with <code class="language-plaintext highlighter-rouge">i</code> to indicate that we are looking at the index, rather than the contents, of <code class="language-plaintext highlighter-rouge">collection</code>:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">collection</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 1
[1] 2
[1] 3
[1] 4
[1] 5
[1] 6
</code></pre></div></div>

<p> </p>

<p>Note that we can still easily grab the contents of <code class="language-plaintext highlighter-rouge">collection</code> in each loop by simply indexing it with our <strong>loop variable</strong>:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">collection</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">print</span><span class="p">(</span><span class="n">collection</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "a"
[1] "b"
[1] "c"
[1] "d"
[1] "e"
[1] "f"
</code></pre></div></div>

<p> </p>

<p>Because we can easily grab the current element of <code class="language-plaintext highlighter-rouge">collection</code> in this way, and the current index is more generally useful than the content of the current collection element, I tend to use <strong>positional iteration</strong> in <code class="language-plaintext highlighter-rouge">for</code> loops by default. This one comes down to personal preference.</p>

<p>One place that <strong>positional iteration</strong> is commonly useful is when you want to use a <code class="language-plaintext highlighter-rouge">for</code> loop to repeat some operation on each row of a <strong>data frame</strong>. Let’s revisit our aneurism data set:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"data/sample.csv"</span><span class="p">)</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      ID Gender      Group BloodPressure  Age Aneurisms_q1 Aneurisms_q2
1 Sub001      m    Control           132 16.0          114          140
2 Sub002      m Treatment2           139 17.2          148          209
3 Sub003      m Treatment2           130 19.5          196          251
4 Sub004      f Treatment1           105 15.7          199          140
5 Sub005      m Treatment1           125 19.9          188          120
6 Sub006      M Treatment2           112 14.3          260          266
  Aneurisms_q3 Aneurisms_q4
1          202          237
2          248          248
3          122          177
4          233          220
5          222          228
6          320          294
</code></pre></div></div>

<p> </p>

<p>Recall that in earlier lessons we corrected the capitalization inconsistency in the <code class="language-plaintext highlighter-rouge">Gender</code> variable, and also calculated several summary statistics for the quarterly aneurisms counts (total, mean, maximum). We previously did these using a combination of vectorized functions and the <code class="language-plaintext highlighter-rouge">apply()</code> function. Let’s look at how we might accomplish the same set of tasks using a <code class="language-plaintext highlighter-rouge">for</code> loop:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># first define a new empty column for each new statistic </span><span class="w">
</span><span class="c1"># that we want to calculate; use NAs to indicate no value</span><span class="w">
</span><span class="c1"># has yet been calculated</span><span class="w">
</span><span class="n">dat</span><span class="o">$</span><span class="n">aneurisms_total</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NA</span><span class="w">
</span><span class="n">dat</span><span class="o">$</span><span class="n">aneurisms_mean</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NA</span><span class="w">
</span><span class="n">dat</span><span class="o">$</span><span class="n">aneurisms_max</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NA</span><span class="w">

</span><span class="c1"># set up a for loop to cycle through each row of the data frame</span><span class="w">
</span><span class="c1"># using the number of rows provided by the dim() function; you </span><span class="w">
</span><span class="c1"># could alternatively use 1:length(dat$ID) for example</span><span class="w">
</span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">dim</span><span class="p">(</span><span class="n">dat</span><span class="p">)[</span><span class="m">1</span><span class="p">])</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="c1"># first use an if statements to correct lower to upper case Gender</span><span class="w">
  </span><span class="c1"># for the current (ith) entry</span><span class="w">
  </span><span class="k">if</span><span class="p">(</span><span class="n">dat</span><span class="o">$</span><span class="n">Gender</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"m"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="n">dat</span><span class="o">$</span><span class="n">Gender</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"M"</span><span class="p">}</span><span class="w"> </span><span class="c1"># do nothing if not "m"</span><span class="w">
  </span><span class="k">if</span><span class="p">(</span><span class="n">dat</span><span class="o">$</span><span class="n">Gender</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"f"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="n">dat</span><span class="o">$</span><span class="n">Gender</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"F"</span><span class="p">}</span><span class="w"> </span><span class="c1"># do nothing if not "f"</span><span class="w">
  
  </span><span class="c1"># now calculate the current (ith) value for each of the statistics;</span><span class="w">
  </span><span class="c1"># note that we need to include `as.numeric()` to tell R to treat</span><span class="w">
  </span><span class="c1"># the columns of the data frame instead as a numeric vector</span><span class="w">
  </span><span class="n">dat</span><span class="o">$</span><span class="n">aneurisms_total</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="m">6</span><span class="o">:</span><span class="m">9</span><span class="p">]))</span><span class="w">
  </span><span class="n">dat</span><span class="o">$</span><span class="n">aneurisms_mean</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="m">6</span><span class="o">:</span><span class="m">9</span><span class="p">]))</span><span class="w">
  </span><span class="n">dat</span><span class="o">$</span><span class="n">aneurisms_max</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="m">6</span><span class="o">:</span><span class="m">9</span><span class="p">]))</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1"># check the result</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      ID Gender      Group BloodPressure  Age Aneurisms_q1 Aneurisms_q2
1 Sub001      M    Control           132 16.0          114          140
2 Sub002      M Treatment2           139 17.2          148          209
3 Sub003      M Treatment2           130 19.5          196          251
4 Sub004      F Treatment1           105 15.7          199          140
5 Sub005      M Treatment1           125 19.9          188          120
6 Sub006      M Treatment2           112 14.3          260          266
  Aneurisms_q3 Aneurisms_q4 aneurisms_total aneurisms_mean aneurisms_max
1          202          237             693            693           693
2          248          248             853            853           853
3          122          177             746            746           746
4          233          220             792            792           792
5          222          228             758            758           758
6          320          294            1140           1140          1140
</code></pre></div></div>

<p> </p>

<p>In this case, the point is more illustrative of how to design a <code class="language-plaintext highlighter-rouge">for</code> loop. Using <code class="language-plaintext highlighter-rouge">toupper()</code> to correct the <code class="language-plaintext highlighter-rouge">Gender</code> column and 3 <code class="language-plaintext highlighter-rouge">apply()</code> statements to take care of the statistics would accomplish in 4 lines of code what too 11 in the <code class="language-plaintext highlighter-rouge">for</code> loop version. However, there will be times when the analysis you want to conduct is too complex to formulate concisely within an <code class="language-plaintext highlighter-rouge">apply()</code> statement or two.</p>

<p> </p>
<h4 id="for-or-apply"><code class="language-plaintext highlighter-rouge">for</code> or <code class="language-plaintext highlighter-rouge">apply</code>?</h4>

<p>A <code class="language-plaintext highlighter-rouge">for</code> loop is used to apply the same function calls to a collection of objects. As we just demonstrated, the <code class="language-plaintext highlighter-rouge">apply</code> family of functions are used in much the same way.</p>

<p>You’ve already used one of the family, <code class="language-plaintext highlighter-rouge">apply()</code>. The <code class="language-plaintext highlighter-rouge">apply</code> family members include:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">apply()</code>  - apply over the margins of an array (e.g. the rows or columns of a matrix)</li>
  <li><code class="language-plaintext highlighter-rouge">lapply()</code> - apply over an object and return list</li>
  <li><code class="language-plaintext highlighter-rouge">sapply()</code> - apply over an object and return a simplified object (an array) if possible</li>
  <li><code class="language-plaintext highlighter-rouge">vapply()</code> - similar to <code class="language-plaintext highlighter-rouge">sapply()</code> but you specify the type of object returned by the iterations</li>
  <li>Functions provided in external packages, such as <code class="language-plaintext highlighter-rouge">ddply()</code> and <code class="language-plaintext highlighter-rouge">adply()</code> in the popular <code class="language-plaintext highlighter-rouge">dplyr</code> package.</li>
</ul>

<p>Each of these has an argument <code class="language-plaintext highlighter-rouge">FUN</code> (or something similar) which takes a function to apply to each element of the object. Instead of looping over <code class="language-plaintext highlighter-rouge">filenames</code> and calling <code class="language-plaintext highlighter-rouge">analyze</code>, as you did earlier, you could <code class="language-plaintext highlighter-rouge">sapply</code> over <code class="language-plaintext highlighter-rouge">filenames</code> with <code class="language-plaintext highlighter-rouge">FUN = analyze</code>:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sapply</span><span class="p">(</span><span class="n">filenames</span><span class="p">,</span><span class="w"> </span><span class="n">FUN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">analyze</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Deciding whether to use <code class="language-plaintext highlighter-rouge">for</code> or one of the <code class="language-plaintext highlighter-rouge">apply</code> family is really personal preference. Using an <code class="language-plaintext highlighter-rouge">apply</code> family function forces to you encapsulate your operations as a function rather than separate calls with <code class="language-plaintext highlighter-rouge">for</code>. <code class="language-plaintext highlighter-rouge">for</code> loops are often more intuitive. For several related operations, a <code class="language-plaintext highlighter-rouge">for</code> loop will avoid you having to pass in a lot of extra arguments to your function.</p>

<p>You will sometimes see claims that <code class="language-plaintext highlighter-rouge">apply</code> functions run faster than a <code class="language-plaintext highlighter-rouge">for</code> loop designed to run the same operations. However, this is not generally true, and under the surface the <code class="language-plaintext highlighter-rouge">apply</code> functions are just convenient wrappers for a hidden <code class="language-plaintext highlighter-rouge">for</code> loops.</p>

<p> </p>
<h4 id="loops-in-r-are-slow-">Loops in R are slow (??)</h4>

<p>On this topic, you will probably also hear at some point if you keep using R that loops are slow. This is a common refrain in coding forums. In point of fact, loops are not slow <em>if</em> you follow a few guidelines:</p>
<ol>
  <li>Don’t use a loop when a vectorized alternative exists; unlike <code class="language-plaintext highlighter-rouge">apply</code>, vectorized operations <em>are</em> faster than loops</li>
  <li>Don’t grow objects (via <code class="language-plaintext highlighter-rouge">c()</code>, <code class="language-plaintext highlighter-rouge">cbind()</code>, etc) during the loop - R has to create a new object and copy across the information just to add a new element or row/column</li>
  <li>Instead, pre-allocate an empty object that is large enough to hold the results (e.g. a <strong>data frame</strong> with the right number of rows and columns, but with <code class="language-plaintext highlighter-rouge">NA</code> or default values pre-loaded) and fill in the individual values during each iteration of the <code class="language-plaintext highlighter-rouge">for</code> loop. For instance, in the aneurisms example above, we pre-defined (aka initialized) empty columns in the data frame for the total, mean, and max statistics <em>before</em> starting the <code class="language-plaintext highlighter-rouge">for</code> loop.</li>
</ol>

<p>As an example, we will create a new function called <code class="language-plaintext highlighter-rouge">analyze()</code> that will return the mean inflammation per day (column) of each file in the inflammation dataset that we examined earlier. We will start by breaking rule 2, and grow our output by adding new data to a growing data frame using <code class="language-plaintext highlighter-rouge">cbind()</code>:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">analyze</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  
  </span><span class="c1"># start by defining the loop parameters</span><span class="w">
  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">f</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nf">seq_along</span><span class="p">(</span><span class="n">filenames</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">fdata</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="n">filenames</span><span class="p">[</span><span class="n">f</span><span class="p">],</span><span class="w"> </span><span class="n">header</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
    </span><span class="n">res</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">apply</span><span class="p">(</span><span class="n">fdata</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="p">)</span><span class="w">
    
    </span><span class="c1"># check if this is the first iteration</span><span class="w">
    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">f</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="c1"># if so, the current result is the only line of output</span><span class="w">
      </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">res</span><span class="w">
    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="c1"># If this is not the first iteration, add the result to the</span><span class="w">
      </span><span class="c1"># established result as a new column</span><span class="w">
      </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cbind</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="p">)</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p> </p>

<p>Note how we add a new column to <code class="language-plaintext highlighter-rouge">out</code> during each iteration? This is a cardinal sin of writing a <code class="language-plaintext highlighter-rouge">for</code> loop in R.</p>

<p>A much better practice is to create an empty matrix with the right dimensions (rows/columns) to hold the results before starting the <code class="language-plaintext highlighter-rouge">for</code> loop. Then we loop over the files as before, but this time we fill in the pre-defined <code class="language-plaintext highlighter-rouge">f</code>th column of our results matrix <code class="language-plaintext highlighter-rouge">out</code> instead of creating a new column from scratch on the fly. This time there is no copying/growing for R to deal with.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">analyze2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="c1"># pre-allocate the right number of rows and columns for the data</span><span class="w">
  </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">filenames</span><span class="p">),</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">40</span><span class="p">)</span><span class="w"> 
  
  </span><span class="c1"># run the for loop to cycle through the files</span><span class="w">
  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">f</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nf">seq_along</span><span class="p">(</span><span class="n">filenames</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="c1"># read the current file </span><span class="w">
    </span><span class="n">fdata</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="n">filenames</span><span class="p">[</span><span class="n">f</span><span class="p">],</span><span class="w"> </span><span class="n">header</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
    
    </span><span class="c1"># instead of using cbind, now we just overwrite the row of </span><span class="w">
    </span><span class="c1"># the pre-allocated matrix</span><span class="w">
    </span><span class="n">out</span><span class="p">[,</span><span class="w"> </span><span class="n">f</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">apply</span><span class="p">(</span><span class="n">fdata</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p> </p>

<p>Now we can use the function <code class="language-plaintext highlighter-rouge">system.time()</code> to find out how long it takes to run each of these functions:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># First, make sure our inflammation file list is defined</span><span class="w">
</span><span class="n">inflam.files</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">list.files</span><span class="p">(</span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"data"</span><span class="p">,</span><span class="w"> 
                         </span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"^inflammation-.*.csv$"</span><span class="p">,</span><span class="w">
                         </span><span class="n">full.names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">

</span><span class="n">gc</span><span class="p">()</span><span class="w"> </span><span class="c1"># clean things up first</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>         used (Mb) gc trigger (Mb) max used (Mb)
Ncells 515932 27.6    1151674 61.6   852906 45.6
Vcells 990175  7.6    8388608 64.0  1650364 12.6
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># one call to each function does not always show the difference. To </span><span class="w">
</span><span class="c1"># demonstrate the point, we will use a for loop to call function 100</span><span class="w">
</span><span class="c1"># times in a row to see how long each takes</span><span class="w">
</span><span class="n">system.time</span><span class="p">(</span><span class="n">avg</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">100</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="n">analyze</span><span class="p">(</span><span class="n">inflam.files</span><span class="p">)})</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   user  system elapsed 
   3.19    0.23    3.42 
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">system.time</span><span class="p">(</span><span class="n">avg</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">100</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="n">analyze2</span><span class="p">(</span><span class="n">inflam.files</span><span class="p">)})</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   user  system elapsed 
   3.47    0.18    3.64 
</code></pre></div></div>

<p> </p>

<p>The <code class="language-plaintext highlighter-rouge">system</code> time output indicates the total CPU time used to execute the function with <code class="language-plaintext highlighter-rouge">elapsed</code> reflects the total real-world time consumed between when the function was called and when the output was generated. Your results may vary from run to run, but the amount of time used by <code class="language-plaintext highlighter-rouge">analyze</code> should always be greater than the time used by <code class="language-plaintext highlighter-rouge">analyze2</code>, all else being equal. A few 10ths of a second may not seem much now, but keep in mind that we are running a few simple operations on a few hundred files in total. As the complexity of your analysis and the number of files or data point in your dataset increases, the time difference will increase dramatically. A given analysis taking 6 hours to process vs. 30 hours can be critical to the success of some big-data projects, even before you start to calculate the monetary expense of running large analyses on a super computer. This demonstrates one way to evaluate efficiency when it starts to matter.</p>

<p>Note that <code class="language-plaintext highlighter-rouge">apply</code> handles these memory allocation issues for you, but then you have to write the loop part as a function to pass to <code class="language-plaintext highlighter-rouge">apply</code>. At its heart, <code class="language-plaintext highlighter-rouge">apply</code> is just a <code class="language-plaintext highlighter-rouge">for</code> loop with extra convenience.</p>

<blockquote class="callout">
  <h2 id="organizing-larger-projects">Organizing Larger Projects</h2>

  <p>On the topic of large datasets, for larger projects, it is recommended to 
organize separate parts of the analysis into multiple subdirectories, e.g. one 
subdirectory for the raw data, one for the code, and one for the results like 
figures. We have done that here to some extent, putting all of our data files 
into the subdirectory “data”. For more advice on this topic, you can read <a href="http://www.ploscompbiol.org/article/info%3Adoi%2F10.1371%2Fjournal.pcbi.1000424">A quick guide to organizing computational biology projects</a> by William Stafford Noble.</p>
</blockquote>

<p> </p>
<h4 id="exercises--for-loops">Exercises – <code class="language-plaintext highlighter-rouge">for</code> loops</h4>

<blockquote class="challenge">
  <h2 id="summing-values">Summing Values</h2>

  <p>Write a function called <code class="language-plaintext highlighter-rouge">total()</code> that calculates the sum of the values in a vector.</p>

  <p>Yes, R has a built-in function called <code class="language-plaintext highlighter-rouge">sum()</code> that does this for you. Please don’t
use it for this exercise. The goal is to understand how this type of function might 
work under the surface.</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ex_vec</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="m">15</span><span class="p">,</span><span class="w"> </span><span class="m">16</span><span class="p">,</span><span class="w"> </span><span class="m">23</span><span class="p">,</span><span class="w"> </span><span class="m">42</span><span class="p">)</span><span class="w">
</span><span class="n">total</span><span class="p">(</span><span class="n">ex_vec</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>

  <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 108
</code></pre></div>  </div>

  <blockquote class="solution">
    <h2 id="solution-2">Solution</h2>
    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">total</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">vec</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="c1"># calculates the sum of the values in a vector</span><span class="w">
  </span><span class="n">vec_sum</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0</span><span class="w">
  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">num</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">vec</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">vec_sum</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">vec_sum</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">num</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="n">vec_sum</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>
  </blockquote>
</blockquote>

<p> </p>

<blockquote class="challenge">
  <h2 id="exponentiation">Exponentiation</h2>

  <p>Exponentiation is built into R:</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="m">2</span><span class="o">^</span><span class="m">4</span><span class="w">
</span></code></pre></div>  </div>

  <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 16
</code></pre></div>  </div>
  <p>Write a function called <code class="language-plaintext highlighter-rouge">expo()</code> that uses a loop to calculate the same result without
using the <code class="language-plaintext highlighter-rouge">^</code> operator.</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">expo</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>

  <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 16
</code></pre></div>  </div>

  <blockquote class="solution">
    <h2 id="solution-3">Solution</h2>
    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">expo</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">base</span><span class="p">,</span><span class="w"> </span><span class="n">power</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">result</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="w">
  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="n">power</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">result</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">base</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>
  </blockquote>
</blockquote>

<p> </p>

<blockquote class="challenge">
  <h2 id="find-the-maximum-inflammation-score">Find the Maximum Inflammation Score</h2>

  <p>Find the file containing the patient with the highest average inflammation score. Print the file name, the patient number (row number) and the value of the maximum average inflammation score.</p>

  <p>Tips:</p>

  <ol>
    <li>Use variables to store the maximum average and update it as you go through files and patients.</li>
    <li>You can use nested loops (one loop is inside the other) to go through the files as well as through the patients in each file (every row).</li>
  </ol>

  <p>Complete the code below:</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">filenames</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">list.files</span><span class="p">(</span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"data"</span><span class="p">,</span><span class="w"> </span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"^inflammation-.*.csv$"</span><span class="p">,</span><span class="w"> </span><span class="n">full.names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">filename_max</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="c1"># filename where the maximum average inflammation patient is found</span><span class="w">
</span><span class="n">patient_max</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="c1"># index (row number) for this patient in this file</span><span class="w">
</span><span class="n">average_inf_max</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="c1"># value of the average inflammation score for this patient</span><span class="w">
</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">f</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">filenames</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">dat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
  </span><span class="n">dat.means</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">apply</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="p">)</span><span class="w">
  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">patient_index</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">dat.means</span><span class="p">)){</span><span class="w">
    </span><span class="n">patient_average_inf</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dat.means</span><span class="p">[</span><span class="n">patient_index</span><span class="p">]</span><span class="w">
    </span><span class="c1"># Add your code here ...</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">print</span><span class="p">(</span><span class="n">filename_max</span><span class="p">)</span><span class="w">
</span><span class="n">print</span><span class="p">(</span><span class="n">patient_max</span><span class="p">)</span><span class="w">
</span><span class="n">print</span><span class="p">(</span><span class="n">average_inf_max</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>

  <blockquote class="solution">
    <h2 id="solution-4">Solution</h2>
    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Add your code here ...</span><span class="w">
</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">patient_average_inf</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">average_inf_max</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">average_inf_max</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">patient_average_inf</span><span class="w">
  </span><span class="n">filename_max</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">f</span><span class="w">
  </span><span class="n">patient_max</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">patient_index</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>
  </blockquote>
</blockquote>

<p> </p>

<blockquote class="challenge">
  <h2 id="comparing-inflammation-across-trials">Comparing inflammation across trials</h2>

  <p>We want to compare how inflammation for an individual patient changes across
trials. Write a script that plots inflammation for the first patient from each trial
(i.e. from each file) in the same line graph.</p>

  <blockquote class="solution">
    <h2 id="solution-5">Solution</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Indicate the patient (aka row) number that we want to extract</span><span class="w">
</span><span class="n">patient.id</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="w">

</span><span class="c1"># First, grab our file list using pattern matching</span><span class="w">
</span><span class="n">inflam.files</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">list.files</span><span class="p">(</span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"data"</span><span class="p">,</span><span class="w"> 
                        </span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"^inflammation-.*.csv$"</span><span class="p">,</span><span class="w">
                        </span><span class="n">full.names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">

</span><span class="c1"># We can't just plot away, because we don't know the minimum and maximum values.</span><span class="w">
</span><span class="c1"># First, we should cycle through the files and collect the data we need into</span><span class="w">
</span><span class="c1"># a data frame</span><span class="w">

</span><span class="c1"># Initialize matrix for data collection (numeric matrix with a row for each file</span><span class="w">
</span><span class="c1"># and 40 columns for number of days)</span><span class="w">
</span><span class="n">trial.data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">inflam.files</span><span class="p">),</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">40</span><span class="p">)</span><span class="w">

</span><span class="c1"># Start the for loop to cycle through the files</span><span class="w">
</span><span class="k">for</span><span class="p">(</span><span class="n">i.file</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">inflam.files</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1"># this time we use a numeric index</span><span class="w">
  </span><span class="c1"># grab file name</span><span class="w">
  </span><span class="n">file.c</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">inflam.files</span><span class="p">[</span><span class="n">i.file</span><span class="p">]</span><span class="w">
  
  </span><span class="c1"># read in the current file</span><span class="w">
  </span><span class="n">inflam.c</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">file.c</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
  
  </span><span class="c1"># assign selected patient to collection file row</span><span class="w">
  </span><span class="n">trial.data</span><span class="p">[</span><span class="n">i.file</span><span class="p">,]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">inflam.c</span><span class="p">[</span><span class="n">patient.id</span><span class="p">,])</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1"># Initiate the PDF file to store the graphs</span><span class="w">
</span><span class="n">pdf</span><span class="p">(</span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="s2">"results/inflammation-patient"</span><span class="p">,</span><span class="n">patient.id</span><span class="p">,</span><span class="s2">"-by-trial.pdf"</span><span class="p">),</span><span class="w">
    </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w">

</span><span class="c1"># look up max and min values for complete day to set plot size</span><span class="w">
</span><span class="n">y_min</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="n">trial.data</span><span class="p">)</span><span class="w">
</span><span class="n">y_max</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">trial.data</span><span class="p">)</span><span class="w">

</span><span class="c1"># first initiat the plot with no data, but define the size and labels</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="c1"># plot minimum first</span><span class="w">
     </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Day"</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Inflammation"</span><span class="p">,</span><span class="w"> </span><span class="c1"># axis labels</span><span class="w">
     </span><span class="n">xlim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">40</span><span class="p">),</span><span class="w"> </span><span class="n">ylim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">y_min</span><span class="p">,</span><span class="w"> </span><span class="n">y_max</span><span class="p">))</span><span class="w"> </span><span class="c1"># define plot limits</span><span class="w">

</span><span class="c1"># select colors with the rainbow() function</span><span class="w">
</span><span class="n">col.list</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rainbow</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">inflam.files</span><span class="p">))</span><span class="w">

</span><span class="c1"># now that we have the plot limits set, use another for loop to cycle through &gt; &gt; # and plot each trials inflammation</span><span class="w">
</span><span class="k">for</span><span class="p">(</span><span class="n">i.plot</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">dim</span><span class="p">(</span><span class="n">trial.data</span><span class="p">)[</span><span class="m">1</span><span class="p">])</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1"># index down the number of rows</span><span class="w">
  </span><span class="n">lines</span><span class="p">(</span><span class="n">trial.data</span><span class="p">[</span><span class="n">i.plot</span><span class="p">,],</span><span class="w"> </span><span class="c1"># plot current trial</span><span class="w">
      </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">col.list</span><span class="p">[</span><span class="n">i.plot</span><span class="p">])</span><span class="w"> </span><span class="c1"># choose current color in list</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1"># finalize the PDF file by turning off the graphics device</span><span class="w">
</span><span class="n">dev.off</span><span class="p">()</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>png 
  2 
</code></pre></div>    </div>

    <p>As code becomes more complex, the ways to achieve a given solution multiply. This
is just one solution of many possibilities.</p>
  </blockquote>
</blockquote>

<blockquote class="challenge">
  <h2 id="gathering-data">Gathering data</h2>

  <p>There is interest in examining the inflammation data in a more complete analysis.
To examine effects of treatments across trials, we first need to collect our data
into a single file.</p>

  <p>Gather all of the data from the various inflammation files into a single data frame
with the appropriate labels indicating where each data point originated. Make sure
that your script is robust enough to run on any number of inflammation data files.</p>

  <blockquote class="solution">
    <h2 id="solution-6">Solution</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># First, grab our file list using pattern matching</span><span class="w">
</span><span class="n">inflam.files</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">list.files</span><span class="p">(</span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"data"</span><span class="p">,</span><span class="w"> 
                       </span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"^inflammation-.*.csv$"</span><span class="p">,</span><span class="w">
                       </span><span class="n">full.names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">

</span><span class="c1"># Start the for loop to cycle through the files</span><span class="w">
</span><span class="k">for</span><span class="p">(</span><span class="n">i.file</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">inflam.files</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1"># this time we use a numeric index</span><span class="w">
  </span><span class="c1"># grab file name</span><span class="w">
  </span><span class="n">file.c</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">inflam.files</span><span class="p">[</span><span class="n">i.file</span><span class="p">]</span><span class="w">
  
  </span><span class="c1"># read in the current file</span><span class="w">
  </span><span class="n">inflam.c</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">file.c</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
  
  </span><span class="c1"># name the columns</span><span class="w">
  </span><span class="nf">names</span><span class="p">(</span><span class="n">inflam.c</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="s2">"Inflammation.D"</span><span class="p">,</span><span class="m">1</span><span class="o">:</span><span class="m">40</span><span class="p">)</span><span class="w">
  
  </span><span class="c1"># add columns for Patient ID and Trial ID</span><span class="w">
  </span><span class="n">inflam.c</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cbind</span><span class="p">(</span><span class="n">Patient.ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">60</span><span class="p">,</span><span class="w"> </span><span class="n">Trial.ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i.file</span><span class="p">,</span><span class="w"> </span><span class="n">inflam.c</span><span class="p">)</span><span class="w">
  
  </span><span class="c1"># if this is the first iteration, the combined file is the same as the current file</span><span class="w">
  </span><span class="k">if</span><span class="p">(</span><span class="n">i.file</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">inflam.combined</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">inflam.c</span><span class="w">
  
  </span><span class="c1"># otherwise, add the rows of inflam.c to the growing combined data frame</span><span class="w">
  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">inflam.combined</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rbind</span><span class="p">(</span><span class="n">inflam.combined</span><span class="p">,</span><span class="w"> </span><span class="n">inflam.c</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1"># save file</span><span class="w">
</span><span class="n">write.csv</span><span class="p">(</span><span class="n">inflam.combined</span><span class="p">,</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"data/combined-inflammation.csv"</span><span class="p">,</span><span class="w">
          </span><span class="n">quote</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">row.names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <p>Is there a more efficient way to do this?</p>
  </blockquote>
</blockquote>

<hr />



<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>There are a number of ways to use logical operators, relational operators, and various functions to ask complex and specific questions in the form of <code class="language-plaintext highlighter-rouge">if</code> statements.</p>
</li>
    
    <li><p>Two commone ways to index the <strong>loop variable</strong> in <code class="language-plaintext highlighter-rouge">for</code> loops are to use the form <code class="language-plaintext highlighter-rouge">for(variable in collection)</code> to pull the elements (“variable”) from a vector (“collection”) one at at time, or to use the form <code class="language-plaintext highlighter-rouge">for(i in 1:length(collection))</code> or <code class="language-plaintext highlighter-rouge">for(i in seq_along(collection))</code> to instead pull each index (i.e. location) in a vector one at a time.</p>
</li>
    
    <li><p>Use functions such as <code class="language-plaintext highlighter-rouge">apply</code> instead of <code class="language-plaintext highlighter-rouge">for</code> loops to conduct repeated operates on values contained within defined subsets of a data structure.</p>
</li>
    
    <li><p>Use <code class="language-plaintext highlighter-rouge">list.files(path = "path", pattern = "pattern", full.names = TRUE)</code> to create a list of files whose names match a pattern.</p>
</li>
    
  </ul>
</blockquote>

</article>
















<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="../05-class-decisions-loops/index.html"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="../06-class-distributions/index.html"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>


      
      






<footer>
  <!--<div class="row">
    <div class="col-md-6 copyright" align="left">
	
    </div>
    <div class="col-md-6 help-links" align="right">
	
	
	<a href="/edit//_episodes_rmd/05-oyo-more-decisions-loops.Rmd">Edit on GitHub</a>
	
	
	/
	<a href="/blob//CONTRIBUTING.md">Contributing</a>
	/
	<a href="/">Source</a>
	/
	<a href="/blob//CITATION">Cite</a>
	/
	<a href="mailto:sutphin@gmail.com">Contact</a>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12" align="center">
      Using <a href="https://github.com/carpentries/styles/">The Carpentries style</a>
      version <a href="https://github.com/carpentries/styles/releases/tag/v9.5.3">9.5.3</a>.
    </div>
  </div>-->
</footer>

      
    </div>
    
<script src="../assets/js/jquery.min.js"></script>
<script src="../assets/js/bootstrap.min.js"></script>
<script src="../assets/js/lesson.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-37305346-2', 'auto');
  ga('send', 'pageview');
</script>
<!--<script type="text/javascript"
  src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>-->
<script type="text/javascript"
src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

  </body>
</html>
