















<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="last-modified" content="2024-08-15 20:50:19 -0700">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- meta "search-domain" used for google site search function google_search() -->
    <meta name="search-domain" value="">
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/lesson.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/syntax.css" />

    



    <!-- Favicons for everyone -->
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="../assets/favicons/mcb585/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/favicons/mcb585/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/favicons/mcb585/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/favicons/mcb585/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="../assets/favicons/mcb585/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="../assets/favicons/mcb585/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="../assets/favicons/mcb585/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../assets/favicons/mcb585/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="../assets/favicons/mcb585/favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="../assets/favicons/mcb585/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="../assets/favicons/mcb585/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="../assets/favicons/mcb585/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="../assets/favicons/mcb585/favicon-128.png" sizes="128x128" />
    <meta name="application-name" content=" - MCB 585: Multidisciplinary/Quantitative Approaches to Solving Biological Problems"/>
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="../assets/favicons/mcb585/mstile-144x144.png" />
    <meta name="msapplication-square70x70logo" content="../assets/favicons/mcb585/mstile-70x70.png" />
    <meta name="msapplication-square150x150logo" content="../assets/favicons/mcb585/mstile-150x150.png" />
    <meta name="msapplication-wide310x150logo" content="../assets/favicons/mcb585/mstile-310x150.png" />
    <meta name="msapplication-square310x310logo" content="../assets/favicons/mcb585/mstile-310x310.png" />


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->
    <title>MCB 585: Multidisciplinary/Quantitative Approaches to Solving Biological Problems: Advanced Data Manipulation and Plotting</title>
  </head>
  <body>

    



    <div class="container">
      






<nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      
      
      <a href="https://georgesutphin.github.io/MCB585/" class="pull-left">
        <img class="navbar-logo" src="../assets/img/mcb585-logo.svg" alt="MCB585 logo" />
      </a>
      

      
      <a class="navbar-brand" href="../">Home</a>

    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">

	
        <li><a href="../CODE_OF_CONDUCT.html">Code of Conduct</a></li>

        
	
        <li><a href="../setup.html">Setup</a></li>

        
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Episodes <span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            <li><a href="../01-class-introduction/index.html">Getting started with R and RStudio</a></li>
            
            <li><a href="../01-oyo-introduction/index.html">Getting started with R and RStudio -- Additional Detail</a></li>
            
            <li><a href="../02-class-R-data-types-structures/index.html">Basic Data Types and Data Structures in R</a></li>
            
            <li><a href="../02-oyo-R-data-types-in-depth/index.html">R Data Types -- In-Depth</a></li>
            
            <li><a href="../03-class-data-frames/index.html">Data Frames, Basic Indexing, Reading/Writing Data</a></li>
            
            <li><a href="../03-oyo-Lists/index.html">Lists and Advanced Indexing</a></li>
            
            <li><a href="../04-class-manipulating-plotting-data/index.html">Manipulating and Plotting Data</a></li>
            
            <li><a href="../04-oyo-advanced-data-manipulation/index.html">Advanced Data Manipulation and Plotting</a></li>
            
            <li><a href="../05-class-decisions-loops/index.html">Decision Making and Loops</a></li>
            
            <li><a href="../05-oyo-more-decisions-loops/index.html">Decision Making and Loops -- Additional Detail</a></li>
            
            <li><a href="../06-class-distributions/index.html">Distributions and Normality</a></li>
            
            <li><a href="../06-oyo-more-distributions/index.html">Distributions and Normality -- Additional Detail</a></li>
            
            <li><a href="../07-class-hypothesis-testing/index.html">Hypothesis Testing</a></li>
            
            <li><a href="../07-oyo-multiple-test-correction/index.html">Multiple Test Correction</a></li>
            
            <li><a href="../08-class-survival-analysis/index.html">Survival Analysis</a></li>
            
            <li><a href="../08-oyo-advanced-survival-analysis/index.html">Advanced Survival Analysis</a></li>
            
            <li><a href="../09-class-power-analysis/index.html">Power Analysis</a></li>
            
            <li><a href="../09-oyo-simulation/index.html">Simulating Experiments</a></li>
            
            <li><a href="../99-projects/index.html">Final Projects</a></li>
            
	    <li role="separator" class="divider"></li>
            <li><a href="../aio.html">All in one page (Beta)</a></li>
          </ul>
        </li>
	

	
	<!--
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Extras <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../reference.html">Reference</a></li>
            
            <li><a href="../about/">About</a></li>
            
            <li><a href="../discuss/">Discussion</a></li>
            
            <li><a href="../figures/">Figures</a></li>
            
            <li><a href="../guide/">Instructor Notes</a></li>
            
          </ul>
        </li>
	-->

	
        <li><a href="../LICENSE.html">About</a></li>
	<!--
	
	<li><a href="/edit//_episodes_rmd/04-oyo-advanced-data-manipulation.Rmd">Improve this page <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a></li>
	
	-->
      </ul>
      <form class="navbar-form navbar-right" role="search" id="search" onsubmit="google_search(); return false;">
        <div class="form-group">
          <input type="text" id="google-search" placeholder="Search..." aria-label="Google site search">
        </div>
      </form>
    </div>
  </div>
</nav>

















<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="../04-class-manipulating-plotting-data/index.html"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
    <h3 class="maintitle"><a href="../">MCB 585: Multidisciplinary/Quantitative Approaches to Solving Biological Problems</a></h3>
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="../05-class-decisions-loops/index.html"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>

<article>
<div class="row">
  <div class="col-md-1">
  </div>
  <div class="col-md-10">
    <h1 class="maintitle">Advanced Data Manipulation and Plotting</h1>
  </div>
  <div class="col-md-1">
  </div>
</div>


<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Class Date:</strong> 9/5/2023 -- On Your Own
      <br/>
      <strong>Teaching:</strong> 90 min
      <br/>
      <strong>Exercises:</strong> 30 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>How do I rapidly calculate statistics based on relevant variables in a dataset?</p>
</li>
	
	<li><p>How to I begin to build more complex graphics?</p>
</li>
	
	<li><p>What tools are available for generating publication quality graphics in R?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Use pre-build functions like <code class="language-plaintext highlighter-rouge">rowSums()</code> to perform specific operations on data frame elements.</p>
</li>
	
	<li><p>Use the <code class="language-plaintext highlighter-rouge">apply()</code> function to rapidly apply general functions across rows or columns of a data frame.</p>
</li>
	
	<li><p>Use the <code class="language-plaintext highlighter-rouge">aggregate()</code> function to rapidly segregate dependent variables of interest by one or mor indpendent variables and calculate useful descriptive statistics.</p>
</li>
	
	<li><p>Locate and employ tools in R base graphics to generate custom graphics.</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<hr />
<h2 id="on-your-own">On Your Own</h2>

<h3 id="advanced-data-manipulation">Advanced Data Manipulation</h3>

<p><em>In Class</em> we covered a few of the basic functions for calculating descriptive statistics. Here we will examine a few techniques for using these functions more efficiently across data sets.</p>

<p> </p>
<h4 id="the-apply-function">The <code class="language-plaintext highlighter-rouge">apply()</code> function</h4>

<p>To start, let’s reload the aneurisms dataset that we were using <em>In Class</em>, and specifically the version with the gender capitalization corrected:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s2">"data/sample-gendercorrected.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">stringsAsFactors</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p> </p>

<p>In this dataset, we have aneurism counts in patient eyes at four time points. What if our phenotype of interest is the maximum number of aneurisms across quarters for each patient, or perhaps the average across quarters? How do we calculate these values efficiently for each patient. We want to perform the repeat the same operation across a <code class="language-plaintext highlighter-rouge">margin</code> of the data frame (in this case a each row, but it can similarly apply to columns):</p>

<p><img src="../fig/r-operations-across-margins.svg" alt="Operations Across Margins" /></p>

<p> </p>

<p>In particular, we want to perform the functions <code class="language-plaintext highlighter-rouge">max()</code> or <code class="language-plaintext highlighter-rouge">mean()</code> on the last 4 columns of every row. To support this, we can use the <code class="language-plaintext highlighter-rouge">apply()</code> function.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">?</span><span class="n">apply</span><span class="w">
</span></code></pre></div></div>

<p> </p>

<p><code class="language-plaintext highlighter-rouge">apply()</code> allows us to repeat a function on each of the rows (<code class="language-plaintext highlighter-rouge">MARGIN = 1</code>) or columns (<code class="language-plaintext highlighter-rouge">MARGIN = 2</code>) of a data frame. To obtain the maximum or average inflammation of each patient we will need to calculate the <code class="language-plaintext highlighter-rouge">max</code> or <code class="language-plaintext highlighter-rouge">mean</code> of all of the rows (<code class="language-plaintext highlighter-rouge">MARGIN = 1</code>) of the relevant subset of the <code class="language-plaintext highlighter-rouge">dat</code> data frame. Let’s start with mean:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">avg_aneurisms_subject</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">apply</span><span class="p">(</span><span class="n">dat</span><span class="p">[,</span><span class="m">6</span><span class="o">:</span><span class="m">9</span><span class="p">],</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="p">)</span><span class="w">
</span><span class="n">avg_aneurisms_subject</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  [1] 173.25 213.25 186.50 198.00 189.50 285.00 158.00 246.00 196.25 177.25
 [11] 189.75 224.25 188.00 156.25 187.00 169.75 178.75 213.25 168.75 170.00
 [21] 180.00 133.50 230.25 225.00 187.50 165.25 246.50 187.25 126.25 174.50
 [31] 169.75 173.00 207.00 188.25 172.50 164.50 236.75 252.25 167.00 242.50
 [41] 191.25 156.50 179.75 180.50 148.50 260.25 184.50 177.50 187.50 193.00
 [51] 168.25 158.00 189.50 236.25 184.50 188.00 188.75 230.00 166.75 123.25
 [61] 201.50 194.50 195.50 163.75 256.25 185.50 232.00 164.50 224.25 136.75
 [71] 215.00 182.50 188.50 165.25 241.25 230.75 191.25 196.50 191.00 192.50
 [81] 227.00 153.00 182.00 237.00 185.25 210.00 153.50 199.25 159.50 152.00
 [91] 236.75 256.00 183.50 166.25 148.25 168.50 233.00 152.25 230.75 143.00
</code></pre></div></div>

<p> </p>

<p>Each element in the <code class="language-plaintext highlighter-rouge">avg_aneurisms_subject</code> vector is the mean of the four values in the <code class="language-plaintext highlighter-rouge">Aneurisms_q1</code>, <code class="language-plaintext highlighter-rouge">Aneurisms_q2</code>, <code class="language-plaintext highlighter-rouge">Aneurisms_q3</code>, and <code class="language-plaintext highlighter-rouge">Aneurisms_q4</code> columns for the corresponding row in the <code class="language-plaintext highlighter-rouge">dat</code> data frame. Note that the length of this vector is the same as the number of rows in the <code class="language-plaintext highlighter-rouge">dat</code> data frame:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">length</span><span class="p">(</span><span class="n">avg_aneurisms_subject</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 100
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">dim</span><span class="p">(</span><span class="n">dat</span><span class="p">)[</span><span class="m">1</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 100
</code></pre></div></div>

<p> </p>

<p>A convenient way to associated this data with the corresponding patient is to directly add the calculated data to the data frame in a new column instead of assigning it to a separate vector:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dat</span><span class="o">$</span><span class="n">Aneurisms_avg</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">apply</span><span class="p">(</span><span class="n">dat</span><span class="p">[,</span><span class="m">6</span><span class="o">:</span><span class="m">9</span><span class="p">],</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p> </p>

<p>By changing to <code class="language-plaintext highlighter-rouge">MARGIN = 2</code> (calculate across columns), we ask a different question, namely what is the average number of aneurisms across patients for each quarter:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">avg_aneurisms_quarter</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">apply</span><span class="p">(</span><span class="n">dat</span><span class="p">[,</span><span class="m">6</span><span class="o">:</span><span class="m">9</span><span class="p">],</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="p">)</span><span class="w">
</span><span class="n">avg_aneurisms_quarter</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Aneurisms_q1 Aneurisms_q2 Aneurisms_q3 Aneurisms_q4 
      158.84       168.03       219.85       217.94 
</code></pre></div></div>

<p> </p>

<blockquote class="challenge">
  <h2 id="maximum-aneurisms">Maximum aneurisms</h2>

  <p>Determine the maximum and total number of aneurisms for each patient and add these values to the data frame. Save the results to a new file called “sample-processed.csv”.</p>

  <blockquote class="solution">
    <h2 id="solution">Solution</h2>

    <p>First calculate the relevant descriptive statistics and add them directly to the <code class="language-plaintext highlighter-rouge">dat</code> data frame using the <code class="language-plaintext highlighter-rouge">apply</code> function.</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dat</span><span class="o">$</span><span class="n">Aneurisms_max</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">apply</span><span class="p">(</span><span class="n">dat</span><span class="p">[,</span><span class="m">6</span><span class="o">:</span><span class="m">9</span><span class="p">],</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">max</span><span class="p">)</span><span class="w">
</span><span class="n">dat</span><span class="o">$</span><span class="n">Aneurisms_total</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">apply</span><span class="p">(</span><span class="n">dat</span><span class="p">[,</span><span class="m">6</span><span class="o">:</span><span class="m">9</span><span class="p">],</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">sum</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <p>Check the output:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">head</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      ID Gender      Group BloodPressure  Age Aneurisms_q1 Aneurisms_q2
1 Sub001      M    Control           132 16.0          114          140
2 Sub002      M Treatment2           139 17.2          148          209
3 Sub003      M Treatment2           130 19.5          196          251
4 Sub004      F Treatment1           105 15.7          199          140
5 Sub005      M Treatment1           125 19.9          188          120
6 Sub006      M Treatment2           112 14.3          260          266
  Aneurisms_q3 Aneurisms_q4 Aneurisms_avg Aneurisms_max Aneurisms_total
1          202          237        173.25           237             693
2          248          248        213.25           248             853
3          122          177        186.50           251             746
4          233          220        198.00           233             792
5          222          228        189.50           228             758
6          320          294        285.00           320            1140
</code></pre></div>    </div>

    <p>And save the final file using <code class="language-plaintext highlighter-rouge">write.csv()</code>:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">write.csv</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"data/sample-processed.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">row.names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">F</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>
  </blockquote>
</blockquote>

<p> </p>

<blockquote class="callout">
  <h2 id="argument-order-in-functions">Argument Order in Functions</h2>

  <p>Notice that we did not specify the argument names in <code class="language-plaintext highlighter-rouge">apply()</code>. Looking at the help file, the argument
order is <code class="language-plaintext highlighter-rouge">X</code> (indicating the input data), then <code class="language-plaintext highlighter-rouge">MARGIN</code>, then <code class="language-plaintext highlighter-rouge">FUN</code> (for function to apply). So long as you
enter arguments in the requested order, you do not need to be explicitly about which argument you are
referring too. <code class="language-plaintext highlighter-rouge">apply()</code> just assumes that the first argument entered is the value for <code class="language-plaintext highlighter-rouge">X</code>, the second is the &gt; value for <code class="language-plaintext highlighter-rouge">MARGIN</code>, and the third is the value for <code class="language-plaintext highlighter-rouge">FUN</code>. You can mix up the order, but then you have to be
explicit about which argument you are defining.</p>

  <p>For example, this will return an error:</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">avg_aneurisms_subject</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">apply</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">dat</span><span class="p">[,</span><span class="m">6</span><span class="o">:</span><span class="m">9</span><span class="p">])</span><span class="w">
</span></code></pre></div>  </div>

  <p>while this will be interpreted identically to the earlier function call:</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">avg_aneurisms_subject</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">apply</span><span class="p">(</span><span class="n">FUN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">,</span><span class="w"> </span><span class="n">MARGIN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dat</span><span class="p">[,</span><span class="m">6</span><span class="o">:</span><span class="m">9</span><span class="p">])</span><span class="w">
</span></code></pre></div>  </div>
</blockquote>

<p> </p>

<p> </p>

<blockquote class="callout">
  <h2 id="efficient-alternatives">Efficient Alternatives</h2>

  <p>Some common operations have more efficient alternatives. For example, you
can calculate the row-wise or column-wise means with <code class="language-plaintext highlighter-rouge">rowMeans()</code> and
<code class="language-plaintext highlighter-rouge">colMeans()</code>, respectively. Similarly for <code class="language-plaintext highlighter-rouge">rowSums()</code> and <code class="language-plaintext highlighter-rouge">colSums()</code>.</p>
</blockquote>

<p> </p>
<h4 id="aggregating-data">Aggregating data</h4>

<p>Looking at summary statistics of the entire data set is great, but usually we are more interested in comparing these statistics across groups. R has a function called <code class="language-plaintext highlighter-rouge">aggregate()</code> that lets you apply a function (or more than one function) to a dependent variable (or more than one dependent variable) with the data separated by one or more independent variables.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">?</span><span class="n">aggregate</span><span class="w">
</span></code></pre></div></div>

<p> </p>

<p>As with the <code class="language-plaintext highlighter-rouge">boxplot()</code> function, <code class="language-plaintext highlighter-rouge">aggregate()</code> uses formula notation. To get a feel for how the function operates, let’s calculate the <code class="language-plaintext highlighter-rouge">mean()</code> of our newly calculated average aneurisms variable, broken down by treatment group. <code class="language-plaintext highlighter-rouge">aggregate()</code> requires three arguments: (1) the formula that defines how the data should be broken down, (2) the data to be used, and (3) the function that you would like to perform:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mean_by_group</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">aggregate</span><span class="p">(</span><span class="n">Aneurisms_avg</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Group</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">FUN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">)</span><span class="w">
</span><span class="n">mean_by_group</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>       Group Aneurisms_avg
1    Control      170.1083
2 Treatment1      175.9857
3 Treatment2      224.3929
</code></pre></div></div>

<p> </p>

<p>Great! <code class="language-plaintext highlighter-rouge">aggregate()</code> selected the subset of <code class="language-plaintext highlighter-rouge">Aneurisms_avg</code> values for each treatment group and returned the mean. What if we also want to see the breakdown by Gender?</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mean_by_group_gender</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">aggregate</span><span class="p">(</span><span class="n">Aneurisms_avg</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Group</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Gender</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">FUN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">)</span><span class="w">
</span><span class="n">mean_by_group_gender</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>       Group Gender Aneurisms_avg
1    Control      F      172.8214
2 Treatment1      F      182.6667
3 Treatment2      F      229.5385
4    Control      M      167.7344
5 Treatment1      M      172.5000
6 Treatment2      M      221.3523
</code></pre></div></div>

<p> </p>

<p>So far so good. Now, what if we wean to calculate more than just the mean? Maybe standard deviation to examin variability as well? This makes things a bit more complicated, but <code class="language-plaintext highlighter-rouge">aggregate()</code> is up to the task. First, <code class="language-plaintext highlighter-rouge">aggregate()</code> can technically only take one “input” function. However, we can get around this by defining our own input <code class="language-plaintext highlighter-rouge">function()</code> on the fly that includes multiple sub-functions combined using the <code class="language-plaintext highlighter-rouge">c()</code> function:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">avg_aneurisms_summary</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">aggregate</span><span class="p">(</span><span class="n">Aneurisms_avg</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Group</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Gender</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dat</span><span class="p">,</span><span class="w"> 
    </span><span class="n">FUN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span><span class="w"> 
</span><span class="n">avg_aneurisms_summary</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>       Group Gender Aneurisms_avg.1 Aneurisms_avg.2
1    Control      F       172.82143        22.85519
2 Treatment1      F       182.66667        13.72056
3 Treatment2      F       229.53846        20.05717
4    Control      M       167.73438        19.01523
5 Treatment1      M       172.50000        17.57581
6 Treatment2      M       221.35227        29.26873
</code></pre></div></div>

<p> </p>

<p>Now, this new object <code class="language-plaintext highlighter-rouge">avg_aneurisms_summary</code> looks like a standard <strong>data frame</strong> on the surface, and even claims to be one:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">class</span><span class="p">(</span><span class="n">avg_aneurisms_summary</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "data.frame"
</code></pre></div></div>

<p> </p>

<p>However, if you actually look at the structure there is something odd going on:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">str</span><span class="p">(</span><span class="n">avg_aneurisms_summary</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>'data.frame':	6 obs. of  3 variables:
 $ Group        : chr  "Control" "Treatment1" "Treatment2" "Control" ...
 $ Gender       : chr  "F" "F" "F" "M" ...
 $ Aneurisms_avg: num [1:6, 1:2] 173 183 230 168 172 ...
</code></pre></div></div>

<p> </p>

<p>Instead of creating separate columns for the calculated <code class="language-plaintext highlighter-rouge">mean()</code> and <code class="language-plaintext highlighter-rouge">sd()</code> values, <code class="language-plaintext highlighter-rouge">aggregate()</code> made those values columns of a <strong>numeric matrix</strong> and assigned that <strong>matrix</strong> to a single “column” of the data frame:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># This doesn't actually contain any information:</span><span class="w">
</span><span class="n">avg_aneurisms_summary</span><span class="o">$</span><span class="n">Aneurisms_avg.1</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>NULL
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># While this contaims a matrix (rather than a vector)</span><span class="w">
</span><span class="n">avg_aneurisms_summary</span><span class="o">$</span><span class="n">Aneurisms_avg</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>         [,1]     [,2]
[1,] 172.8214 22.85519
[2,] 182.6667 13.72056
[3,] 229.5385 20.05717
[4,] 167.7344 19.01523
[5,] 172.5000 17.57581
[6,] 221.3523 29.26873
</code></pre></div></div>

<p> </p>

<p>To fix this odd formating, we can use the function <code class="language-plaintext highlighter-rouge">do.call()</code> to convert the “matrix-within-a-data-frame” into a normal data frame, and then fix the column names to make them meaningful. We can actually just do this all in one step from the beginning:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># first run the aggregate function with do.call</span><span class="w">
</span><span class="n">avg_aneurisms_summary</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">do.call</span><span class="p">(</span><span class="n">data.frame</span><span class="p">,</span><span class="w"> 
                     </span><span class="n">aggregate</span><span class="p">(</span><span class="n">Aneurisms_avg</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Group</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Gender</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dat</span><span class="p">,</span><span class="w">                      </span><span class="n">FUN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">x</span><span class="p">))))</span><span class="w"> 

</span><span class="c1"># check the baseline names of the output (not helpful!)</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">avg_aneurisms_summary</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "Group"           "Gender"          "Aneurisms_avg.1" "Aneurisms_avg.2"
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># correct the names of the newly created variables to reflect the functions that </span><span class="w">
</span><span class="c1"># were used to generate them</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">avg_aneurisms_summary</span><span class="p">)[</span><span class="nf">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">)]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Aneurisms_avg_mean"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Aneurisms_avg_sd"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Now check out the structure. This looks more like what we might have first expected</span><span class="w">
</span><span class="n">avg_aneurisms_summary</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>       Group Gender Aneurisms_avg_mean Aneurisms_avg_sd
1    Control      F           172.8214         22.85519
2 Treatment1      F           182.6667         13.72056
3 Treatment2      F           229.5385         20.05717
4    Control      M           167.7344         19.01523
5 Treatment1      M           172.5000         17.57581
6 Treatment2      M           221.3523         29.26873
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">str</span><span class="p">(</span><span class="n">avg_aneurisms_summary</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>'data.frame':	6 obs. of  4 variables:
 $ Group             : chr  "Control" "Treatment1" "Treatment2" "Control" ...
 $ Gender            : chr  "F" "F" "F" "M" ...
 $ Aneurisms_avg_mean: num  173 183 230 168 172 ...
 $ Aneurisms_avg_sd  : num  22.9 13.7 20.1 19 17.6 ...
</code></pre></div></div>

<p> </p>

<p>Finally, we will often want to apply the same set of functions to multiple dependent variables. To tie this all together, let’s calculate the same <code class="language-plaintext highlighter-rouge">mean()</code> and <code class="language-plaintext highlighter-rouge">sd()</code> for both <code class="language-plaintext highlighter-rouge">Aneurisms_avg</code> and <code class="language-plaintext highlighter-rouge">Aneurisms_total</code>. Do do this, we need to add an additional dependent variable to our <code class="language-plaintext highlighter-rouge">formula</code> notation, and bind them together using the <code class="language-plaintext highlighter-rouge">cbind()</code> function:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># First calculate the statistics using aggregate() and convert the output to a</span><span class="w">
</span><span class="c1"># standard data frame using do.call()</span><span class="w">
</span><span class="n">aneurisms_summary</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">do.call</span><span class="p">(</span><span class="n">data.frame</span><span class="p">,</span><span class="w"> 
                             </span><span class="n">aggregate</span><span class="p">(</span><span class="n">cbind</span><span class="p">(</span><span class="n">Aneurisms_avg</span><span class="p">,</span><span class="w"> </span><span class="n">Aneurisms_total</span><span class="p">)</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Group</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Gender</span><span class="p">,</span><span class="w"> 
                                       </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dat</span><span class="p">,</span><span class="w"> 
                                       </span><span class="n">FUN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">x</span><span class="p">))))</span><span class="w"> 

</span><span class="c1"># don't forget to correct the column names to something more meaningfule </span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">aneurisms_summary</span><span class="p">)[</span><span class="m">3</span><span class="o">:</span><span class="m">6</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Aneurisms_avg_mean"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Aneurisms_avg_sd"</span><span class="p">,</span><span class="w">
                                          </span><span class="s2">"Aneurisms_total_mean"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Aneurisms_total_sd"</span><span class="p">)</span><span class="w">

</span><span class="c1"># ... and take a look at the results</span><span class="w">
</span><span class="n">aneurisms_summary</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>       Group Gender Aneurisms_avg_mean Aneurisms_avg_sd Aneurisms_total_mean
1    Control      F           172.8214         22.85519             691.2857
2 Treatment1      F           182.6667         13.72056             730.6667
3 Treatment2      F           229.5385         20.05717             918.1538
4    Control      M           167.7344         19.01523             670.9375
5 Treatment1      M           172.5000         17.57581             690.0000
6 Treatment2      M           221.3523         29.26873             885.4091
  Aneurisms_total_sd
1           91.42078
2           54.88224
3           80.22868
4           76.06091
5           70.30324
6          117.07493
</code></pre></div></div>

<p> </p>

<p>Using the <code class="language-plaintext highlighter-rouge">aggregate()</code> function to it’s full potential is, admittedly, a bit convoluted. If you don’t quite get all of the detail, especially how to format and deal with the output of a multiple-dependent-variable, multiple-independent-variable, multiple-function <code class="language-plaintext highlighter-rouge">aggregate()</code> call, that’s okay. The goal here is to demonstrate that what is possible with the basic functions available in R. Even the basic single-function <code class="language-plaintext highlighter-rouge">aggregate()</code> can be really useful in speeding up data processing. Start there and work you way up.</p>

<p> </p>
<h4 id="additional-data-manipulation-exercises">Additional Data Manipulation Exercises</h4>

<blockquote class="challenge">
  <h2 id="subsetting-more-data">Subsetting More Data</h2>

  <p>Suppose you want to determine the maximum number of aneurisms for subject 5 across quarters two to four.
To do this you would extract the relevant subset from the data frame and calculate the maximum value.
Which of the following lines of R code gives the correct answer?</p>

  <ol>
    <li><code class="language-plaintext highlighter-rouge">max(dat[5, ])</code></li>
    <li><code class="language-plaintext highlighter-rouge">max(dat[7:9, 5])</code></li>
    <li><code class="language-plaintext highlighter-rouge">max(dat[5, 7:9])</code></li>
    <li><code class="language-plaintext highlighter-rouge">max(dat[5, 7, 9])</code></li>
  </ol>

  <blockquote class="solution">
    <h2 id="solution-1">Solution</h2>

    <p>Answer: 3</p>

    <p>Explanation: You want to extract the part of the data frame representing data for patient 5 from quarter two (column 7) to quarter 4 (column 9). In this data frame, patient data is organised in rows and the days are represented by the columns. Subscripting in R follows the <code class="language-plaintext highlighter-rouge">[i, j]</code> principle, where <code class="language-plaintext highlighter-rouge">i = rows</code> and <code class="language-plaintext highlighter-rouge">j = columns</code>. Thus, answer 3 is correct since the patient is represented by the value for i (5) and the days are represented by the values in j, which is a subset spanning day 9 to 7.</p>

  </blockquote>
</blockquote>

<p> </p>

<blockquote class="challenge">
  <h2 id="subsetting-and-re-assignment">Subsetting and Re-Assignment</h2>

  <p>Using the data frame <code class="language-plaintext highlighter-rouge">dat</code> from above:
Let’s pretend there was something wrong with the instrument on the first two quarters for every second patient (subjects 2, 4, 6, etc.), which resulted in the measurements being twice as large as they should be.</p>

  <ol>
    <li>Write a vector containing each affected patient (hint: <code class="language-plaintext highlighter-rouge">?seq</code>).</li>
    <li>Create a new data frame in which you halve the first two quarters’ values in only those patients.</li>
    <li>Print out the corrected data frame to check that your code has fixed the problem.</li>
  </ol>

  <blockquote class="solution">
    <h2 id="solution-2">Solution</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">whichPatients</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="nf">dim</span><span class="p">(</span><span class="n">dat</span><span class="p">)[</span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="c1"># i.e., which rows</span><span class="w">
</span><span class="n">whichQuarters</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="m">6</span><span class="p">,</span><span class="m">7</span><span class="p">)</span><span class="w">         </span><span class="c1"># i.e., which columns indicates quarters 1 and 2; you could also use c(6,7) or 6:7</span><span class="w">
</span><span class="n">dat2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dat</span><span class="w"> </span><span class="c1"># make a copy of the original data</span><span class="w">
</span><span class="c1"># check the size of your subset: returns `30 5`, that is 30 [rows=patients] by 5 [columns=quarters]</span><span class="w">
</span><span class="nf">dim</span><span class="p">(</span><span class="n">dat2</span><span class="p">[</span><span class="n">whichPatients</span><span class="p">,</span><span class="w"> </span><span class="n">whichQuarters</span><span class="p">])</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 50  2
</code></pre></div>    </div>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dat2</span><span class="p">[</span><span class="n">whichPatients</span><span class="p">,</span><span class="w"> </span><span class="n">whichQuarters</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dat</span><span class="p">[</span><span class="n">whichPatients</span><span class="p">,</span><span class="w"> </span><span class="n">whichQuarters</span><span class="p">]</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">2</span><span class="w">
</span><span class="n">dat2</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        ID Gender      Group BloodPressure  Age Aneurisms_q1 Aneurisms_q2
1   Sub001      M    Control           132 16.0        114.0        140.0
2   Sub002      M Treatment2           139 17.2         74.0        104.5
3   Sub003      M Treatment2           130 19.5        196.0        251.0
4   Sub004      F Treatment1           105 15.7         99.5         70.0
5   Sub005      M Treatment1           125 19.9        188.0        120.0
6   Sub006      M Treatment2           112 14.3        130.0        133.0
7   Sub007      F    Control           173 17.7        135.0         98.0
8   Sub008      M Treatment2           108 19.8        108.0        119.0
9   Sub009      M Treatment2           131 19.4        117.0        215.0
10  Sub010      F    Control           129 18.8         94.0         72.0
11  Sub011      M Treatment1           126 14.8        134.0        155.0
12  Sub012      F Treatment2            96 15.3         76.0         88.5
13  Sub013      F    Control            77 16.5        112.0        220.0
14  Sub014      M    Control           158 12.6         54.5         75.0
15  Sub015      M    Control            81 14.3        146.0        140.0
16  Sub016      M    Control           137 15.9         48.5         86.0
17  Sub017      F Treatment1           147 18.4        165.0        157.0
18  Sub018      M Treatment2           130 18.3         79.0        132.5
19  Sub019      M Treatment1           105 15.4        178.0        109.0
20  Sub020      F Treatment1            92 14.3         53.5         94.0
21  Sub021      F    Control           111 12.7        174.0        160.0
22  Sub022      M Treatment1           122 15.4         48.5         55.0
23  Sub023      F Treatment2            97 17.2        187.0        239.0
24  Sub024      F Treatment2           118 17.3         94.0         95.5
25  Sub025      M Treatment1            82 16.7        114.0        199.0
26  Sub026      M Treatment1           123 19.6         57.5         80.0
27  Sub027      M Treatment2           126 15.0        128.0        249.0
28  Sub028      F Treatment1            94 16.1         56.0        115.0
29  Sub029      M    Control           135 17.6        136.0        109.0
30  Sub030      F    Control           108 18.6         51.5         74.0
31  Sub031      F Treatment1           133 18.3        132.0        151.0
32  Sub032      M Treatment1           108 16.7         59.0         77.0
33  Sub033      M Treatment2           122 12.5        166.0        176.0
34  Sub034      M Treatment1           134 14.3         76.0         52.5
35  Sub035      M Treatment1           145 19.7        191.0        148.0
36  Sub036      F    Control           133 17.6         76.0         89.0
37  Sub037      F Treatment2            90 17.0        161.0        270.0
38  Sub038      M Treatment2           118 12.2        119.5         92.0
39  Sub039      M Treatment1           113 15.1        132.0        137.0
40  Sub040      M Treatment2           115 17.7         84.0        127.5
41  Sub041      F Treatment1           142 19.0        140.0        184.0
42  Sub042      M Treatment1           114 14.7         83.0         42.5
43  Sub043      M    Control           139 15.2        141.0        160.0
44  Sub044      M Treatment1            90 15.3         80.5         84.0
45  Sub045      F    Control           126 12.9        103.0        111.0
46  Sub046      F Treatment2           109 18.4        115.5        120.0
47  Sub047      M    Control           125 18.1        192.0        141.0
48  Sub048      M    Control            99 15.6         89.0         90.0
49  Sub049      M    Control           122 19.5        167.0        123.0
50  Sub050      M Treatment1           111 13.5         67.5         75.0
51  Sub051      M Treatment2           109 13.5        150.0        166.0
52  Sub052      F Treatment1           134 13.7         96.0         40.0
53  Sub053      F Treatment1           113 18.7        153.0        153.0
54  Sub054      F Treatment2           105 12.2        102.5        132.0
55  Sub055      M Treatment2           125 16.9        117.0        194.0
56  Sub056      F Treatment2           123 19.5         99.5         59.5
57  Sub057      M    Control           155 12.1        182.0        129.0
58  Sub058      M Treatment2           117 17.0         90.0         98.0
59  Sub059      M Treatment1           116 19.2        111.0        111.0
60  Sub060      F    Control           133 14.7         50.5         49.0
61  Sub061      F    Control            94 20.0        166.0        167.0
62  Sub062      F Treatment2           106 14.1         79.0         85.5
63  Sub063      F Treatment1           144 14.7        189.0        178.0
64  Sub064      M Treatment1           149 16.6         94.5         50.5
65  Sub065      F Treatment2           108 15.0        239.0        189.0
66  Sub066      M Treatment1           116 15.0         92.5        112.0
67  Sub067      F Treatment2           136 13.8        224.0        112.0
68  Sub068      F    Control            98 14.8         52.0         69.5
69  Sub069      M Treatment2           148 19.1        222.0        199.0
70  Sub070      M    Control            74 18.9         53.5         49.0
71  Sub071      M Treatment2           147 17.7        153.0        255.0
72  Sub072      M    Control           116 17.4         59.0         82.5
73  Sub073      F Treatment1           133 15.5        102.0        184.0
74  Sub074      M    Control            97 13.1         94.0         62.5
75  Sub075      M Treatment2           132 12.2        180.0        283.0
76  Sub076      F Treatment2           153 17.0         89.0        107.0
77  Sub077      M Treatment1           151 17.7        168.0        184.0
78  Sub078      M Treatment1           121 19.5         59.0         85.0
79  Sub079      M Treatment1           116 19.5        169.0        114.0
80  Sub080      F    Control           104 12.8         78.0         69.0
81  Sub081      M Treatment2           111 17.6        232.0        211.0
82  Sub082      M Treatment1            62 17.7         94.0         54.0
83  Sub083      M Treatment2           124 14.2        169.0        168.0
84  Sub084      M Treatment2           124 19.2        120.5        116.5
85  Sub085      M Treatment2           109 16.0         65.0        207.0
86  Sub086      F    Control           117 15.2        112.5         92.5
87  Sub087      F    Control            90 17.6        104.0        116.0
88  Sub088      F Treatment1           158 17.6         89.5         79.0
89  Sub089      M Treatment1           113 15.1        103.0        140.0
90  Sub090      M    Control           150 17.8         56.0         65.0
91  Sub091      F Treatment2           115 16.2        226.0        170.0
92  Sub092      M Treatment2            83 16.6        114.0        110.5
93  Sub093      F    Control           116 19.1        209.0        142.0
94  Sub094      F Treatment1           141 17.2         76.5         52.0
95  Sub095      M    Control           108 13.6        111.0        118.0
96  Sub096      M    Control           102 14.6         74.0         66.0
97  Sub097      F Treatment2            90 19.6        141.0        196.0
98  Sub098      M Treatment1           133 17.0         96.5         56.0
99  Sub099      M Treatment2            83 16.2        130.0        226.0
100 Sub100      M Treatment1           122 18.4         63.0         78.5
    Aneurisms_q3 Aneurisms_q4 Aneurisms_avg Aneurisms_max Aneurisms_total
1            202          237        173.25           237             693
2            248          248        213.25           248             853
3            122          177        186.50           251             746
4            233          220        198.00           233             792
5            222          228        189.50           228             758
6            320          294        285.00           320            1140
7            154          245        158.00           245             632
8            279          251        246.00           279             984
9            181          272        196.25           272             785
10           192          185        177.25           192             709
11           247          223        189.75           247             759
12           323          245        224.25           323             897
13           225          195        188.00           225             752
14           177          189        156.25           189             625
15           239          223        187.00           239             748
16           203          207        169.75           207             679
17           200          193        178.75           200             715
18           243          187        213.25           265             853
19           206          182        168.75           206             675
20           167          218        170.00           218             680
21           203          183        180.00           203             720
22           194          133        133.50           194             534
23           281          214        230.25           281             921
24           256          265        225.00           265             900
25           242          195        187.50           242             750
26           158          228        165.25           228             661
27           294          315        246.50           315             986
28           281          126        187.25           281             749
29           105          155        126.25           155             505
30           219          228        174.50           228             698
31           234          162        169.75           234             679
32           260          160        173.00           260             692
33           253          233        207.00           253             828
34           197          299        188.25           299             753
35           166          185        172.50           191             690
36           158          170        164.50           178             658
37           232          284        236.75           284             947
38           317          269        252.25           317            1009
39           193          206        167.00           206             668
40           273          274        242.50           274             970
41           239          202        191.25           239             765
42           179          196        156.50           196             626
43           179          239        179.75           239             719
44           212          181        180.50           212             722
45           254          126        148.50           254             594
46           260          310        260.25           310            1041
47           180          225        184.50           225             738
48           169          183        177.50           183             710
49           236          224        187.50           236             750
50           208          279        193.00           279             772
51           153          204        168.25           204             673
52           138          222        158.00           222             632
53           236          216        189.50           236             758
54           269          207        236.25           269             945
55           216          211        184.50           216             738
56           183          251        188.00           251             752
57           226          218        188.75           226             755
58           250          294        230.00           294             920
59           244          201        166.75           244             667
60           178          116        123.25           178             493
61           232          241        201.50           241             806
62           237          212        194.50           237             778
63           177          238        195.50           238             782
64           193          172        163.75           193             655
65           297          300        256.25           300            1025
66           151          182        185.50           224             742
67           304          288        232.00           304             928
68           211          204        164.50           211             658
69           280          196        224.25           280             897
70           204          138        136.75           204             547
71           218          234        215.00           255             860
72           220          227        182.50           227             730
73           246          222        188.50           246             754
74           191          157        165.25           191             661
75           204          298        241.25           298             965
76           291          240        230.75           291             923
77           184          229        191.25           229             765
78           249          249        196.50           249             786
79           248          233        191.00           248             764
80           218          258        192.50           258             770
81           219          246        227.00           246             908
82           180          136        153.00           188             612
83           180          211        182.00           211             728
84           292          182        237.00           292             948
85           234          235        185.25           235             741
86           195          235        210.00           235             840
87           173          221        153.50           221             614
88           216          244        199.25           244             797
89           209          186        159.50           209             638
90           175          191        152.00           191             608
91           307          244        236.75           307             947
92           316          259        256.00           316            1024
93           199          184        183.50           209             734
94           194          214        166.25           214             665
95           173          191        148.25           191             593
96           200          194        168.50           200             674
97           322          273        233.00           322             932
98           123          181        152.25           193             609
99           286          281        230.75           286             923
100          129          160        143.00           160             572
</code></pre></div>    </div>
  </blockquote>
</blockquote>

<p> </p>

<blockquote class="challenge">
  <h2 id="using-the-apply-function-on-patient-data">Using the apply function on patient data</h2>

  <p>The apply function can be used to summarize datasets and subsets
of data across rows and columns using the MARGIN argument.
Suppose you want to calculate the mean number of aneurisms for
specific quarters and patients in the patient dataset.</p>

  <p>Use a combination of the apply function and indexing to:</p>

  <ol>
    <li>Calculate the mean number of aneurisms for patients 1 to 5 over all four quarters.</li>
    <li>Calculate the mean number of aneurisms for quarters 1 to 3 (across all patients).</li>
    <li>Calculate the mean number of aneurisms for each patient in treatment group 2 day (across all quarters).</li>
  </ol>

  <p>Think about the number of rows and columns you would expect as the result before each apply call and check your intuition by applying the mean function.</p>

  <blockquote class="solution">
    <h2 id="solution-3">Solution</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w"> </span><span class="c1"># 1.</span><span class="w">
</span><span class="n">apply</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="o">:</span><span class="m">9</span><span class="p">],</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="p">)</span><span class="w">

</span><span class="c1"># 2.</span><span class="w">
</span><span class="n">apply</span><span class="p">(</span><span class="n">dat</span><span class="p">[,</span><span class="w"> </span><span class="m">6</span><span class="o">:</span><span class="m">8</span><span class="p">],</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="p">)</span><span class="w">

</span><span class="c1"># 3.</span><span class="w">
</span><span class="n">apply</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="n">dat</span><span class="o">$</span><span class="n">Group</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Treatment2"</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="o">:</span><span class="m">9</span><span class="p">],</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>
  </blockquote>
</blockquote>

<hr />
<h3 id="plotting--additional-detail">Plotting – Additional Detail</h3>

<p>R is a robust platform for creating publication quality graphics, regardless of the complexity of you data and presentation. We really just scratched the surface <em>In Class</em> and there is no way we will be able to adequately cover the available tools in one session of one class. The goal is to give you a taste of what you can do (i.e. virtually anything you can image) and where to look for the tools to begin to do so.</p>

<p> </p>
<h4 id="multipanel-plots">Multipanel plots</h4>

<p>Most figures contain multiple panels containing different information. One option is to generate each panel as a separate figure and stitch them together after the fact using a PDF editor or some other graphics program. However, R has the tools to build multipanel plots. Let’s look at how we can put multiple related panels in the same plot. This requires going beyond the <code class="language-plaintext highlighter-rouge">plot()</code> and <code class="language-plaintext highlighter-rouge">boxplot()</code> functions.</p>

<p>Take a look at the <code class="language-plaintext highlighter-rouge">?plot</code> documentation. Notice that there really aren’t that many input options, but that there is a “…” listed, which references the <code class="language-plaintext highlighter-rouge">par()</code> function. This will also introduce you to the <code class="language-plaintext highlighter-rouge">par()</code> function. Under the surface, there are  hundreds of tweaks that you can make to plots through arguments. R has a set of predefined graphical parameters that are all stored in the background. The <code class="language-plaintext highlighter-rouge">par()</code> function queries and sets these parameters. If you don’t give it any arguments, <code class="language-plaintext highlighter-rouge">par()</code> will return the current settings for all of these variables. We can see what settings are available and what the defaults are using <code class="language-plaintext highlighter-rouge">?par</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">?</span><span class="n">par</span><span class="w">
</span></code></pre></div></div>

<p> </p>

<p>Before you start to fiddle with <code class="language-plaintext highlighter-rouge">par()</code>, it is a good idea to store all of the current settings to a variable, which can be used to restore the default if we need to later on.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot.options</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">par</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<p> </p>

<p>Now to take a look at what we have:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">head</span><span class="p">(</span><span class="n">plot.options</span><span class="p">)</span><span class="w"> </span><span class="c1"># this is a list with a bunch of graphical related variables</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$xlog
[1] FALSE

$ylog
[1] FALSE

$adj
[1] 0.5

$ann
[1] TRUE

$ask
[1] FALSE

$bg
[1] "white"
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">length</span><span class="p">(</span><span class="n">plot.options</span><span class="p">)</span><span class="w"> </span><span class="c1"># there are 72 variables that we can tweak in par() alone, and some have multiple parameters</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 72
</code></pre></div></div>

<p> </p>

<p>Consider the <code class="language-plaintext highlighter-rouge">iris</code> data set. If we want to make a multipanel plot, say with box plots of Petal Length and Petal Width, and then the correlation between them, we can use <code class="language-plaintext highlighter-rouge">par()</code> before running plot to tell R how many rows and columns of figure panels  we want to create. We use this by passing the argument <code class="language-plaintext highlighter-rouge">mfrow = c(&lt;# of rows&gt;, &lt;# of columns&gt;)</code> to <code class="language-plaintext highlighter-rouge">par()</code>. This changes the value of the background graphical parameters. Note that we later have to change this back if we want to make a single-panel plot.</p>

<p>Once we set <code class="language-plaintext highlighter-rouge">mfrow</code> we can then run our previous plot commands in the order we want them displayed. Let’s give it a try:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># get the current graphical parameters</span><span class="w">
</span><span class="n">old.plot.options</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">par</span><span class="p">()</span><span class="w"> </span><span class="c1"># it never hurts to save a copy of the old parameters, so we can reset them if we break something</span><span class="w">

</span><span class="c1"># setup a plot with 3 figure panels in a row using the mfrow argument</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">3</span><span class="p">))</span><span class="w"> </span><span class="c1"># 1 row, 3 columns</span><span class="w">

</span><span class="c1"># Panel 1: Box plot with jittered stripchart points for Petal Length</span><span class="w">
</span><span class="n">boxplot</span><span class="p">(</span><span class="n">Petal.Length</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Species</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iris</span><span class="p">,</span><span class="w">
        </span><span class="n">outline</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Petal Length (cm)"</span><span class="p">)</span><span class="w">
</span><span class="n">stripchart</span><span class="p">(</span><span class="n">Petal.Length</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Species</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iris</span><span class="p">,</span><span class="w">
           </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">16</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"jitter"</span><span class="p">,</span><span class="w">
           </span><span class="n">add</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">vert</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">

</span><span class="c1"># Panel 2: Box plot with jittered stripchart points for Petal Width</span><span class="w">
</span><span class="n">boxplot</span><span class="p">(</span><span class="n">Petal.Width</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Species</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iris</span><span class="p">,</span><span class="w">
        </span><span class="n">outline</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Petal Width (cm)"</span><span class="p">)</span><span class="w">
</span><span class="n">stripchart</span><span class="p">(</span><span class="n">Petal.Width</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Species</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iris</span><span class="p">,</span><span class="w">
           </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">16</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"jitter"</span><span class="p">,</span><span class="w">
           </span><span class="n">add</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">vert</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">

</span><span class="c1"># Panel 3: Scatter plot comparing Petal Length to Petal Width</span><span class="w">
</span><span class="n">col.list</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"red"</span><span class="p">,</span><span class="w"> </span><span class="s2">"blue"</span><span class="p">,</span><span class="w"> </span><span class="s2">"green"</span><span class="p">)</span><span class="w">
</span><span class="n">col.vector</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">col.list</span><span class="p">[</span><span class="n">iris</span><span class="o">$</span><span class="n">Species</span><span class="p">]</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">iris</span><span class="o">$</span><span class="n">Petal.Length</span><span class="p">,</span><span class="w"> </span><span class="n">iris</span><span class="o">$</span><span class="n">Petal.Width</span><span class="p">,</span><span class="w">
     </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Petal Length (cm)"</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Petal Width (cm)"</span><span class="p">,</span><span class="w">
     </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">col.vector</span><span class="p">)</span><span class="w">
</span><span class="n">legend</span><span class="p">(</span><span class="s2">"bottomright"</span><span class="p">,</span><span class="w"> </span><span class="n">legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">levels</span><span class="p">(</span><span class="n">iris</span><span class="o">$</span><span class="n">Species</span><span class="p">),</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="n">col.list</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-04-oyo-advanced-data-manipulation-unnamed-chunk-27-1.png" title="plot of chunk unnamed-chunk-27" alt="plot of chunk unnamed-chunk-27" width="612" style="display: block; margin: auto;" /></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># and finally, reset the mfrow argument to a single panel</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p> </p>
<h4 id="box-plots-with-multiple-independent-variables--getting-to-publication-quality">Box plots with multiple independent variables – getting to publication quality</h4>

<p>Box plots begin to tax the default behavior of R when it comes to things like axis labeling. Let’s use the gender-corrected and processed version of our aneurism data (“sample-processed.csv”) to take a look at plotting when multiple independent variables are in play. First, load the data:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"data/sample-processed.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">stringsAsFactors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">)</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      ID Gender      Group BloodPressure  Age Aneurisms_q1 Aneurisms_q2
1 Sub001      M    Control           132 16.0          114          140
2 Sub002      M Treatment2           139 17.2          148          209
3 Sub003      M Treatment2           130 19.5          196          251
4 Sub004      F Treatment1           105 15.7          199          140
5 Sub005      M Treatment1           125 19.9          188          120
6 Sub006      M Treatment2           112 14.3          260          266
  Aneurisms_q3 Aneurisms_q4 Aneurisms_avg Aneurisms_max Aneurisms_total
1          202          237        173.25           237             693
2          248          248        213.25           248             853
3          122          177        186.50           251             746
4          233          220        198.00           233             792
5          222          228        189.50           228             758
6          320          294        285.00           320            1140
</code></pre></div></div>

<p> </p>

<p>What if we want to plot total aneurisms broken down by both gender and treatment group. The <code class="language-plaintext highlighter-rouge">formula</code> notation used in <code class="language-plaintext highlighter-rouge">boxplot()</code> makes this pretty straightforward:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># use the '+' to indicate multiple grouping variables</span><span class="w">
</span><span class="n">boxplot</span><span class="p">(</span><span class="n">Aneurisms_total</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Group</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Gender</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dat</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-04-oyo-advanced-data-manipulation-unnamed-chunk-29-1.png" title="plot of chunk unnamed-chunk-29" alt="plot of chunk unnamed-chunk-29" width="612" style="display: block; margin: auto;" /></p>

<p> </p>

<p>We have the data in the right place, but the group labels are all horizontal, so they can’t be displayed. There is also no clear visual way to distinguish how the treatment groups and gender groups are separated.</p>

<p>We can take several steps to improve the look in chart:</p>
<ul>
  <li>Use the <code class="language-plaintext highlighter-rouge">at</code> argument to change the box spacing. By default, boxes are drawn centered over the integers 1, 2, 3, …, n, where n is the number of boxes. By redefining these locations and skipping numbers, you can add spaces between groups.</li>
  <li>Use box colors to indicate treatment groups (<code class="language-plaintext highlighter-rouge">col</code> argument plus the <code class="language-plaintext highlighter-rouge">legend()</code> function) and x-axis labels to indicate gender. There are other ways to do this, but this is one of the more visually appealing.</li>
  <li>Tick marks are often not useful in box plots. To turn them off, we will use the <code class="language-plaintext highlighter-rouge">xaxt</code> to run off all x-axis feature, and then use the separate function <code class="language-plaintext highlighter-rouge">axis()</code> to add the ones we want back (sans tick marks).</li>
  <li>Make the y-axis label look better with <code class="language-plaintext highlighter-rouge">ylab</code>.</li>
  <li>Add all points with <code class="language-plaintext highlighter-rouge">stripchart()</code>.</li>
</ul>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># draw the box plot first</span><span class="w">
</span><span class="n">boxplot</span><span class="p">(</span><span class="n">Aneurisms_total</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Group</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Gender</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dat</span><span class="p">,</span><span class="w">
        </span><span class="n">xaxt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"n"</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="c1"># turn off all x-axis labeling (so we can redraw it below)</span><span class="w">
        </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"# Aneurisms"</span><span class="p">,</span><span class="w"> </span><span class="c1"># y axis label</span><span class="w">
        </span><span class="n">at</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">7</span><span class="p">),</span><span class="w"> </span><span class="c1"># leave a space between gender groups</span><span class="w">
        </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"grey"</span><span class="p">,</span><span class="s2">"blue"</span><span class="p">,</span><span class="s2">"red"</span><span class="p">))</span><span class="w"> </span><span class="c1"># color boxes by treatment for legend</span><span class="w">

</span><span class="c1"># now add the points with stripchart with the same parameters as box</span><span class="w">
</span><span class="n">stripchart</span><span class="p">(</span><span class="n">Aneurisms_total</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Group</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Gender</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dat</span><span class="p">,</span><span class="w">
        </span><span class="n">add</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">vert</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="c1"># add the points to the current boxplot vertically</span><span class="w">
        </span><span class="n">at</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">7</span><span class="p">),</span><span class="w"> </span><span class="c1"># leave a space between gender groups</span><span class="w">
        </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"black"</span><span class="p">),</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">16</span><span class="p">,</span><span class="w"> </span><span class="c1"># color and symbol for points</span><span class="w">
        </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"jitter"</span><span class="p">)</span><span class="w"> </span><span class="c1"># jitter the points</span><span class="w">

</span><span class="c1"># next add gender labels to the x-axis</span><span class="w">
</span><span class="n">axis</span><span class="p">(</span><span class="n">side</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="c1"># add axis labels to the x-axis</span><span class="w">
     </span><span class="n">at</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">6</span><span class="p">),</span><span class="w"> </span><span class="c1"># place the labels under the middle boxes of each group</span><span class="w">
     </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"female"</span><span class="p">,</span><span class="s2">"male"</span><span class="p">),</span><span class="w"> </span><span class="c1"># gender labels</span><span class="w">
     </span><span class="n">tick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="c1"># do not add tick marks</span><span class="w">

</span><span class="c1"># now add a legend to indicate</span><span class="w">
</span><span class="n">legend</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"top"</span><span class="p">,</span><span class="w"> </span><span class="n">inset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">-0.13</span><span class="p">,</span><span class="w"> </span><span class="c1"># place the legend on top, but nudge it up a bit</span><span class="w">
       </span><span class="n">xpd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">,</span><span class="w"> </span><span class="c1"># allow the legend to be drawn outside the plot area</span><span class="w">
       </span><span class="n">bty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"n"</span><span class="p">,</span><span class="w"> </span><span class="c1"># don't draw a box around the legend</span><span class="w">
       </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="c1"># use 3 columns (one row, since we have 3 groups)</span><span class="w">
       </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"grey"</span><span class="p">,</span><span class="w"> </span><span class="s2">"blue"</span><span class="p">,</span><span class="w"> </span><span class="s2">"red"</span><span class="p">),</span><span class="w"> </span><span class="c1"># fill boxes with the same colors as boxplot</span><span class="w">
       </span><span class="n">legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">levels</span><span class="p">(</span><span class="n">dat</span><span class="o">$</span><span class="n">Group</span><span class="p">))</span><span class="w"> </span><span class="c1"># labels by treatment group</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-04-oyo-advanced-data-manipulation-unnamed-chunk-30-1.png" title="plot of chunk unnamed-chunk-30" alt="plot of chunk unnamed-chunk-30" width="612" style="display: block; margin: auto;" /></p>

<p> </p>

<p>This ends up with a fairly complex script for a single chart, but when you start to directly generate publication quality graphics in R, this is what it tends to look like. Once you go through the process of setting up a plot that you like once, you can always copy that whole chunk of code into the next project (or write a custom plot function with your own defaults!). Over time, you build up a sort of personal “library” of code chunks and can make really nice graphics in relatively little time.</p>

<p> </p>
<h4 id="other-resources-for-plotting">Other resources for plotting</h4>

<p>This lesson gives you access to the two most common chart types used in biology: scatterplots and box plots (which can usually be used in place of bar charts). This is just the tip of a very large iceberg. R has the capability of producing any visualization you can imagine, and there are full workshops and courses dedicated just to generating graphics in R. The potential applications are as varied as your projects, and the best thing you can do is to sit down and start using the functions with Google search close at hand.</p>

<p>We don’t have the time to do everything, but we will be using both of these chart types throughout the course, and introducing several others (histograms, density charts, line graphs, Kaplan-Meier charts, etc).  For now, a few resources that will help you along the way:</p>
<ul>
  <li>A cheat sheet for the graphics tools that come with R (aka “R base graphics”) can be downloaded <a href="../fig/BaseGraphicsCheatsheet.pdf">here</a>.</li>
  <li>The <code class="language-plaintext highlighter-rouge">lattice</code> package makes some improvements to R base graphics and functions. The defaults are better for example.</li>
  <li>The other commonly graphics package is called <code class="language-plaintext highlighter-rouge">ggplot2</code>. I have tended toward base graphics, because you can literally do anything with them, but <code class="language-plaintext highlighter-rouge">ggplot2</code> is easier in some ways, once you get the syntax down (which is very different). Cheat sheet is <a href="../fig/ggplot2-cheatsheet.pdf">here</a>.</li>
  <li>Google is your friend. There are probably thousands of tutorials, forum Q&amp;As, cheat sheets, etc. to answer your project specific questions. For a taste, go to Google and search “publication quality graphics in R”</li>
</ul>

<hr />
<h3 id="exercises">Exercises</h3>

<blockquote class="challenge">
  <h2 id="on-the-road--does-what-you-drive-or-where-you-drive-it-matter">On the road – does what you drive or where you drive it matter?</h2>

  <p>Read in our sample data on car speeds (car-speeds.csv) and visualize differences in car
speed by both state and color.</p>

  <blockquote class="solution">
    <h2 id="solution-4">Solution</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># set data and results directories</span><span class="w">
</span><span class="n">data.dir</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"data"</span><span class="w">
</span><span class="n">results.dir</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"results"</span><span class="w">

</span><span class="c1"># load data</span><span class="w">
</span><span class="n">carSpeeds</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="n">data.dir</span><span class="p">,</span><span class="s2">"/car-speeds.csv"</span><span class="p">))</span><span class="w">

</span><span class="c1"># setup two panel figure</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">))</span><span class="w">

</span><span class="c1"># use a box plot with jittered strip chart overlay to plot car speed as a function</span><span class="w">
</span><span class="c1"># of state</span><span class="w">
</span><span class="n">boxplot</span><span class="p">(</span><span class="n">Speed</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">State</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">carSpeeds</span><span class="p">,</span><span class="w">
        </span><span class="n">outline</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Car Speed (mph)"</span><span class="p">)</span><span class="w">
</span><span class="n">stripchart</span><span class="p">(</span><span class="n">Speed</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">State</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">carSpeeds</span><span class="p">,</span><span class="w">
        </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">16</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"jitter"</span><span class="p">,</span><span class="w">
        </span><span class="n">add</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">vert</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">

</span><span class="c1"># use a box plot with jittered strip chart overlay to plot car speed as a function</span><span class="w">
</span><span class="c1"># of car color</span><span class="w">
</span><span class="n">boxplot</span><span class="p">(</span><span class="n">Speed</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Color</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">carSpeeds</span><span class="p">,</span><span class="w">
        </span><span class="n">outline</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Car Speed (mph)"</span><span class="p">)</span><span class="w">
</span><span class="n">stripchart</span><span class="p">(</span><span class="n">Speed</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Color</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">carSpeeds</span><span class="p">,</span><span class="w">
        </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">16</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"jitter"</span><span class="p">,</span><span class="w">
            </span><span class="n">add</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">vert</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <p><img src="../fig/rmd-04-oyo-advanced-data-manipulation-unnamed-chunk-31-1.png" title="plot of chunk unnamed-chunk-31" alt="plot of chunk unnamed-chunk-31" width="612" style="display: block; margin: auto;" /></p>
  </blockquote>
</blockquote>

<p> </p>

<blockquote class="challenge">
  <h2 id="blood-pressure-as-a-risk-factor-for-aneurism">Blood pressure as a risk factor for aneurism</h2>

  <p>Does blood pressure appear to have an impact on aneurism risk?</p>

  <p>Examine these questions using the file that we created in the “Correcting Case in Gender”
exercise earlier (sample-gendercorrected.csv). What, other than blood pressure, may explain
any apparent correlation (or lack there of?).</p>

  <p>Save your results to a PDF file.</p>

  <blockquote class="solution">
    <h2 id="solution-5">Solution</h2>

    <p>I left this intentionally a bit vague, which means that there are several solutions. But
that is often the nature of real data in real research.</p>

    <p>Since we are trying to gt a general idea here, I am first going to calculate the average
quarterly aneurisms and the total yearly aneurisms (you could also look at each quarter
independently).</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># set data and results directories</span><span class="w">
</span><span class="n">data.dir</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"data"</span><span class="w">
</span><span class="n">results.dir</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"results"</span><span class="w">

</span><span class="c1"># load data</span><span class="w">
</span><span class="n">data.an</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="n">data.dir</span><span class="p">,</span><span class="s2">"/sample-gendercorrected.csv"</span><span class="p">))</span><span class="w">

</span><span class="c1"># define new columns for average quarterly and total annual aneurisms and calculate</span><span class="w">
</span><span class="n">data.an</span><span class="o">$</span><span class="n">Aneurisms_qmean</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rowMeans</span><span class="p">(</span><span class="n">data.an</span><span class="p">[,</span><span class="m">6</span><span class="o">:</span><span class="m">9</span><span class="p">])</span><span class="w">
</span><span class="n">data.an</span><span class="o">$</span><span class="n">Aneurisms_total</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rowSums</span><span class="p">(</span><span class="n">data.an</span><span class="p">[,</span><span class="m">6</span><span class="o">:</span><span class="m">9</span><span class="p">])</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">data.an</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      ID Gender      Group BloodPressure  Age Aneurisms_q1 Aneurisms_q2
1 Sub001      M    Control           132 16.0          114          140
2 Sub002      M Treatment2           139 17.2          148          209
3 Sub003      M Treatment2           130 19.5          196          251
4 Sub004      F Treatment1           105 15.7          199          140
5 Sub005      M Treatment1           125 19.9          188          120
6 Sub006      M Treatment2           112 14.3          260          266
  Aneurisms_q3 Aneurisms_q4 Aneurisms_qmean Aneurisms_total
1          202          237          173.25             693
2          248          248          213.25             853
3          122          177          186.50             746
4          233          220          198.00             792
5          222          228          189.50             758
6          320          294          285.00            1140
</code></pre></div>    </div>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># initiate a PDF file and setup two panel figure</span><span class="w">
</span><span class="n">pdf</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">paste0</span><span class="p">(</span><span class="n">results.dir</span><span class="p">,</span><span class="w"> </span><span class="s2">"/aneurisms-bloodpressure-chart.pdf"</span><span class="p">),</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">))</span><span class="w">

</span><span class="c1"># use a scatter plot to look for apparent correlation between blood pressure and</span><span class="w">
</span><span class="c1"># both summary measures of aneurism (in separate panels)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">data.an</span><span class="o">$</span><span class="n">BloodPressure</span><span class="p">,</span><span class="w"> </span><span class="n">data.an</span><span class="o">$</span><span class="n">Aneurisms_qmean</span><span class="p">,</span><span class="w">
     </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Blood Pressure (mmHg)"</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Mean Aneurisms per Quarter"</span><span class="p">)</span><span class="w">

</span><span class="n">plot</span><span class="p">(</span><span class="n">data.an</span><span class="o">$</span><span class="n">BloodPressure</span><span class="p">,</span><span class="w"> </span><span class="n">data.an</span><span class="o">$</span><span class="n">Aneurisms_total</span><span class="p">,</span><span class="w">
     </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Blood Pressure (mmHg)"</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Aneurisms per Year"</span><span class="p">)</span><span class="w">

</span><span class="c1"># turn off PDF device</span><span class="w">
</span><span class="n">dev.off</span><span class="p">()</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>png 
  2 
</code></pre></div>    </div>

    <p>There is no apparent correlation, but there are a lot of potential confounders within the
data set that we are not examining in this exercise so far (treatment, gender, age)</p>
  </blockquote>
</blockquote>

<p> </p>

<blockquote class="challenge">
  <h2 id="correlations-between-petal-and-sepal-in-iris-data">Correlations between petal and sepal in iris data</h2>

  <p>We looked a correlation between petal length and width. What about correlations between petal
and sepal? Generate scatter plots to look at length and width correlations, broken down by species.</p>

  <p>Save your results to a PDF.</p>

  <blockquote class="solution">
    <h2 id="solution-6">Solution</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># set data and results directories</span><span class="w">
</span><span class="n">data.dir</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"data"</span><span class="w">
</span><span class="n">results.dir</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"results"</span><span class="w">

</span><span class="c1"># initiate a PDF file and setup two panel figure</span><span class="w">
</span><span class="n">pdf</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">paste0</span><span class="p">(</span><span class="n">results.dir</span><span class="p">,</span><span class="w"> </span><span class="s2">"/iris-petal-sepal-correlations.pdf"</span><span class="p">),</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">))</span><span class="w">

</span><span class="c1"># Define colors</span><span class="w">
</span><span class="n">col.list</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"red"</span><span class="p">,</span><span class="w"> </span><span class="s2">"blue"</span><span class="p">,</span><span class="w"> </span><span class="s2">"green"</span><span class="p">)</span><span class="w">

</span><span class="c1"># And we use the species.index in place of iris$Species to do the indexing and generate</span><span class="w">
</span><span class="c1"># our color list for each point on the plot</span><span class="w">
</span><span class="n">col.vector</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">col.list</span><span class="p">[</span><span class="n">iris</span><span class="o">$</span><span class="n">Species</span><span class="p">]</span><span class="w">

</span><span class="c1"># Plot petal length x sepal length, then petal width x sepal width in subsequent panels</span><span class="w">
</span><span class="c1"># we only need one legend, which after an initial look at the data, fits best in the top</span><span class="w">
</span><span class="c1"># left of the first panel</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">iris</span><span class="o">$</span><span class="n">Petal.Length</span><span class="p">,</span><span class="w"> </span><span class="n">iris</span><span class="o">$</span><span class="n">Sepal.Length</span><span class="p">,</span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Petal Length (cm)"</span><span class="p">,</span><span class="w">
      </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Sepal Length (cm)"</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">col.vector</span><span class="p">)</span><span class="w">
</span><span class="n">legend</span><span class="p">(</span><span class="s2">"topleft"</span><span class="p">,</span><span class="w"> </span><span class="n">legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">levels</span><span class="p">(</span><span class="n">iris</span><span class="o">$</span><span class="n">Species</span><span class="p">),</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="n">col.list</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">iris</span><span class="o">$</span><span class="n">Petal.Width</span><span class="p">,</span><span class="w"> </span><span class="n">iris</span><span class="o">$</span><span class="n">Sepal.Width</span><span class="p">,</span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Petal Width (cm)"</span><span class="p">,</span><span class="w">
      </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Sepal Width (cm)"</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">col.vector</span><span class="p">)</span><span class="w">

</span><span class="c1"># turn off the PDF device</span><span class="w">
</span><span class="n">dev.off</span><span class="p">()</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>png 
  2 
</code></pre></div>    </div>
  </blockquote>
</blockquote>

<p> </p>

<blockquote class="challenge">
  <h2 id="exploring-plot-options">Exploring plot options</h2>

  <p>R has hundreds of ways to change the way plots are displayed. The only way to
really learn how to manipulate charts is to start playing with the options to
see what they do. Below are a range of options that I have used at one point
or another.</p>

  <p>Try starting with one of the plots with today’s lesson, change one
or more of the following parameters, then rerun the plot script to see what
changed. A good way to do this is to plot two charts with a single argument change
to the RStudio plot panel. The arrows at the top left of the panel let you look
through previous charts and see what changed. Alternatively, write the two charts
to subsequent pages of a PDF file for comparison.</p>

  <p><strong>Arguments to the <code class="language-plaintext highlighter-rouge">plot()</code> function</strong>
<em>Remember that default values can be found in <code class="language-plaintext highlighter-rouge">?plot</code> or by running <code class="language-plaintext highlighter-rouge">par()</code> with no arguments, and argument descriptions can be accessed in <code class="language-plaintext highlighter-rouge">?par</code>.</em></p>
  <ul>
    <li><em>bty</em></li>
    <li><em>border</em></li>
    <li><em>col</em></li>
    <li><em>lty</em></li>
    <li><em>lwd</em></li>
    <li><em>main</em></li>
    <li><em>sub</em></li>
    <li><em>type</em></li>
    <li><em>xlab</em>, <em>ylab</em></li>
    <li><em>xlim</em>, <em>ylim</em></li>
    <li><em>xaxs</em>, <em>yaxs</em></li>
    <li><em>xaxt</em>, <em>yaxt</em></li>
    <li><em>xlog</em>, <em>ylog</em></li>
    <li><em>xpd</em></li>
  </ul>

  <p><strong>Arguments to the <code class="language-plaintext highlighter-rouge">par()</code> function</strong>
*Note that these are typically passed to <code class="language-plaintext highlighter-rouge">par()</code> prior to running running a plot
function. Run <code class="language-plaintext highlighter-rouge">par()</code> for defaults and <code class="language-plaintext highlighter-rouge">?par</code> for argument descriptions.</p>
  <ul>
    <li><em>cex</em></li>
    <li><em>mar</em></li>
    <li><em>mfrow</em></li>
    <li><em>oma</em></li>
    <li><em>tcl</em></li>
  </ul>

  <p><em>You can set most of the arguments listed above in <code class="language-plaintext highlighter-rouge">plot()</code> using the <code class="language-plaintext highlighter-rouge">par()</code>
function as well, and it will set the default for future charts.</em></p>

  <p><strong>Functions that add elements to existing plots</strong>
<em>For this set, first generate a plot (e.g. with <code class="language-plaintext highlighter-rouge">plot()</code> or <code class="language-plaintext highlighter-rouge">boxplot()</code>)
and then call the following functions. Use <code class="language-plaintext highlighter-rouge">?</code> to see what arguments are
required for each</em></p>
  <ul>
    <li><code class="language-plaintext highlighter-rouge">abline()</code></li>
    <li><code class="language-plaintext highlighter-rouge">axis()</code></li>
    <li><code class="language-plaintext highlighter-rouge">box()</code></li>
    <li><code class="language-plaintext highlighter-rouge">legend()</code></li>
    <li><code class="language-plaintext highlighter-rouge">lines()</code></li>
    <li><code class="language-plaintext highlighter-rouge">mtext()</code></li>
    <li><code class="language-plaintext highlighter-rouge">points()</code></li>
    <li><code class="language-plaintext highlighter-rouge">text()</code></li>
    <li><code class="language-plaintext highlighter-rouge">title()</code></li>
  </ul>
</blockquote>

<hr />



<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>Use <code class="language-plaintext highlighter-rouge">apply()</code>, <code class="language-plaintext highlighter-rouge">lapply()</code>, and <code class="language-plaintext highlighter-rouge">sapply()</code> to calculate statistics across the rows or columns of a data frame.</p>
</li>
    
    <li><p>There are more advanced tools for complex data manipulation, including the <code class="language-plaintext highlighter-rouge">dplyr</code> and <code class="language-plaintext highlighter-rouge">data.table</code> packages.</p>
</li>
    
    <li><p>Use <code class="language-plaintext highlighter-rouge">aggregate()</code> to calculate statistics based on the structure of a dataset.</p>
</li>
    
  </ul>
</blockquote>

</article>
















<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="../04-class-manipulating-plotting-data/index.html"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="../05-class-decisions-loops/index.html"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>


      
      






<footer>
  <!--<div class="row">
    <div class="col-md-6 copyright" align="left">
	
    </div>
    <div class="col-md-6 help-links" align="right">
	
	
	<a href="/edit//_episodes_rmd/04-oyo-advanced-data-manipulation.Rmd">Edit on GitHub</a>
	
	
	/
	<a href="/blob//CONTRIBUTING.md">Contributing</a>
	/
	<a href="/">Source</a>
	/
	<a href="/blob//CITATION">Cite</a>
	/
	<a href="mailto:sutphin@gmail.com">Contact</a>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12" align="center">
      Using <a href="https://github.com/carpentries/styles/">The Carpentries style</a>
      version <a href="https://github.com/carpentries/styles/releases/tag/v9.5.3">9.5.3</a>.
    </div>
  </div>-->
</footer>

      
    </div>
    
<script src="../assets/js/jquery.min.js"></script>
<script src="../assets/js/bootstrap.min.js"></script>
<script src="../assets/js/lesson.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-37305346-2', 'auto');
  ga('send', 'pageview');
</script>
<!--<script type="text/javascript"
  src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>-->
<script type="text/javascript"
src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

  </body>
</html>
