















<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="last-modified" content="2023-03-17 11:01:02 -0700">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- meta "search-domain" used for google site search function google_search() -->
    <meta name="search-domain" value="">
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/lesson.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/syntax.css" />

    



    <!-- Favicons for everyone -->
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="../assets/favicons/mcb585/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/favicons/mcb585/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/favicons/mcb585/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/favicons/mcb585/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="../assets/favicons/mcb585/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="../assets/favicons/mcb585/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="../assets/favicons/mcb585/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../assets/favicons/mcb585/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="../assets/favicons/mcb585/favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="../assets/favicons/mcb585/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="../assets/favicons/mcb585/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="../assets/favicons/mcb585/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="../assets/favicons/mcb585/favicon-128.png" sizes="128x128" />
    <meta name="application-name" content=" - MCB 585: Multidisciplinary/Quantitative Approaches to Solving Biological Problems"/>
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="../assets/favicons/mcb585/mstile-144x144.png" />
    <meta name="msapplication-square70x70logo" content="../assets/favicons/mcb585/mstile-70x70.png" />
    <meta name="msapplication-square150x150logo" content="../assets/favicons/mcb585/mstile-150x150.png" />
    <meta name="msapplication-wide310x150logo" content="../assets/favicons/mcb585/mstile-310x150.png" />
    <meta name="msapplication-square310x310logo" content="../assets/favicons/mcb585/mstile-310x310.png" />


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->
    <title>MCB 585: Multidisciplinary/Quantitative Approaches to Solving Biological Problems: Power Analysis</title>
  </head>
  <body>

    



    <div class="container">
      






<nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      
      
      <a href="https://georgesutphin.github.io/MCB585/" class="pull-left">
        <img class="navbar-logo" src="../assets/img/mcb585-logo.svg" alt="MCB585 logo" />
      </a>
      

      
      <a class="navbar-brand" href="../">Home</a>

    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">

	
        <li><a href="../CODE_OF_CONDUCT.html">Code of Conduct</a></li>

        
	
        <li><a href="../setup.html">Setup</a></li>

        
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Episodes <span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            <li><a href="../01-class-introduction/index.html">Getting started with R and RStudio</a></li>
            
            <li><a href="../01-oyo-introduction/index.html">Getting started with R and RStudio -- Additional Detail</a></li>
            
            <li><a href="../02-class-R-data-types-structures/index.html">Basic Data Types and Data Structures in R</a></li>
            
            <li><a href="../02-oyo-R-data-types-in-depth/index.html">R Data Types -- In-Depth</a></li>
            
            <li><a href="../03-class-data-frames/index.html">Data Frames, Basic Indexing, Reading/Writing Data</a></li>
            
            <li><a href="../03-oyo-Lists/index.html">Lists and Advanced Indexing</a></li>
            
            <li><a href="../04-class-manipulating-plotting-data/index.html">Manipulating and Plotting Data</a></li>
            
            <li><a href="../04-oyo-advanced-data-manipulation/index.html">Advanced Data Manipulation and Plotting</a></li>
            
            <li><a href="../05-class-decisions-loops/index.html">Decision Making and Loops</a></li>
            
            <li><a href="../05-oyo-more-decisions-loops/index.html">Decision Making and Loops -- Additional Detail</a></li>
            
            <li><a href="../06-class-distributions/index.html">Distributions and Normality</a></li>
            
            <li><a href="../06-oyo-more-distributions/index.html">Distributions and Normality -- Additional Detail</a></li>
            
            <li><a href="../07-class-hypothesis-testing/index.html">Hypothesis Testing</a></li>
            
            <li><a href="../07-oyo-multiple-test-correction/index.html">Multiple Test Correction</a></li>
            
            <li><a href="../08-class-survival-analysis/index.html">Survival Analysis</a></li>
            
            <li><a href="../08-oyo-advanced-survival-analysis/index.html">Advanced Survival Analysis</a></li>
            
            <li><a href="../09-class-power-analysis/index.html">Power Analysis</a></li>
            
            <li><a href="../09-oyo-simulation/index.html">Simulating Experiments</a></li>
            
            <li><a href="../99-projects/index.html">Final Projects</a></li>
            
	    <li role="separator" class="divider"></li>
            <li><a href="../aio.html">All in one page (Beta)</a></li>
          </ul>
        </li>
	

	
	<!--
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Extras <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../reference.html">Reference</a></li>
            
            <li><a href="../about/">About</a></li>
            
            <li><a href="../discuss/">Discussion</a></li>
            
            <li><a href="../figures/">Figures</a></li>
            
            <li><a href="../guide/">Instructor Notes</a></li>
            
          </ul>
        </li>
	-->

	
        <li><a href="../LICENSE.html">About</a></li>
	<!--
	
	<li><a href="/edit//_episodes_rmd/09-class-power-analysis.Rmd">Improve this page <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a></li>
	
	-->
      </ul>
      <form class="navbar-form navbar-right" role="search" id="search" onsubmit="google_search(); return false;">
        <div class="form-group">
          <input type="text" id="google-search" placeholder="Search..." aria-label="Google site search">
        </div>
      </form>
    </div>
  </div>
</nav>

















<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="../08-oyo-advanced-survival-analysis/index.html"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
    <h3 class="maintitle"><a href="../">MCB 585: Multidisciplinary/Quantitative Approaches to Solving Biological Problems</a></h3>
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="../09-oyo-simulation/index.html"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>

<article>
<div class="row">
  <div class="col-md-1">
  </div>
  <div class="col-md-10">
    <h1 class="maintitle">Power Analysis</h1>
  </div>
  <div class="col-md-1">
  </div>
</div>


<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Class Date:</strong> 9/20/2022 -- In Class
      <br/>
      <strong>Teaching:</strong> 90 min
      <br/>
      <strong>Exercises:</strong> 30 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>What is power analysis and what is its primary goal?</p>
</li>
	
	<li><p>What aspects of an experimental design can be tweaked to prepare for statistical testing?</p>
</li>
	
	<li><p>What is our primary tool for increasing power to detect?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Identify the key aspects of distributions that contribute to statistical power.</p>
</li>
	
	<li><p>Apply R power analysis tools to calculate appropriate sample size for a study.</p>
</li>
	
	<li><p>Generate power analysis reference charts for a given experiment.</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<h2 id="in-class">In Class</h2>

<p>Increasingly, funding agencies are asking for detailed justification for experimental design decisions. An explicit request in these requirements is presentation of a power analysis to justify your study design, and particularly your selected sample size. While this has long been true for human studies, these requirements are not becoming standard for most studies that use mammalian species, including mice.</p>

<p>So what is power analysis? In essence, power analysis is a structured process for thinking through critical aspects of an upcoming set of experiments to ensure that your study is properly designed to test your hypothesis. The name “Power Analysis” comes from the statistical definition of power:</p>

<table>
  <tbody>
    <tr>
      <td><em>The power of a statistical test is the probability that it will reject the null hypothesis when the alternative hypothesis is true.</em></td>
    </tr>
  </tbody>
</table>

<p>The power of a test depends on several factors, including the characteristics of the observed phenotype in a population, the expected difference between groups, and the size of the samples involved. As we will see, sample size is the primary tool that we have to adjust power. For this reason, the usual goal of conducting a power analysis is to determine the sample size needed to test a specific hypothesis with a given statistical test.</p>

<hr />
<h3 id="the-conceptual-basis-for-power-analysis">The conceptual basis for power analysis</h3>

<p>There are several possible outcomes when we collect a sample and run a statistical test to evaluate a hypothesis. There is some truth about our population that we are trying to detect: either the null hypothesis is true, or the alternative hypothesis is true. Once we conduct our test, there are two possible outcomes: either we accept the null hypothesis, or we reject it in favor of the alternative hypothesis. We can lay out the possible scenarios in a table:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: right">Truth Table</th>
      <th style="text-align: center">\(H_0\) True</th>
      <th style="text-align: center">\(H_1\) True</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: right">Accept \(H_0\)</td>
      <td style="text-align: center">Correct</td>
      <td style="text-align: center">Type II Error (\(\beta\))</td>
    </tr>
    <tr>
      <td style="text-align: right">Reject \(H_0\)</td>
      <td style="text-align: center">Type I Error (\(\alpha\))</td>
      <td style="text-align: center">Correct</td>
    </tr>
  </tbody>
</table>

<p>Each quadrant has a specific meaning to our experiment:</p>
<ol>
  <li>
    <p><strong>Correct acceptance of \(H_0\) (\(1 - \alpha\)).</strong> The upper-left quadrant is the boring case where there is no difference present, and we correctly conclude that this is the case.</p>
  </li>
  <li>
    <p><strong>Type I Error (\(\alpha\)).</strong> In the lower-left is the probability that we make an error and reject the null hypothesis when it is, in fact, true.</p>
  </li>
  <li>
    <p><strong>Type II Error (\(\beta\)).</strong> In the upper-right is the probability that we make an error and accept the null hypothesis when the alternative hypothesis is true.</p>
  </li>
  <li>
    <p><strong>Correct rejection of \(H_0\) (\(power\); \(1 - \beta\)).</strong> Finally, in the lower-right we have the situation where we correctly reject the null hypothesis in favor of the alternative when the alternative is, in fact, true. The probability associated with this outcome is called <strong>power</strong>. Because the top and bottom possibility in each column are direct negations, the probabilities in each column sum to 1. Therefore:</p>
  </li>
</ol>

<p>            \(power = 1 - \beta\)</p>

<p>While we cannot eliminate the possibility of committing either type of error, we can reduce the probability. A well-designed experiment will explicitly define the chance of committing either a Type I or Type II Error.</p>

<ul>
  <li>
    <p><strong>Limiting Type I Errors.</strong> Because the P-value represents the probability that the observed sample mean came from the null sampling distribution, it tells us directly our chance of committing a Type I Error. Thus, we generally control Type I Errors explicitly by choosing a value for \(\alpha\) and only accepting P-values that fall below that threshold.</p>
  </li>
  <li>
    <p><strong>Limiting Type II Errors.</strong> Type II Errors are the failure to detect a difference in the observed phenotype when a difference exists in the sampled populations. Because Type II Errors are not explicitly built into the statistical testing process like the \(\alpha\) threshold used to control Type I Errors, they often go uncontrolled and unremarked upon. Deliberately controlling Type II Errors requires more work up front to ensure a careful study design. As we will see, there are a couple of ways to control Type II Errors, but our primary tool is in the selection of sample size.</p>
  </li>
</ul>

<p>To better understand these concepts, let’s look at them visually by examining our distributions. To set up our thought experiment, we want to consider the situation where a real difference exists (because this is what we are ultimately interested in detecting):</p>

<p><img src="../fig/power.png" alt="Power Analysis" /></p>

<p> </p>

<p>The sampling means for two distributions are separated by some distance (\(\Delta\)). This difference combined with the variance in each distribution defines what fraction of the distributions overlap.</p>

<p>Recall that these distributions are plotted as probability density (y-axis) that the mean value of the phenotype of interest within a sample can take any given value (x-axis). As a consequence, the total area under each distribution curve will always sum to 1, and sub areas defined by a phenotype threshold value represent the probability that any given sample mean will take a value above or below that threshold value. We can use this feature to visualize the process of conducting a hypothesis test.</p>

<p>The The dotted vertical line represents our selected P-value threshold (\(\alpha\)): if the sample mean from the compared sample falls within the threshold (between the dotted lines), we accept the null hypothesis. If it falls outside the threshold, we reject the null hypothesis in favor of the alternative. \(\alpha\) is visually represented as the area under the distribution curve of the null distribution that falls outside the threshold value for the sample mean (blue shaded area). Because the above figure represents a two-sided statistical test, we include areas at both ends of the sampling distribution, each of which is \(\alpha/2\) so that the combined area sums to \(\alpha\).</p>

<p>In contrast to \(\alpha\), \(\beta\) represents the fraction of the area under the second distribution that falls within the threshold sample means. This area is shaded dark red in the above image. If a measured sample mean falls within this range, we will (erroneously) accept the null hypothesis (i.e. the distribution means are the same) when the alternative hypothesis (i.e. the distribution means are different) is true. \(Power\) is the inverse of \(\beta\): the probability that we will correctly reject the null hypothesis when the alternative hypothesis is true. Visually, \(power\) is the area under the second distribution that falls outside of the threshold range defined by \(\alpha\).</p>

<p>Note that the sampling distributions are theoretically continuous across the entire range of possible sampling mean values. Therefore, we cannot simultaneously eliminate both Type I Errors (\(\alpha\)) and Type II Errors (\(\beta\)). The goal of <strong>power analysis</strong> is to maximize \(power\) and minimize Type II Errors (\(\beta\)) for our selected \(\alpha\), within the practical restraints of our study (e.g. resources, ethics surrounding animals use).</p>

<hr />
<h3 id="what-variables-are-important-for-minimizing-error">What variables are important for minimizing error?</h3>

<p>What are the key features of the above distributions that can be manipulated to control our two types of error? As noted above, we control \(\alpha\) directly by setting our desired value as the P-value threshold (or significance level). Looking at the above distributions, it turns out that we have five features that are inter-dependent:</p>
<ul>
  <li>
    <p><strong>Population standard deviations:</strong> \(\sigma_1\), \(\sigma_2\)</p>
  </li>
  <li>
    <p><strong>Sample size:</strong> \(n_1\), \(n_2\)</p>
  </li>
  <li><strong>Effect size:</strong> This is the minimum difference in means that we would like to detect, and has two common symbolic representations.
    <ul>
      <li><strong>Difference in means:</strong> \(\Delta = \mu_2 - \mu_1\)</li>
      <li><strong>Cohen’s <em>d</em>:</strong> \(d = \frac{\sqrt{2}*(\mu_2 - \mu_1)}{\sqrt{\sigma_1^2 + \sigma_2^2}}\).</li>
    </ul>
  </li>
  <li>
    <p><strong>Significance level:</strong> \(\alpha\)</p>
  </li>
  <li><strong>Power:</strong> \(1 - \beta\)</li>
</ul>

<p>These features are a closed system \(\rightarrow\) <strong><em>If we know 4, we can calculate the 5th.</em></strong> This means that we can select our desired \(\alpha\) and \(\beta\) if we can control the other 3 features.</p>

<p>Of these 3 remaining features, 2 are generally defined by biological features of our system:</p>
<ul>
  <li>
    <p><strong>Effect size</strong> is determined by what change in sampling mean represents a biologically meaningful difference. This will vary widely based on the phenotype that you are interested in (e.g. a 10% increase may be something to celebrate when looking at lifespan, while a 100% increase in a transcript level may be borderline for relevance when looking at gene expression).</p>
  </li>
  <li>
    <p><strong>Standard deviations</strong> of the sampled populations are a feature of your phenotype of interest.</p>
  </li>
</ul>

<blockquote class="callout">
  <h2 id="estimating-population-parameters">Estimating population parameters</h2>

  <p>The goal of power analysis is to design the paramets 
of a study <em>before collecting sample data</em>. In many 
situations, we won’t know the mean or standard 
deviation of our population for a given phenotype. 
You will almost never know both parameters for both 
your control and test populations.</p>

  <p>It is necessary to have both values to conduct a 
power analysis. You can often estimate these 
parameters in one of two ways:</p>
  <ul>
    <li>Use published data on your phenotype of interest 
in your control population.</li>
    <li>Conduct a small pilot study and use the sample 
mean and standard deviation as estimates of the mean 
and standard deviation for your control population.</li>
  </ul>

  <p>We can then make two assumptions in order to perform 
our power analysis:</p>
  <ol>
    <li>The sample standard deviation approximates the 
population standard derivation.</li>
    <li>The independent variable will only affect the 
population mean without affecting standard deviation.</li>
  </ol>
</blockquote>

<p> </p>

<p>That leaves <strong>sample size</strong> as our only real tool to control errors. Since we typically set \(\alpha = 0.05\) by convention, what we are left with is a direct relationship between \(power\) and sample size (\(n\)). By examining the impact of sample size on the distribution shapes and relationships, we can see how this relationship holds:</p>

<p><img src="../fig/power-sample-size.png" alt="Power Analysis" /></p>

<p> </p>

<p>By increasing sample size we reduce the variance in the sampling distribution. For a given population with a specified \(\Delta\) and \(\alpha\), increasing \(n\) reduces the overlap in the sampling distributions, thus lowering the probability of making a Type II Error (\(\beta\)) and increasing the power to detect a real difference in distribution means, if one exists.</p>

<p>In reality, effect size is another parameter that can be manipulated in the effort to maximize power while minimizing resource expenditure. You might, for instance, decide opt for a larger power to detect a bigger effect size. The interplay between these various factors can be intuitively manipulated using a visualization tool at <a href="http://rpsychologist.com/d3/NHST/">R Psychologist</a>.</p>

<hr />
<h3 id="calculating-power-in-r">Calculating power in R</h3>

<p>The <code class="language-plaintext highlighter-rouge">pwr</code> package in R has power analysis tools for the t-test and a number of other statistical tests. Let’s explore the t-test power tool using our mouse body weight data. First, let’s install and load the package, and load our data set:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># install and load the "pwr" package</span><span class="w">
</span><span class="n">install.packages</span><span class="p">(</span><span class="s2">"pwr"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>package 'pwr' successfully unpacked and MD5 sums checked

The downloaded binary packages are in
	C:\Users\sutph\AppData\Local\Temp\RtmpWsECuP\downloaded_packages
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="s2">"pwr"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext error highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Warning: package 'pwr' was built under R version 4.1.3
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># load high-fat high-sucrose mouse diet data</span><span class="w">
</span><span class="n">data.diet</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.delim</span><span class="p">(</span><span class="s2">"./data/b6.aj.hfhs.diet.txt"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p> </p>

<p>The power t-test function is <code class="language-plaintext highlighter-rouge">pwr.t.test()</code>. Let’s examine the inputs first:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">?</span><span class="n">pwr.t.test</span><span class="w">
</span></code></pre></div></div>

<p> </p>

<p>The function requires us to input the features described above that define power:</p>
<ul>
  <li>n = sample size</li>
  <li>d = Cohen’s d (a measure of relative effect size, which incorporates mean and standard deviation)</li>
  <li>\(\alpha\) = significance level (aka probability of committing a Type I Error)</li>
  <li>\(power = 1 - \beta\) (where \(\beta\) is the probability of committing a Type II Error))</li>
</ul>

<p>It also requires two arguments that define the type of t-test we intend to use in our analysis. We generally want <code class="language-plaintext highlighter-rouge">type = "two.sample"</code> and <code class="language-plaintext highlighter-rouge">alternative = "two.sided"</code>, unless there is a reason specific to your study design to make a different selection (e.g. you only care about a result where the test population has a <em>higher</em> mean than the control population, in which case you would choose <code class="language-plaintext highlighter-rouge">alternative = "greater"</code>).</p>

<p>For the first 4 parameters, <code class="language-plaintext highlighter-rouge">pwr.t.test()</code> will calculate any 1 of the 4 when you provide the other 3. Enter values for 3 arguments, and set the argument that you would like the function to calculate equal to <code class="language-plaintext highlighter-rouge">NULL</code>.</p>

<p>For our purposes, we want to determine the sample size needed to detect a 20% change in body weight with 95% power at a 0.05 significance level in C57BL/6J mice. We will use our diet dataset as a pilot data to estimate the population mean and standard deviation.</p>

<p>First, pull the subset for C57BL/6J mice:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">b6</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.diet</span><span class="p">[</span><span class="n">data.diet</span><span class="o">$</span><span class="n">strain</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"C57BL/6J"</span><span class="p">,]</span><span class="w">
</span></code></pre></div></div>

<p> </p>

<p>Because the power analysis is based on a t-test, we must be sure that we satisfy the assumptions of the t-test in order for the resulting power analysis to be valid. Recall that the data is close to normal:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">qqnorm</span><span class="p">(</span><span class="n">b6</span><span class="o">$</span><span class="n">bw_start</span><span class="p">)</span><span class="w">
</span><span class="n">qqline</span><span class="p">(</span><span class="n">b6</span><span class="o">$</span><span class="n">bw_start</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-09-class-power-analysis-unnamed-chunk-5-1.png" title="plot of chunk unnamed-chunk-5" alt="plot of chunk unnamed-chunk-5" width="612" style="display: block; margin: auto;" /></p>

<p> </p>

<p>Next we need to define the parameters for the t-test and calculate the necessary input arguments. Then we can plug them into <code class="language-plaintext highlighter-rouge">pwr.t.test()</code> and see what it tells us. Since we would like to determine sample size, we need to calculate the other 3 inputs:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># define our desired parameters</span><span class="w">
</span><span class="n">power</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0.95</span><span class="w">   </span><span class="c1"># we want a 95% chance</span><span class="w">
</span><span class="n">beta</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">power</span><span class="w">
</span><span class="n">change</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0.2</span><span class="w"> </span><span class="c1"># to detect a 20% change in body weight</span><span class="w">
</span><span class="n">alpha</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0.05</span><span class="w">   </span><span class="c1"># at a 0.05 significance level </span><span class="w">

</span><span class="c1"># use our available diet dataset as pilot data to estimate </span><span class="w">
</span><span class="c1"># the distribution shape parameters (mean, sd)</span><span class="w">
</span><span class="n">mu</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">b6</span><span class="o">$</span><span class="n">bw_start</span><span class="p">)</span><span class="w">
</span><span class="n">sigma</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">b6</span><span class="o">$</span><span class="n">bw_start</span><span class="p">)</span><span class="w">

</span><span class="c1"># from the mean and the desired percent change we can </span><span class="w">
</span><span class="c1"># calculate the effect size</span><span class="w">
</span><span class="n">delta</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">change</span><span class="o">*</span><span class="n">mu</span><span class="w">
  
</span><span class="c1"># calculate Cohen's d; since we are assuming that standard </span><span class="w">
</span><span class="c1"># deviation is not affected, this just collapses to:</span><span class="w">
</span><span class="n">d</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">delta</span><span class="o">/</span><span class="n">sigma</span><span class="w">

</span><span class="c1"># calculate sample size, enter the other values</span><span class="w">
</span><span class="n">n.t</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pwr.t.test</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">,</span><span class="w">
                  </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w">
                  </span><span class="n">sig.level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">alpha</span><span class="p">,</span><span class="w">
                  </span><span class="n">power</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">power</span><span class="p">,</span><span class="w">
                  </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"two.sample"</span><span class="p">,</span><span class="w">
                  </span><span class="n">alternative</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"two.sided"</span><span class="p">)</span><span class="w">
</span><span class="n">n.t</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
     Two-sample t test power calculation 

              n = 6.776594
              d = 2.145835
      sig.level = 0.05
          power = 0.95
    alternative = two.sided

NOTE: n is number in *each* group
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># we can pull out sample size from the output object</span><span class="w">
</span><span class="n">n.t</span><span class="o">$</span><span class="n">n</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 6.776594
</code></pre></div></div>

<p> </p>

<p>So, we only need to test ~7 mice per groups to detect a 20% change in body weight for C57BL/6J mice.</p>

<blockquote class="challenge">
  <h2 id="changing-strains">Changing strains</h2>

  <p>Calculate the sample size needed to detect a 10% change in 
A/J body weight with 95% power at 0.05 significance.</p>

  <blockquote class="solution">
    <h2 id="solution">Solution</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># grab the data subset for A/J mice</span><span class="w">
</span><span class="n">aj</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.diet</span><span class="p">[</span><span class="n">data.diet</span><span class="o">$</span><span class="n">strain</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"A/J"</span><span class="p">,]</span><span class="w">

</span><span class="c1"># define our desired parameters:</span><span class="w">
</span><span class="n">power</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0.95</span><span class="w">   </span><span class="c1"># we want a 95% chance</span><span class="w">
</span><span class="n">beta</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">power</span><span class="w">
</span><span class="n">change</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0.1</span><span class="w"> </span><span class="c1"># to detect a 20% change in body weight</span><span class="w">
</span><span class="n">alpha</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0.05</span><span class="w">   </span><span class="c1"># at a 0.05 significance level </span><span class="w">

</span><span class="c1"># we next use our available data to estimate the </span><span class="w">
</span><span class="c1"># distribution shape parameters (mean, sd)</span><span class="w">
</span><span class="n">mu</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">aj</span><span class="o">$</span><span class="n">bw_start</span><span class="p">)</span><span class="w">
</span><span class="n">sigma</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">aj</span><span class="o">$</span><span class="n">bw_start</span><span class="p">)</span><span class="w">

</span><span class="c1"># from the mean and the desired percent change we can </span><span class="w">
</span><span class="c1"># calculate the effect size</span><span class="w">
</span><span class="n">delta</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">change</span><span class="o">*</span><span class="n">mu</span><span class="w">
  
</span><span class="c1"># calculate Cohen's d; since we are assuming that </span><span class="w">
</span><span class="c1"># standard deviation is not affected, this just </span><span class="w">
</span><span class="c1"># collapses to:</span><span class="w">
</span><span class="n">d</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">delta</span><span class="o">/</span><span class="n">sigma</span><span class="w">

</span><span class="c1"># calculate sample size, enter the other values</span><span class="w">
</span><span class="n">n.t</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pwr.t.test</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">,</span><span class="w">
                  </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w">
                  </span><span class="n">sig.level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">alpha</span><span class="p">,</span><span class="w">
                  </span><span class="n">power</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">power</span><span class="p">,</span><span class="w">
                  </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"two.sample"</span><span class="p">,</span><span class="w">
                  </span><span class="n">alternative</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"two.sided"</span><span class="p">)</span><span class="w">
</span><span class="n">n.t</span><span class="o">$</span><span class="n">n</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 22.44183
</code></pre></div>    </div>

    <p>The smaller effect size desired means that we need quite a 
bit higher sample size to detect the change in A/J mice.</p>
  </blockquote>
</blockquote>

<p> </p>

<blockquote class="callout">
  <h2 id="should-you-always-use-equal-sample-sizes-between-groups">Should you always use equal sample sizes between groups?</h2>

  <p>Using equal samples sizes between groups maximizes power to 
detect a desired effect when comparing populations that 
have identical variance (e.g. \(\sigma_1 = \sigma_2\)). Many
tools assume equal sample sizes, and this is a good rule of 
thumb for most situations.</p>

  <p>However, different sample sizes can be helpful in some 
situations. Comparing samples with unequal variance for 
instance:</p>
  <ul>
    <li>
      <p>If \(\sigma_2 = 2\sigma_1\), use \(n_2 = 2n_1\) animals to maximize power.</p>
    </li>
    <li>
      <p>When testing an expensive drug, use more controls and fewer treated animals. You can achieve the same power with more animals but use a lot less drug.</p>
    </li>
    <li>
      <p>When testing multiple drugs and comparing to the same control population, increase power by increasing control n only. While each individual comparison between control and treatment group will not benefit as much, the overall number of animals needed in the study will be lower, and you get away with using less of each drug.</p>
    </li>
    <li>
      <p>When studying a rare disease, your disease population 
will often have a low n. Use more control group samples to 
increase power.</p>
    </li>
  </ul>
</blockquote>

<hr />
<h3 id="using-t-test-power-analysis-in-non-normal-populations-to-calculate-minimum-sample-size">Using t-test power analysis in non-normal populations to calculate minimum sample size</h3>

<p>What about data that does not meet the normality assumption of the t-test? There are more sophisticated ways to handle this type of data, which you will look at <em>On Your Own</em>, but the t-test power calculation is much simpler and still gives a good ballpark estimate. In face, this is probably the most common method for running power analyses in non-normal data, despite the violation of the normality assumption. The estimate that it gives is still useful, just treat sample size estimates as a <em>bare minimum</em>, at best, and increase your numbers according to how far from a normal distribution you data is.</p>

<p>To illustrate, let’s say we want to move to the next step and determine the impact of high-fat high-sucrose diet on mouse lifespan. Let’s design an experiment to determine whether the high-fat, high-sucrose diet affects lifespan in C57BL/6J. We need to detect a 20% change in lifespan at 95% power. We have pilot lifespan data from a published inbred strain survey study in the file <code class="language-plaintext highlighter-rouge">inbred.lifespan.txt</code>.</p>

<p>First load the data and take a look:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># load data</span><span class="w">
</span><span class="n">data.surv</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.delim</span><span class="p">(</span><span class="s2">"./data/inbred.lifespan.txt"</span><span class="p">)</span><span class="w">

</span><span class="c1"># summarize data structure and examine strain list</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">data.surv</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>'data.frame':	1881 obs. of  5 variables:
 $ strain       : chr  "129S1/SvImJ" "129S1/SvImJ" "129S1/SvImJ" "129S1/SvImJ" ...
 $ sex          : chr  "f" "f" "f" "f" ...
 $ animal_id    : chr  "1" "2" "3" "4" ...
 $ lifespan_days: int  616 763 770 987 673 920 680 483 821 938 ...
 $ censor       : int  0 0 0 0 0 0 0 0 0 0 ...
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">unique</span><span class="p">(</span><span class="n">data.surv</span><span class="o">$</span><span class="n">strain</span><span class="p">)</span><span class="w"> </span><span class="c1"># generate strain list</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code> [1] "129S1/SvImJ"       "A/J"               "BALB/cByJ"        
 [4] "BTBR T+ tf/J"      "BUB/BnJ"           "C3H/HeJ"          
 [7] "C57BL/10J"         "C57BL/6J"          "C57BLKS/J"        
[10] "C57BR/cdJ"         "C57L/J"            "CAST/EiJ"         
[13] "CBA/J"             "DBA/2J"            "FVB/NJ"           
[16] "KK/HlJ"            "LP/J"              "MOLF/EiJ"         
[19] "MRL/MpJ"           "NOD.B10Sn-H2&lt;b&gt;/J" "NON/ShiLtJ"       
[22] "NZO/HlLtJ"         "NZW/LacJ"          "P/J"              
[25] "PL/J"              "PWD/PhJ"           "RIIIS/J"          
[28] "SJL/J"             "SM/J"              "SWR/J"            
[31] "WSB/EiJ"          
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># grab subset of lifespan data for C57BL/6J mice.</span><span class="w">
</span><span class="n">surv.b6</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.surv</span><span class="p">[</span><span class="n">data.surv</span><span class="o">$</span><span class="n">strain</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="s2">"C57BL/6J"</span><span class="p">,]</span><span class="w">
</span></code></pre></div></div>

<p> </p>

<p>Okay, we are in business. Let’s see if the data is normal.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">qqnorm</span><span class="p">(</span><span class="n">surv.b6</span><span class="o">$</span><span class="n">lifespan_days</span><span class="p">)</span><span class="w">
</span><span class="n">qqline</span><span class="p">(</span><span class="n">surv.b6</span><span class="o">$</span><span class="n">lifespan_days</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-09-class-power-analysis-unnamed-chunk-9-1.png" title="plot of chunk unnamed-chunk-9" alt="plot of chunk unnamed-chunk-9" width="612" style="display: block; margin: auto;" /></p>

<p> </p>

<p>That actually looks pretty good for survival data. Certainly good enough that we don’t need to worry too much about normality assumptions, but we should still treat our t-test samples sizes conservatively, since survival data violates other t-test assumptions.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># set desired power and significance</span><span class="w">
</span><span class="n">alpha</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0.05</span><span class="w">
</span><span class="n">power</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0.95</span><span class="w">
</span><span class="n">beta</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">power</span><span class="w">
</span><span class="n">change</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0.2</span><span class="w">

</span><span class="c1"># we next use our pilot data to estimate the distribution shape parameters (mean, sd)</span><span class="w">
</span><span class="n">mu</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">surv.b6</span><span class="o">$</span><span class="n">lifespan_days</span><span class="p">)</span><span class="w">
</span><span class="n">sigma</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">surv.b6</span><span class="o">$</span><span class="n">lifespan_days</span><span class="p">)</span><span class="w">

</span><span class="c1"># from the mean and the desired percent change we can calculate the effect size</span><span class="w">
</span><span class="n">delta</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">change</span><span class="o">*</span><span class="n">mu</span><span class="w">

</span><span class="c1"># t-test</span><span class="w">
</span><span class="n">n.t</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pwr.t.test</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span><span class="n">d</span><span class="o">=</span><span class="n">delta</span><span class="o">/</span><span class="n">sigma</span><span class="p">,</span><span class="n">sig.level</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span><span class="n">power</span><span class="o">=</span><span class="n">power</span><span class="p">,</span><span class="n">type</span><span class="o">=</span><span class="s2">"two.sample"</span><span class="p">,</span><span class="n">alternative</span><span class="o">=</span><span class="s2">"two.sided"</span><span class="p">)</span><span class="w">
</span><span class="n">n.t</span><span class="o">$</span><span class="n">n</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 29.94459
</code></pre></div></div>

<p> </p>

<p>That’s much bigger than the sample size needed for body weight! Lifespan has much higher variability than body weight in most species, so the ability to detect a similar size change requires a much larger sample size to achieve the same power at the same significance level.</p>

<blockquote class="challenge">
  <h2 id="changing-strains--lifespan-edition">Changing strains – lifespan edition</h2>

  <p>Determine the sample size needed to detect a 10% change in A/J lifespan at 90% power with significance level 0.01.</p>

  <blockquote class="solution">
    <h2 id="solution-1">Solution</h2>

    <p>First load the data and take a look:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># load data</span><span class="w">
</span><span class="n">data.surv</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.delim</span><span class="p">(</span><span class="s2">"./data/inbred.lifespan.txt"</span><span class="p">)</span><span class="w">

</span><span class="c1"># grab subset of lifespan data for C57BL/6J mice.</span><span class="w">
</span><span class="n">surv.aj</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.surv</span><span class="p">[</span><span class="n">data.surv</span><span class="o">$</span><span class="n">strain</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="s2">"A/J"</span><span class="p">,]</span><span class="w">

</span><span class="c1"># check for normality</span><span class="w">
</span><span class="n">qqnorm</span><span class="p">(</span><span class="n">surv.aj</span><span class="o">$</span><span class="n">lifespan_days</span><span class="p">)</span><span class="w">
</span><span class="n">qqline</span><span class="p">(</span><span class="n">surv.aj</span><span class="o">$</span><span class="n">lifespan_days</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <p><img src="../fig/rmd-09-class-power-analysis-unnamed-chunk-11-1.png" title="plot of chunk unnamed-chunk-11" alt="plot of chunk unnamed-chunk-11" width="612" style="display: block; margin: auto;" /></p>

    <p>Pretty good! On to the power</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># set desired power and significance</span><span class="w">
</span><span class="n">alpha</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0.01</span><span class="w">
</span><span class="n">power</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0.90</span><span class="w">
</span><span class="n">beta</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">power</span><span class="w">
</span><span class="n">change</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0.1</span><span class="w">

</span><span class="c1"># we next use our pilot data to estimate the distribution shape parameters (mean, sd)</span><span class="w">
</span><span class="n">mu</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">surv.aj</span><span class="o">$</span><span class="n">lifespan_days</span><span class="p">)</span><span class="w">
</span><span class="n">sigma</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">surv.aj</span><span class="o">$</span><span class="n">lifespan_days</span><span class="p">)</span><span class="w">

</span><span class="c1"># from the mean and the desired percent change we can calculate the effect size</span><span class="w">
</span><span class="n">delta</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">change</span><span class="o">*</span><span class="n">mu</span><span class="w">

</span><span class="c1"># t-test</span><span class="w">
</span><span class="n">n.t</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pwr.t.test</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span><span class="n">d</span><span class="o">=</span><span class="n">delta</span><span class="o">/</span><span class="n">sigma</span><span class="p">,</span><span class="n">sig.level</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span><span class="n">power</span><span class="o">=</span><span class="n">power</span><span class="p">,</span><span class="n">type</span><span class="o">=</span><span class="s2">"two.sample"</span><span class="p">,</span><span class="n">alternative</span><span class="o">=</span><span class="s2">"two.sided"</span><span class="p">)</span><span class="w">
</span><span class="n">n.t</span><span class="o">$</span><span class="n">n</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 127.356
</code></pre></div>    </div>

    <p>That’s a lot of mice! Decreasing the detectable change and the significance 
level had a big impact even though we reduced power to detect a bit.</p>
  </blockquote>
</blockquote>

<hr />
<h3 id="generating-power-reference-charts">Generating power reference charts</h3>

<p>The previous examples give us an idea of what to expect when we have a clear idea about our desired effect size, power, and significance level going in. Okay, so we know that with 30 C57BL/6J mice per group, we have 95% power to detect a 20% change. But what power do we have to detect a 30% change? How much do we need to increase the sample size to have the same power to detect a 10% change?</p>

<p>It is often useful, particularly in early-stage planning, to have an idea of what the relationship looks like between sample size, power, and effect size. We can generate useful power reference charts by by repeating the power analysis to calculate sample size requirements over a range of power values and plotting the outcome.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># set desired change and significance</span><span class="w">
</span><span class="n">alpha</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0.05</span><span class="w">
</span><span class="n">change</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0.2</span><span class="w">

</span><span class="c1"># we next use our pilot data to estimate the distribution shape parameters (mean, sd)</span><span class="w">
</span><span class="n">mu</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">surv.b6</span><span class="o">$</span><span class="n">lifespan_days</span><span class="p">)</span><span class="w">
</span><span class="n">sigma</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">surv.b6</span><span class="o">$</span><span class="n">lifespan_days</span><span class="p">)</span><span class="w">

</span><span class="c1"># from the mean and the desired percent change we can calculate the effect size</span><span class="w">
</span><span class="n">delta</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">change</span><span class="o">*</span><span class="n">mu</span><span class="w">

</span><span class="c1"># set up a vector with a range of values for power</span><span class="w">
</span><span class="n">power.vec</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="m">0.5</span><span class="p">,</span><span class="m">0.99</span><span class="p">,</span><span class="m">0.01</span><span class="p">)</span><span class="w">

</span><span class="c1"># initialize an empty vector with the same length as power where we will store calculated</span><span class="w">
</span><span class="c1"># sample size values</span><span class="w">
</span><span class="n">n.vec</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">numeric</span><span class="p">(</span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">power.vec</span><span class="p">))</span><span class="w">

</span><span class="c1"># cycle through all power values using a for loop</span><span class="w">
</span><span class="c1"># and calculate n for each</span><span class="w">
</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i.pwr</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">power.vec</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="c1"># grab the current power value</span><span class="w">
  </span><span class="n">power.c</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">power.vec</span><span class="p">[</span><span class="n">i.pwr</span><span class="p">]</span><span class="w">
  
  </span><span class="c1"># display current iteration</span><span class="w">
  </span><span class="n">print</span><span class="p">(</span><span class="n">paste</span><span class="p">(</span><span class="s2">"Calculating n for power"</span><span class="p">,</span><span class="n">power.c</span><span class="p">))</span><span class="w">
  
  </span><span class="c1"># calculate sample size for current power</span><span class="w">
  </span><span class="n">pwr.test.c</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pwr.t.test</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span><span class="n">d</span><span class="o">=</span><span class="n">delta</span><span class="o">/</span><span class="n">sigma</span><span class="p">,</span><span class="n">sig.level</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span><span class="n">power</span><span class="o">=</span><span class="n">power.c</span><span class="p">,</span><span class="w">
                         </span><span class="n">type</span><span class="o">=</span><span class="s2">"two.sample"</span><span class="p">,</span><span class="n">alternative</span><span class="o">=</span><span class="s2">"two.sided"</span><span class="p">)</span><span class="w">
  
  </span><span class="c1"># save value to sample size vector</span><span class="w">
  </span><span class="n">n.vec</span><span class="p">[</span><span class="n">i.pwr</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pwr.test.c</span><span class="o">$</span><span class="n">n</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "Calculating n for power 0.5"
[1] "Calculating n for power 0.51"
[1] "Calculating n for power 0.52"
[1] "Calculating n for power 0.53"
[1] "Calculating n for power 0.54"
[1] "Calculating n for power 0.55"
[1] "Calculating n for power 0.56"
[1] "Calculating n for power 0.57"
[1] "Calculating n for power 0.58"
[1] "Calculating n for power 0.59"
[1] "Calculating n for power 0.6"
[1] "Calculating n for power 0.61"
[1] "Calculating n for power 0.62"
[1] "Calculating n for power 0.63"
[1] "Calculating n for power 0.64"
[1] "Calculating n for power 0.65"
[1] "Calculating n for power 0.66"
[1] "Calculating n for power 0.67"
[1] "Calculating n for power 0.68"
[1] "Calculating n for power 0.69"
[1] "Calculating n for power 0.7"
[1] "Calculating n for power 0.71"
[1] "Calculating n for power 0.72"
[1] "Calculating n for power 0.73"
[1] "Calculating n for power 0.74"
[1] "Calculating n for power 0.75"
[1] "Calculating n for power 0.76"
[1] "Calculating n for power 0.77"
[1] "Calculating n for power 0.78"
[1] "Calculating n for power 0.79"
[1] "Calculating n for power 0.8"
[1] "Calculating n for power 0.81"
[1] "Calculating n for power 0.82"
[1] "Calculating n for power 0.83"
[1] "Calculating n for power 0.84"
[1] "Calculating n for power 0.85"
[1] "Calculating n for power 0.86"
[1] "Calculating n for power 0.87"
[1] "Calculating n for power 0.88"
[1] "Calculating n for power 0.89"
[1] "Calculating n for power 0.9"
[1] "Calculating n for power 0.91"
[1] "Calculating n for power 0.92"
[1] "Calculating n for power 0.93"
[1] "Calculating n for power 0.94"
[1] "Calculating n for power 0.95"
[1] "Calculating n for power 0.96"
[1] "Calculating n for power 0.97"
[1] "Calculating n for power 0.98"
[1] "Calculating n for power 0.99"
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># visualize the relationship between power and animal number</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">n.vec</span><span class="p">,</span><span class="n">power.vec</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"l"</span><span class="p">,</span><span class="w"> 
     </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Power to detect 20% change in lifespan"</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"# Animals Required"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-09-class-power-analysis-unnamed-chunk-13-1.png" title="plot of chunk unnamed-chunk-13" alt="plot of chunk unnamed-chunk-13" width="612" style="display: block; margin: auto;" /></p>

<p> </p>

<p>The relationship between sample size and power is not linear. This chart illustrates how sample size has diminishing returns when trying to improve power. Increasing sample size from 10 to 20 gives you a ~30% boost in power, while increasing sample size from 20 to 30 only gives an additional ~12%.</p>

<p>We can go a step further and look at the relationship between effect size, power, and sample size by adding a second, nested <code class="language-plaintext highlighter-rouge">for</code> loop:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># set desired significance</span><span class="w">
</span><span class="n">alpha</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0.05</span><span class="w">

</span><span class="c1"># we next use our pilot data to estimate the distribution shape parameters </span><span class="w">
</span><span class="c1"># (mean, sd)</span><span class="w">
</span><span class="n">mu</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">surv.b6</span><span class="o">$</span><span class="n">lifespan_days</span><span class="p">)</span><span class="w">
</span><span class="n">sigma</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">surv.b6</span><span class="o">$</span><span class="n">lifespan_days</span><span class="p">)</span><span class="w">

</span><span class="c1"># Define vectors containing the range of effect size and power that we are interested in</span><span class="w">
</span><span class="n">change.vec</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="m">0.1</span><span class="p">,</span><span class="m">0.3</span><span class="p">,</span><span class="m">0.01</span><span class="p">)</span><span class="w">
</span><span class="n">power.vec</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0.5</span><span class="p">,</span><span class="m">0.8</span><span class="p">,</span><span class="m">0.9</span><span class="p">,</span><span class="m">0.95</span><span class="p">)</span><span class="w">

</span><span class="c1"># initialize a numeric matrix of the proper size to capture different effect sizes (in rows)</span><span class="w">
</span><span class="c1"># and powers (in columns)</span><span class="w">
</span><span class="n">n.mat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">change.vec</span><span class="p">),</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">power.vec</span><span class="p">))</span><span class="w">

</span><span class="c1"># cycle through all power and change values using a for loop</span><span class="w">
</span><span class="c1"># and calculate n for each</span><span class="w">
</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i.pwr</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">power.vec</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="c1"># grab current value for power</span><span class="w">
  </span><span class="n">power.c</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">power.vec</span><span class="p">[</span><span class="n">i.pwr</span><span class="p">]</span><span class="w">
  
  </span><span class="c1"># print current step</span><span class="w">
  </span><span class="n">print</span><span class="p">(</span><span class="n">paste</span><span class="p">(</span><span class="s2">"Calculating sample size for power"</span><span class="p">,</span><span class="n">power.c</span><span class="p">))</span><span class="w">
  
  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i.change</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">change.vec</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="c1"># grab the current effect size</span><span class="w">
    </span><span class="n">change.c</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">change.vec</span><span class="p">[</span><span class="n">i.change</span><span class="p">]</span><span class="w">
    
    </span><span class="c1"># calculate delta from mu and current change value</span><span class="w">
    </span><span class="n">delta.c</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">change.c</span><span class="o">*</span><span class="n">mu</span><span class="w">
    
    </span><span class="c1"># calculate sample size for current power</span><span class="w">
    </span><span class="n">pwr.test.c</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pwr.t.test</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span><span class="n">d</span><span class="o">=</span><span class="n">delta.c</span><span class="o">/</span><span class="n">sigma</span><span class="p">,</span><span class="n">sig.level</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span><span class="n">power</span><span class="o">=</span><span class="n">power.c</span><span class="p">,</span><span class="w">
                     </span><span class="n">type</span><span class="o">=</span><span class="s2">"two.sample"</span><span class="p">,</span><span class="n">alternative</span><span class="o">=</span><span class="s2">"two.sided"</span><span class="p">)</span><span class="w">
    
    </span><span class="c1"># save value to sample size vector</span><span class="w">
    </span><span class="n">n.mat</span><span class="p">[</span><span class="n">i.change</span><span class="p">,</span><span class="w"> </span><span class="n">i.pwr</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pwr.test.c</span><span class="o">$</span><span class="n">n</span><span class="w">
  </span><span class="p">}</span><span class="w">

</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "Calculating sample size for power 0.5"
[1] "Calculating sample size for power 0.8"
[1] "Calculating sample size for power 0.9"
[1] "Calculating sample size for power 0.95"
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># list colors for plot</span><span class="w">
</span><span class="n">col.list</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"black"</span><span class="p">,</span><span class="s2">"blue"</span><span class="p">,</span><span class="s2">"green"</span><span class="p">,</span><span class="s2">"red"</span><span class="p">)</span><span class="w">

</span><span class="c1"># setup the plot limits to include all</span><span class="w">
</span><span class="n">x.lim</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="nf">min</span><span class="p">(</span><span class="m">100</span><span class="o">*</span><span class="n">change.vec</span><span class="p">),</span><span class="nf">max</span><span class="p">(</span><span class="m">100</span><span class="o">*</span><span class="n">change.vec</span><span class="p">))</span><span class="w">
</span><span class="n">y.lim</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="nf">min</span><span class="p">(</span><span class="n">n.mat</span><span class="p">),</span><span class="nf">max</span><span class="p">(</span><span class="n">n.mat</span><span class="p">))</span><span class="w">

</span><span class="c1"># initialize empty plot with defined limits </span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">xlim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x.lim</span><span class="p">,</span><span class="w"> </span><span class="n">ylim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y.lim</span><span class="p">,</span><span class="w"> 
     </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"% Change in Lifespan"</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"# Animals Required"</span><span class="p">,</span><span class="w">
     </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Power analysis for C57BL/6J lifespan, p &lt; 0.05"</span><span class="p">)</span><span class="w">

</span><span class="c1"># add a legend for the power values</span><span class="w">
</span><span class="n">legend</span><span class="p">(</span><span class="s2">"topright"</span><span class="p">,</span><span class="w"> </span><span class="n">legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">power.vec</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">col.list</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="o">=</span><span class="s2">"Power"</span><span class="p">)</span><span class="w">

</span><span class="c1"># finally, add a separate line for each power level</span><span class="w">
</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i.pwr</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">power.vec</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">lines</span><span class="p">(</span><span class="m">100</span><span class="o">*</span><span class="n">change.vec</span><span class="p">,</span><span class="n">n.mat</span><span class="p">[,</span><span class="n">i.pwr</span><span class="p">],</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">col.list</span><span class="p">[</span><span class="n">i.pwr</span><span class="p">])</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-09-class-power-analysis-unnamed-chunk-14-1.png" title="plot of chunk unnamed-chunk-14" alt="plot of chunk unnamed-chunk-14" width="612" style="display: block; margin: auto;" /></p>

<blockquote class="challenge">
  <h2 id="how-much-does-strain-background-matter-for-power">How much does strain background matter for power?</h2>

  <p>We now have power data for C57BL/6J mice. How different are the power 
profiles for A/J mice?</p>

  <p>Generate sample size vs. effect size charts for the same range of power 
values that we used above (50%, 80%, 90%, 95%).</p>

  <blockquote class="solution">
    <h2 id="solution-2">Solution</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># load power library</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="s2">"pwr"</span><span class="p">)</span><span class="w">

</span><span class="c1"># load data and grab aj data subset</span><span class="w">
</span><span class="n">data.surv</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.delim</span><span class="p">(</span><span class="s2">"./data/inbred.lifespan.txt"</span><span class="p">)</span><span class="w">
</span><span class="n">surv.aj</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.surv</span><span class="p">[</span><span class="n">data.surv</span><span class="o">$</span><span class="n">strain</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"A/J"</span><span class="p">,]</span><span class="w">

</span><span class="c1"># set desired significance</span><span class="w">
</span><span class="n">alpha</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0.05</span><span class="w">

</span><span class="c1"># we next use our pilot data to estimate the distribution shape parameters (mean, sd)</span><span class="w">
</span><span class="n">mu</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">surv.aj</span><span class="o">$</span><span class="n">lifespan_days</span><span class="p">)</span><span class="w">
</span><span class="n">sigma</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">surv.aj</span><span class="o">$</span><span class="n">lifespan_days</span><span class="p">)</span><span class="w">

</span><span class="c1"># Define vectors containing the range of effect size and power that we are interested in</span><span class="w">
</span><span class="n">change.vec</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="m">0.1</span><span class="p">,</span><span class="m">0.3</span><span class="p">,</span><span class="m">0.01</span><span class="p">)</span><span class="w">
</span><span class="n">power.vec</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0.5</span><span class="p">,</span><span class="m">0.8</span><span class="p">,</span><span class="m">0.9</span><span class="p">,</span><span class="m">0.95</span><span class="p">)</span><span class="w">

</span><span class="c1"># initialize a numeric matrix of the proper size to capture different effect sizes (in rows)</span><span class="w">
</span><span class="c1"># and powers (in columns)</span><span class="w">
</span><span class="n">n.mat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">change.vec</span><span class="p">),</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">power.vec</span><span class="p">))</span><span class="w">

</span><span class="c1"># cycle through all power and change values using a for loop</span><span class="w">
</span><span class="c1"># and calculate n for each</span><span class="w">
</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i.pwr</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">power.vec</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="c1"># grab current value for power</span><span class="w">
  </span><span class="n">power.c</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">power.vec</span><span class="p">[</span><span class="n">i.pwr</span><span class="p">]</span><span class="w">
  
  </span><span class="c1"># print current step</span><span class="w">
  </span><span class="n">print</span><span class="p">(</span><span class="n">paste</span><span class="p">(</span><span class="s2">"Calculating sample size for power"</span><span class="p">,</span><span class="n">power.c</span><span class="p">))</span><span class="w">
  
  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i.change</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">change.vec</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="c1"># grab the current effect size</span><span class="w">
    </span><span class="n">change.c</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">change.vec</span><span class="p">[</span><span class="n">i.change</span><span class="p">]</span><span class="w">
    
    </span><span class="c1"># calculate delta from mu and current change value</span><span class="w">
    </span><span class="n">delta.c</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">change.c</span><span class="o">*</span><span class="n">mu</span><span class="w">
    
    </span><span class="c1"># calculate sample size for current power</span><span class="w">
    </span><span class="n">pwr.test.c</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pwr.t.test</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span><span class="w">
                            </span><span class="n">d</span><span class="o">=</span><span class="n">delta.c</span><span class="o">/</span><span class="n">sigma</span><span class="p">,</span><span class="w">
                            </span><span class="n">sig.level</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span><span class="w">
                            </span><span class="n">power</span><span class="o">=</span><span class="n">power.c</span><span class="p">,</span><span class="w">
                            </span><span class="n">type</span><span class="o">=</span><span class="s2">"two.sample"</span><span class="p">,</span><span class="w">
                            </span><span class="n">alternative</span><span class="o">=</span><span class="s2">"two.sided"</span><span class="p">)</span><span class="w">
    
    </span><span class="c1"># save value to sample size vector</span><span class="w">
    </span><span class="n">n.mat</span><span class="p">[</span><span class="n">i.change</span><span class="p">,</span><span class="w"> </span><span class="n">i.pwr</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pwr.test.c</span><span class="o">$</span><span class="n">n</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "Calculating sample size for power 0.5"
[1] "Calculating sample size for power 0.8"
[1] "Calculating sample size for power 0.9"
[1] "Calculating sample size for power 0.95"
</code></pre></div>    </div>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># list colors for plot</span><span class="w">
</span><span class="n">col.list</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"black"</span><span class="p">,</span><span class="s2">"blue"</span><span class="p">,</span><span class="s2">"green"</span><span class="p">,</span><span class="s2">"red"</span><span class="p">)</span><span class="w">

</span><span class="c1"># setup the plot limits to include all</span><span class="w">
</span><span class="n">x.lim</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="nf">min</span><span class="p">(</span><span class="m">100</span><span class="o">*</span><span class="n">change.vec</span><span class="p">),</span><span class="nf">max</span><span class="p">(</span><span class="m">100</span><span class="o">*</span><span class="n">change.vec</span><span class="p">))</span><span class="w">
</span><span class="n">y.lim</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="nf">min</span><span class="p">(</span><span class="n">n.mat</span><span class="p">),</span><span class="nf">max</span><span class="p">(</span><span class="n">n.mat</span><span class="p">))</span><span class="w">

</span><span class="c1"># initialize empty plot with defined limits </span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">xlim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x.lim</span><span class="p">,</span><span class="w"> </span><span class="n">ylim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y.lim</span><span class="p">,</span><span class="w"> 
     </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"% Change in Lifespan"</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"# Animals Required"</span><span class="p">,</span><span class="w">
     </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Power analysis for A/J lifespan, p &lt; 0.05"</span><span class="p">)</span><span class="w">

</span><span class="c1"># add a legend for the power values</span><span class="w">
</span><span class="n">legend</span><span class="p">(</span><span class="s2">"topright"</span><span class="p">,</span><span class="w"> </span><span class="n">legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">power.vec</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">col.list</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="o">=</span><span class="s2">"Power"</span><span class="p">)</span><span class="w">

</span><span class="c1"># finally, add a separate line for each power level</span><span class="w">
</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i.pwr</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">power.vec</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">lines</span><span class="p">(</span><span class="m">100</span><span class="o">*</span><span class="n">change.vec</span><span class="p">,</span><span class="n">n.mat</span><span class="p">[,</span><span class="n">i.pwr</span><span class="p">],</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">col.list</span><span class="p">[</span><span class="n">i.pwr</span><span class="p">])</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>

    <p><img src="../fig/rmd-09-class-power-analysis-unnamed-chunk-15-1.png" title="plot of chunk unnamed-chunk-15" alt="plot of chunk unnamed-chunk-15" width="612" style="display: block; margin: auto;" /></p>

    <p> </p>

    <p>It looks like C57BL/6J and A/J mice have nearly identical power charts. 
Then again, the mean and standard deviation appear to be similar and 
approximately proportional to one another:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mu.b6</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">data.diet</span><span class="o">$</span><span class="n">bw_start</span><span class="p">[</span><span class="n">data.diet</span><span class="o">$</span><span class="n">strain</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"C57BL/6J"</span><span class="p">])</span><span class="w">
</span><span class="n">sigma.b6</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">data.diet</span><span class="o">$</span><span class="n">bw_start</span><span class="p">[</span><span class="n">data.diet</span><span class="o">$</span><span class="n">strain</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"C57BL/6J"</span><span class="p">])</span><span class="w">
</span><span class="n">mu.aj</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">data.diet</span><span class="o">$</span><span class="n">bw_start</span><span class="p">[</span><span class="n">data.diet</span><span class="o">$</span><span class="n">strain</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"A/J"</span><span class="p">])</span><span class="w">
</span><span class="n">sigma.aj</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">data.diet</span><span class="o">$</span><span class="n">bw_start</span><span class="p">[</span><span class="n">data.diet</span><span class="o">$</span><span class="n">strain</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"A/J"</span><span class="p">])</span><span class="w">
</span><span class="n">mu.b6</span><span class="o">/</span><span class="n">sigma.b6</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 10.72917
</code></pre></div>    </div>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mu.aj</span><span class="o">/</span><span class="n">sigma.aj</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 11.01157
</code></pre></div>    </div>

    <p> </p>

    <p>Because the importance of “effect size” in determining power is proportional to 
the relative mean and variance (i.e. standard deviation) in the population, it 
is no surprise that the power numbers are similar when mean and standard 
deviation is similar. After all, we defined all of the other relevant 
parameters (\(\alpha\), \(power\)) except for \(n\), which is what we are 
trying to calculate. A broader examination of mouse strains with more deviant 
lifespan distributions may produce different outcomes.</p>
  </blockquote>
</blockquote>

<p> </p>

<blockquote class="challenge">
  <h2 id="is-power-to-detect-lifespan-different-for-males-and-females">Is power to detect lifespan different for males and females?</h2>

  <p>We looked at the combined population of male and female C57BL/6J mice. 
How different is the power prediction for each sex independently?</p>

  <p>Calculate the sample size vs. effect size charts for 95% power for male 
and female C57BL/6J mice and present them on the same chart for comparison.</p>

  <p>What might account for differences in sample size estimates (if any)?</p>

  <blockquote class="solution">
    <h2 id="solution-3">Solution</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># load power library</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="s2">"pwr"</span><span class="p">)</span><span class="w">

</span><span class="c1"># load data and grab aj data subset</span><span class="w">
</span><span class="n">data.surv</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.delim</span><span class="p">(</span><span class="s2">"./data/inbred.lifespan.txt"</span><span class="p">)</span><span class="w">
</span><span class="n">surv.b6.f</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.surv</span><span class="p">[</span><span class="n">data.surv</span><span class="o">$</span><span class="n">strain</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"C57BL/6J"</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">data.surv</span><span class="o">$</span><span class="n">sex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"f"</span><span class="p">,]</span><span class="w">
</span><span class="n">surv.b6.m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.surv</span><span class="p">[</span><span class="n">data.surv</span><span class="o">$</span><span class="n">strain</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"C57BL/6J"</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">data.surv</span><span class="o">$</span><span class="n">sex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"m"</span><span class="p">,]</span><span class="w">

</span><span class="c1"># set desired significance and power</span><span class="w">
</span><span class="n">alpha</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0.05</span><span class="w">
</span><span class="n">power</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0.95</span><span class="w">

</span><span class="c1"># we next use our pilot data to estimate the distribution shape parameters (mean, sd)</span><span class="w">
</span><span class="n">mu.f</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">surv.b6.f</span><span class="o">$</span><span class="n">lifespan_days</span><span class="p">)</span><span class="w">
</span><span class="n">sigma.f</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">surv.b6.f</span><span class="o">$</span><span class="n">lifespan_days</span><span class="p">)</span><span class="w">

</span><span class="n">mu.m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">surv.b6.m</span><span class="o">$</span><span class="n">lifespan_days</span><span class="p">)</span><span class="w">
</span><span class="n">sigma.m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">surv.b6.m</span><span class="o">$</span><span class="n">lifespan_days</span><span class="p">)</span><span class="w">

</span><span class="c1"># Define vector containing the range of effect size that we are interested in</span><span class="w">
</span><span class="n">change.vec</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="m">0.1</span><span class="p">,</span><span class="m">0.3</span><span class="p">,</span><span class="m">0.01</span><span class="p">)</span><span class="w">

</span><span class="c1"># initialize a numeric matrix of the proper size to capture different effect sizes (in rows)</span><span class="w">
</span><span class="c1"># and sex (in columns)</span><span class="w">
</span><span class="n">n.mat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">change.vec</span><span class="p">),</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">

</span><span class="c1"># cycle through all power and change values using a for loop</span><span class="w">
</span><span class="c1"># and calculate n for each</span><span class="w">
</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i.change</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">change.vec</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="c1"># grab current value for change</span><span class="w">
  </span><span class="n">change.c</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">change.vec</span><span class="p">[</span><span class="n">i.change</span><span class="p">]</span><span class="w">
  
  </span><span class="c1"># print current step</span><span class="w">
  </span><span class="n">print</span><span class="p">(</span><span class="n">paste</span><span class="p">(</span><span class="s2">"Calculating sample size for change"</span><span class="p">,</span><span class="n">change.c</span><span class="p">))</span><span class="w">
  
  </span><span class="c1"># calculate delta from mu and current change value</span><span class="w">
  </span><span class="n">delta.f.c</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">change.c</span><span class="o">*</span><span class="n">mu.f</span><span class="w">
  </span><span class="n">delta.m.c</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">change.c</span><span class="o">*</span><span class="n">mu.m</span><span class="w">
    
  </span><span class="c1"># calculate sample size for current power</span><span class="w">
  </span><span class="n">pwr.test.f.c</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pwr.t.test</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="o">=</span><span class="n">delta.f.c</span><span class="o">/</span><span class="n">sigma.f</span><span class="p">,</span><span class="n">sig.level</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span><span class="w"> </span><span class="n">power</span><span class="o">=</span><span class="n">power</span><span class="p">,</span><span class="w">
                   </span><span class="n">type</span><span class="o">=</span><span class="s2">"two.sample"</span><span class="p">,</span><span class="n">alternative</span><span class="o">=</span><span class="s2">"two.sided"</span><span class="p">)</span><span class="w">
  </span><span class="n">pwr.test.m.c</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pwr.t.test</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="o">=</span><span class="n">delta.m.c</span><span class="o">/</span><span class="n">sigma.m</span><span class="p">,</span><span class="n">sig.level</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span><span class="w"> </span><span class="n">power</span><span class="o">=</span><span class="n">power</span><span class="p">,</span><span class="w">
                   </span><span class="n">type</span><span class="o">=</span><span class="s2">"two.sample"</span><span class="p">,</span><span class="n">alternative</span><span class="o">=</span><span class="s2">"two.sided"</span><span class="p">)</span><span class="w">

  </span><span class="c1"># save value to sample size vector</span><span class="w">
  </span><span class="n">n.mat</span><span class="p">[</span><span class="n">i.change</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pwr.test.f.c</span><span class="o">$</span><span class="n">n</span><span class="w">
  </span><span class="n">n.mat</span><span class="p">[</span><span class="n">i.change</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pwr.test.m.c</span><span class="o">$</span><span class="n">n</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "Calculating sample size for change 0.1"
[1] "Calculating sample size for change 0.11"
[1] "Calculating sample size for change 0.12"
[1] "Calculating sample size for change 0.13"
[1] "Calculating sample size for change 0.14"
[1] "Calculating sample size for change 0.15"
[1] "Calculating sample size for change 0.16"
[1] "Calculating sample size for change 0.17"
[1] "Calculating sample size for change 0.18"
[1] "Calculating sample size for change 0.19"
[1] "Calculating sample size for change 0.2"
[1] "Calculating sample size for change 0.21"
[1] "Calculating sample size for change 0.22"
[1] "Calculating sample size for change 0.23"
[1] "Calculating sample size for change 0.24"
[1] "Calculating sample size for change 0.25"
[1] "Calculating sample size for change 0.26"
[1] "Calculating sample size for change 0.27"
[1] "Calculating sample size for change 0.28"
[1] "Calculating sample size for change 0.29"
[1] "Calculating sample size for change 0.3"
</code></pre></div>    </div>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># setup the plot limits to include all</span><span class="w">
</span><span class="n">x.lim</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="nf">min</span><span class="p">(</span><span class="m">100</span><span class="o">*</span><span class="n">change.vec</span><span class="p">),</span><span class="nf">max</span><span class="p">(</span><span class="m">100</span><span class="o">*</span><span class="n">change.vec</span><span class="p">))</span><span class="w">
</span><span class="n">y.lim</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="nf">min</span><span class="p">(</span><span class="n">n.mat</span><span class="p">),</span><span class="nf">max</span><span class="p">(</span><span class="n">n.mat</span><span class="p">))</span><span class="w">

</span><span class="c1"># initialize empty plot with defined limits </span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">xlim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x.lim</span><span class="p">,</span><span class="w"> </span><span class="n">ylim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y.lim</span><span class="p">,</span><span class="w"> 
     </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"% Change in Lifespan"</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"# Animals Required"</span><span class="p">,</span><span class="w">
     </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Power analysis for C57BL/6J Lifespan, p &lt; 0.05"</span><span class="p">)</span><span class="w">

</span><span class="c1"># add a legend for the power values</span><span class="w">
</span><span class="n">legend</span><span class="p">(</span><span class="s2">"topright"</span><span class="p">,</span><span class="w"> </span><span class="n">legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"female"</span><span class="p">,</span><span class="w"> </span><span class="s2">"male"</span><span class="p">),</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"red"</span><span class="p">,</span><span class="s2">"blue"</span><span class="p">),</span><span class="w"> </span><span class="n">title</span><span class="o">=</span><span class="s2">"Sex"</span><span class="p">)</span><span class="w">

</span><span class="c1"># finally, add a separate line for each power level</span><span class="w">
</span><span class="n">lines</span><span class="p">(</span><span class="m">100</span><span class="o">*</span><span class="n">change.vec</span><span class="p">,</span><span class="n">n.mat</span><span class="p">[,</span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"red"</span><span class="p">)</span><span class="w">
</span><span class="n">lines</span><span class="p">(</span><span class="m">100</span><span class="o">*</span><span class="n">change.vec</span><span class="p">,</span><span class="n">n.mat</span><span class="p">[,</span><span class="m">2</span><span class="p">],</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"blue"</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <p><img src="../fig/rmd-09-class-power-analysis-unnamed-chunk-17-1.png" title="plot of chunk unnamed-chunk-17" alt="plot of chunk unnamed-chunk-17" width="612" style="display: block; margin: auto;" /></p>

    <p> </p>

    <p>Why is it so much more difficult to detect a lifespan change in female mice? Let’s take
a look at the population parameter estimate:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mu.f</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 812.9375
</code></pre></div>    </div>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mu.m</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 894.2812
</code></pre></div>    </div>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sigma.f</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 222.6933
</code></pre></div>    </div>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sigma.m</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 113.8831
</code></pre></div>    </div>

    <p> </p>

    <p>The standard deviation in female lifespan is nearly double that of males. We need a 
substantially larger sample size to detect a change in a naturally variable population.</p>
  </blockquote>
</blockquote>

<p> </p>

<blockquote class="challenge">
  <h2 id="power-to-detect-dietary-effects-on-body-weight">Power to detect dietary effects on body weight</h2>

  <p>Generate power charts for our ability to detect a change in body weight following
a high-fat high-sucrose diet in C57BL/6J mice.</p>

  <blockquote class="solution">
    <h2 id="solution-4">Solution</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># load power library</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="s2">"pwr"</span><span class="p">)</span><span class="w">

</span><span class="c1"># load data and grab aj data subset</span><span class="w">
</span><span class="n">data.diet</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.delim</span><span class="p">(</span><span class="s2">"./data/b6.aj.hfhs.diet.txt"</span><span class="p">)</span><span class="w">
</span><span class="n">data.b6</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.diet</span><span class="p">[</span><span class="n">data.surv</span><span class="o">$</span><span class="n">strain</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"C57BL/6J"</span><span class="p">,]</span><span class="w">

</span><span class="c1"># set desired significance</span><span class="w">
</span><span class="n">alpha</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0.05</span><span class="w">

</span><span class="c1"># we next use our pilot data to estimate the distribution shape parameters (mean, sd)</span><span class="w">
</span><span class="n">mu</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">data.diet</span><span class="o">$</span><span class="n">bw_start</span><span class="p">)</span><span class="w">
</span><span class="n">sigma</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">data.diet</span><span class="o">$</span><span class="n">bw_start</span><span class="p">)</span><span class="w">

</span><span class="c1"># Define vectors containing the range of effect size and power that we are interested in</span><span class="w">
</span><span class="n">change.vec</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="m">0.05</span><span class="p">,</span><span class="m">0.5</span><span class="p">,</span><span class="m">0.01</span><span class="p">)</span><span class="w">
</span><span class="n">power.vec</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0.5</span><span class="p">,</span><span class="m">0.8</span><span class="p">,</span><span class="m">0.9</span><span class="p">,</span><span class="m">0.95</span><span class="p">)</span><span class="w">

</span><span class="c1"># initialize a numeric matrix of the proper size to capture different effect sizes (in rows)</span><span class="w">
</span><span class="c1"># and powers (in columns)</span><span class="w">
</span><span class="n">n.mat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">change.vec</span><span class="p">),</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">power.vec</span><span class="p">))</span><span class="w">

</span><span class="c1"># cycle through all power and change values using a for loop</span><span class="w">
</span><span class="c1"># and calculate n for each</span><span class="w">
</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i.pwr</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">power.vec</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="c1"># grab current value for power</span><span class="w">
  </span><span class="n">power.c</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">power.vec</span><span class="p">[</span><span class="n">i.pwr</span><span class="p">]</span><span class="w">
  
  </span><span class="c1"># print current step</span><span class="w">
  </span><span class="n">print</span><span class="p">(</span><span class="n">paste</span><span class="p">(</span><span class="s2">"Calculating sample size for power"</span><span class="p">,</span><span class="n">power.c</span><span class="p">))</span><span class="w">
  
  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i.change</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">change.vec</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="c1"># grab the current effect size</span><span class="w">
    </span><span class="n">change.c</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">change.vec</span><span class="p">[</span><span class="n">i.change</span><span class="p">]</span><span class="w">
    
    </span><span class="c1"># calculate delta from mu and current change value</span><span class="w">
    </span><span class="n">delta.c</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">change.c</span><span class="o">*</span><span class="n">mu</span><span class="w">
    
    </span><span class="c1"># calculate sample size for current power</span><span class="w">
    </span><span class="n">pwr.test.c</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pwr.t.test</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span><span class="n">d</span><span class="o">=</span><span class="n">delta.c</span><span class="o">/</span><span class="n">sigma</span><span class="p">,</span><span class="n">sig.level</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span><span class="n">power</span><span class="o">=</span><span class="n">power.c</span><span class="p">,</span><span class="w">
                     </span><span class="n">type</span><span class="o">=</span><span class="s2">"paired"</span><span class="p">,</span><span class="n">alternative</span><span class="o">=</span><span class="s2">"two.sided"</span><span class="p">)</span><span class="w">
    
    </span><span class="c1"># save value to sample size vector</span><span class="w">
    </span><span class="n">n.mat</span><span class="p">[</span><span class="n">i.change</span><span class="p">,</span><span class="w"> </span><span class="n">i.pwr</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pwr.test.c</span><span class="o">$</span><span class="n">n</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "Calculating sample size for power 0.5"
[1] "Calculating sample size for power 0.8"
[1] "Calculating sample size for power 0.9"
[1] "Calculating sample size for power 0.95"
</code></pre></div>    </div>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># list colors for plot</span><span class="w">
</span><span class="n">col.list</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"black"</span><span class="p">,</span><span class="s2">"blue"</span><span class="p">,</span><span class="s2">"green"</span><span class="p">,</span><span class="s2">"red"</span><span class="p">)</span><span class="w">

</span><span class="c1"># setup the plot limits to include all</span><span class="w">
</span><span class="n">x.lim</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="nf">min</span><span class="p">(</span><span class="m">100</span><span class="o">*</span><span class="n">change.vec</span><span class="p">),</span><span class="nf">max</span><span class="p">(</span><span class="m">100</span><span class="o">*</span><span class="n">change.vec</span><span class="p">))</span><span class="w">
</span><span class="n">y.lim</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="nf">min</span><span class="p">(</span><span class="n">n.mat</span><span class="p">),</span><span class="nf">max</span><span class="p">(</span><span class="n">n.mat</span><span class="p">))</span><span class="w">

</span><span class="c1"># initialize empty plot with defined limits </span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">xlim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x.lim</span><span class="p">,</span><span class="w"> </span><span class="n">ylim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y.lim</span><span class="p">,</span><span class="w"> 
     </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"% Change in Body Weight"</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"# Animals Required"</span><span class="p">,</span><span class="w">
     </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Power analysis for C57BL/6J Body Weight following HFHS diet, p &lt; 0.05"</span><span class="p">)</span><span class="w">

</span><span class="c1"># add a legend for the power values</span><span class="w">
</span><span class="n">legend</span><span class="p">(</span><span class="s2">"topright"</span><span class="p">,</span><span class="w"> </span><span class="n">legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">power.vec</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">col.list</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="o">=</span><span class="s2">"Power"</span><span class="p">)</span><span class="w">

</span><span class="c1"># finally, add a separate line for each power level</span><span class="w">
</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i.pwr</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">power.vec</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">lines</span><span class="p">(</span><span class="m">100</span><span class="o">*</span><span class="n">change.vec</span><span class="p">,</span><span class="n">n.mat</span><span class="p">[,</span><span class="n">i.pwr</span><span class="p">],</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">col.list</span><span class="p">[</span><span class="n">i.pwr</span><span class="p">])</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>

    <p><img src="../fig/rmd-09-class-power-analysis-unnamed-chunk-19-1.png" title="plot of chunk unnamed-chunk-19" alt="plot of chunk unnamed-chunk-19" width="612" style="display: block; margin: auto;" /></p>

    <p> </p>

    <p>The variation in body weight is relatively small in C57BL/6J mice. Thus we can 
detect relatively small (10%) changes in body weight at relatively high power 
(90%) with only a few mice (~15).</p>
  </blockquote>
</blockquote>

<hr />



<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>The goal of experimental design is to minimize hypothesis testing errors.</p>
</li>
    
    <li><p>The primary tool for improving statistical power is sample size.</p>
</li>
    
    <li><p>R has basic tools for power analysis in the <code class="language-plaintext highlighter-rouge">pwr</code> package.</p>
</li>
    
  </ul>
</blockquote>

</article>
















<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="../08-oyo-advanced-survival-analysis/index.html"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="../09-oyo-simulation/index.html"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>


      
      






<footer>
  <!--<div class="row">
    <div class="col-md-6 copyright" align="left">
	
    </div>
    <div class="col-md-6 help-links" align="right">
	
	
	<a href="/edit//_episodes_rmd/09-class-power-analysis.Rmd">Edit on GitHub</a>
	
	
	/
	<a href="/blob//CONTRIBUTING.md">Contributing</a>
	/
	<a href="/">Source</a>
	/
	<a href="/blob//CITATION">Cite</a>
	/
	<a href="mailto:sutphin@gmail.com">Contact</a>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12" align="center">
      Using <a href="https://github.com/carpentries/styles/">The Carpentries style</a>
      version <a href="https://github.com/carpentries/styles/releases/tag/v9.5.3">9.5.3</a>.
    </div>
  </div>-->
</footer>

      
    </div>
    
<script src="../assets/js/jquery.min.js"></script>
<script src="../assets/js/bootstrap.min.js"></script>
<script src="../assets/js/lesson.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-37305346-2', 'auto');
  ga('send', 'pageview');
</script>
<!--<script type="text/javascript"
  src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>-->
<script type="text/javascript"
src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

  </body>
</html>
